<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Application Technical Profile</title>
      <!-- Google Fonts: Roboto and Material Symbols -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
      <!-- Mermaid.js for diagram rendering -->
      <script src="https://cdn.jsdelivr.net/npm/mermaid@11.8.1/dist/mermaid.min.js"></script>
      <script>
         // Simple immediate check for Mermaid availability
         window.addEventListener('load', function() {
            if (typeof mermaid === 'undefined') {
               console.error('Mermaid library failed to load');
            } else {
               console.log('Mermaid library loaded successfully', mermaid.version || 'version unknown');
            }
         });
      </script>
      
      <!-- Critical stylesheet for Material Icons -->
      <style id="material-icons-critical">
         /* Ensure proper icon rendering and prevent emoji conversion */
         .material-symbols-outlined,
         .icon,
         [class*="icon"] {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal !important;
            font-style: normal !important;
            line-height: 1 !important;
            text-transform: none !important;
            letter-spacing: normal !important;
            word-wrap: normal !important;
            white-space: nowrap !important;
            direction: ltr !important;
            font-feature-settings: 'liga' !important;
            -webkit-font-feature-settings: 'liga' !important;
            -webkit-font-smoothing: antialiased !important;
            font-variant-emoji: text !important;
            text-rendering: optimizeLegibility !important;
            font-size: 20px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
         }
         
         /* Specifically target table content icons that might get corrupted during pagination */
         tbody .material-symbols-outlined,
         tbody .icon,
         tbody td .material-symbols-outlined,
         tbody td .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-variant-emoji: text !important;
            text-rendering: optimizeLegibility !important;
         }
         
         /* Specifically target pagination icons */
         .pagination-button .material-symbols-outlined,
         .pagination-button .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-variant-emoji: text !important;
            font-size: 20px !important;
         }
      </style>
      
      <!-- Table styling and pagination styles -->
      <style>
         /* Common styles */
         * {
            box-sizing: border-box;
         }
         
         body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.5;
            color: #333;
            margin: 0;
            padding: 0;
         }
         
         /* Table container */
         .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 2rem;
         }
         
         /* Table pagination styles */
         .table-pagination {
            margin-top: 12px;
         }
         
         .pagination-top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
         }
         
         .page-size-selector {
            display: flex;
            align-items: center;
         }
         
         .page-size-label {
            margin-right: 8px;
            font-size: 14px;
            color: #555;
            padding-left: 4px;
         }
         
         .page-size-select {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            min-width: 60px;
         }
         
         .pagination-info {
            font-size: 14px;
            color: #555;
            padding: 4px 0;
            padding-right: 4px;
            text-align: right;
         }
         
         .pagination-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 8px;
         }
         
         .pagination-nav-buttons,
         .pagination-next-buttons {
            display: flex;
            align-items: center;
            justify-content: center;
         }
         
         .pagination-page-numbers {
            display: flex;
            align-items: center;
            margin: 0 10px;
         }
         
         /* Pagination buttons */
         .pagination-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            padding: 4px 8px;
            margin: 0 3px;
            border: none;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
            box-shadow: none;
            color: #5f6368;
            user-select: none;
            outline: none;
         }
         
         .pagination-button:hover:not(:disabled) {
            background-color: rgba(0, 0, 0, 0.04);
         }
         
         .pagination-button:disabled {
            opacity: 0.5;
            cursor: default;
            color: #bdc1c6;
            background: transparent;
         }
         
         .pagination-button.active {
            background-color: #0071ce;
            color: white;
            font-weight: 500;
         }
         
         .pagination-button.ellipsis {
            color: #5f6368;
            pointer-events: none;
         }
         
         /* Table grouping styles */
         .table-group-controls {
            margin-bottom: 16px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            transition: background-color 0.2s ease, border-color 0.2s ease;
         }
         
         .group-title {
            margin-right: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            color: #333;
            transition: color 0.2s ease;
         }
         
         .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
         }
         
         .group-option {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
         }
         
         .group-option:hover:not(.active) {
            background-color: #f0f0f0;
         }
         
         .group-option.active {
            background-color: #0071ce;
            color: #fff;
            border: 1px solid #0071ce;
            font-weight: 500;
         }
         
         .group-header {
            background-color: #f5f7f9;
            transition: background-color 0.2s ease;
         }
         
         .group-header td {
            padding: 0 !important;
         }
         
         .group-header-content {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #f5f7f9;
            border-radius: 4px;
            transition: background-color 0.2s ease;
         }
         
         .group-toggle {
            margin-right: 8px;
            color: #0071ce;
            transition: color 0.2s ease;
         }
         
         .group-header-title {
            font-weight: 500;
            color: #333;
            transition: color 0.2s ease;
         }
         
         .group-count {
            margin-left: 12px;
            font-size: 0.85em;
            color: #666;
            background-color: rgba(0, 113, 206, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            transition: all 0.2s ease;
         }
         
         .collapsed-row {
            display: none !important;
         }
         
         tr.first-in-group td {
            border-top: 1px solid #e0e0e0;
            transition: border-color 0.2s ease;
         }
         
         .group-header:hover {
            background-color: #eef1f5;
         }
         
         .group-tooltip {
            font-size: 0.75em;
            color: #666;
            margin-left: 8px;
            padding: 2px 6px;
            background: rgba(0, 113, 206, 0.08);
            border-radius: 4px;
            transition: all 0.2s ease;
         }

         /* Dark mode styles for table grouping */
         @media (prefers-color-scheme: dark) {
            body {
               background-color: #1a202c !important;
               color: #e2e8f0 !important;
            }
            
            .table-group-controls {
               background-color: #2d3748 !important;
               border: 1px solid #4a5568 !important;
               box-shadow: none !important;
            }
            
            .group-title {
               color: #cbd5e0 !important;
            }
            
            .group-option {
               background-color: #4a5568 !important;
               border: 1px solid #718096 !important;
               color: #e2e8f0 !important;
               box-shadow: none !important;
            }
            
            .group-option:hover:not(.active) {
               background-color: #718096 !important;
               border-color: #a0aec0 !important;
            }
            
            .group-option.active {
               background-color: #3182ce !important;
               color: #ffffff !important;
               border: 1px solid #3182ce !important;
               box-shadow: none !important;
            }
            
            .group-header {
               background-color: #2d3748 !important;
            }
            
            .group-header-content {
               background-color: #2d3748 !important;
            }
            
            .group-toggle {
               color: #4299e1 !important;
            }
            
            .group-header-title {
               color: #e2e8f0 !important;
            }
            
            .group-count {
               color: #cbd5e0 !important;
               background-color: rgba(66, 153, 225, 0.2) !important;
               border: none !important;
            }
            
            tr.first-in-group td {
               border-top: 1px solid #4a5568 !important;
            }
            
            .group-header:hover {
               background-color: #4a5568 !important;
            }
            
            .group-header:hover .group-header-content {
               background-color: #4a5568 !important;
            }
            
            .group-tooltip {
               color: #cbd5e0 !important;
               background: rgba(66, 153, 225, 0.15) !important;
               border: none !important;
            }
         }

         /* Force dark mode styles - Alternative approach */
         .dark-mode body,
         [data-theme="dark"] body {
            background-color: var(--background-main) !important;
            color: var(--text-primary) !important;
         }

         .dark-mode .footer-wordmark{
            color: var(--text-primary) !important;
         }

         .dark-mode .tab-link
         {
            color: var(--text-primary) !important;
            text-decoration: none !important;
            font-weight: 500 !important;
            transition: color 0.2s ease;
         }
         
         .dark-mode .table-group-controls,
         [data-theme="dark"] .table-group-controls {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
         }
         
         .dark-mode .group-title,
         [data-theme="dark"] .group-title {
            color: var(--text-primary) !important;
         }
         
         .dark-mode .group-option,
         [data-theme="dark"] .group-option {
            background-color: var(--border-color) !important;
            border: none !important;
            color: var(--text-primary) !important;
            box-shadow: none !important;
         }
         
         .dark-mode .group-option:hover:not(.active),
         [data-theme="dark"] .group-option:hover:not(.active) {
            background-color: var(--background-button) !important;
            border-color: none !important;
         }
         
         .dark-mode .group-option.active,
         [data-theme="dark"] .group-option.active {
            background-color: var(--product-accent) !important;
            color: var(--text-primary) !important;
            border: none !important;
            box-shadow: none !important;
         }

         .dark-mode .group-header-content{
            background-color: var(--background-main) !important;
         }

         .dark-mode .group-header-title
         {
            color: var(--text-primary) !important;
         }

         .dark-mode .group-tooltip{
            color: var(--text-primary) !important;
            background-color: var(--border-color) !important;
            border: none !important;
         }

         .dark-mode .group-count{
            background-color: rgba(0, 113, 206, 0.1) !important;
            border: none !important;
            color: rgb(0, 113, 206) !important;
         }

         .dark-mode .floating-toc-link:hover{
            background-color: var(--product-accent) !important;
         }


         .dark-mode .pagination-nav{
            background-color: var(--background-main) !important;          
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
         }

         .dark-mode .pagination-button.page-number {
            color: var(--text-primary) !important;
         }

         .dark-mode .pagination-button.page-number.active {
            background-color: var(--product-accent) !important;
            color: var(--text-primary) !important;
            border: none !important;
            box-shadow: none !important;
         }

         .dark-mode .pagination-button.page-number:hover:not(.active) {
            background-color: var(--product-accent) !important;
            border-color: none !important;
            color: var(--text-primary) !important;
         }

         .dark-mode .pagination-button.next, .dark-mode .pagination-button.prev, .dark-mode .pagination-button.first, .dark-mode .pagination-button.last {
            background-color: var(--background-main) !important;
            border-color: none !important;
            color: var(--text-primary) !important;
         }

         /* Enhanced light mode styles for better contrast */
         @media (prefers-color-scheme: light) {
            .table-group-controls {
               background-color: #ffffff;
               border: 1px solid #e2e8f0;
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }
            
            .group-option {
               background-color: #f8f9fa;
               border: 1px solid #d1d5db;
               color: #374151;
               box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            }
            
            .group-option:hover:not(.active) {
               background-color: #e5e7eb;
               border-color: #9ca3af;
            }
            
            .group-option.active {
               background-color: #0071ce;
               color: #ffffff;
               border: 1px solid #0071ce;
               box-shadow: 0 2px 4px rgba(0, 113, 206, 0.2);
            }
            
            .group-count {
               background-color: rgba(0, 113, 206, 0.1);
               border: 1px solid rgba(0, 113, 206, 0.2);
            }
            
            .group-tooltip {
               background: rgba(0, 113, 206, 0.08);
               border: 1px solid rgba(0, 113, 206, 0.15);
            }
         }

         /* MERMAID DIAGRAM THEMING */
         .mermaid-container {
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            
            /* Use CSS variables for consistent theming */
            background-color: var(--background-main);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
         }

         .mermaid-container svg {
            max-width: 100%;
            height: auto;
            background-color: transparent !important;
         }

         /* Global font styling for all Mermaid diagrams */
         .mermaid-container svg text,
         .mermaid-container svg tspan,
         .mermaid-container svg .nodeLabel,
         .mermaid-container svg .edgeLabel,
         .mermaid-container svg .label,
         .mermaid-container svg .titleText {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
            font-size: 14px !important;
         }

         /* Ensure text visibility in dark mode Mermaid diagrams */
         .dark-mode .mermaid-container svg text,
         [data-theme="dark"] .mermaid-container svg text {
            fill: var(--text-primary) !important;
         }

         .dark-mode .mermaid-container svg .node rect,
         [data-theme="dark"] .mermaid-container svg .node rect {
            stroke: var(--border-color) !important;
         }

         .dark-mode .mermaid-container svg .edgePath path,
         [data-theme="dark"] .mermaid-container svg .edgePath path {
            stroke: var(--border-color) !important;
         }

         /* Light mode Mermaid container */
         @media (prefers-color-scheme: light) {
            .mermaid-container {
               box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
         }

         /* Dark mode Mermaid container */
         @media (prefers-color-scheme: dark) {
            .mermaid-container {
               box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            }
         }

         /* Force dark mode Mermaid styling */
         .dark-mode .mermaid-container,
         [data-theme="dark"] .mermaid-container {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5) !important;
         }

         /* Force light mode Mermaid styling */
         .light-mode .mermaid-container,
         [data-theme="light"] .mermaid-container {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
         }

         /* GOOGLE-LIKE LOADING INDICATOR */
         .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(2px);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
         }

         .loading-overlay.show {
            opacity: 1;
            visibility: visible;
         }

         .loading-dots {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
         }

         .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--background-button);
            margin: 0 3px;
            animation: pulse 1.5s ease-in-out infinite;
         }

         .loading-dot:nth-child(1) { animation-delay: 0s; }
         .loading-dot:nth-child(2) { animation-delay: 0.2s; }
         .loading-dot:nth-child(3) { animation-delay: 0.4s; }
         .loading-dot:nth-child(4) { animation-delay: 0.6s; }

         .loading-text {
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
         }

         .loading-progress {
            width: 200px;
            height: 4px;
            background-color: #e8eaed;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
         }

         .loading-progress-bar {
            height: 100%;
            background-color:var(--background-button);
            border-radius: 2px;
            position: absolute;
            left: -100%;
            animation: progress 2s ease-in-out infinite;
         }

         /* Dark mode loading overlay */
         .dark-mode .loading-overlay,
         [data-theme="dark"] .loading-overlay {
            background-color: var(--background-main);
         }

         .dark-mode .loading-dot,
         [data-theme="dark"] .loading-dot {
            background-color: var(--background-button);
         }

         .dark-mode .loading-text,
         [data-theme="dark"] .loading-text {
            color: var(--text-primary);
         }

         .dark-mode .loading-progress,
         [data-theme="dark"] .loading-progress {
            background-color: var(--background-main);
         }

         .dark-mode .loading-progress-bar,
         [data-theme="dark"] .loading-progress-bar {
            background-color: var(--background-button);
         }

         /* Animations */
         @keyframes pulse {
            0%, 20% { 
               transform: scale(1); 
               opacity: 1; 
            }
            50% { 
               transform: scale(1.3); 
               opacity: 0.7; 
            }
            80%, 100% { 
               transform: scale(1); 
               opacity: 1; 
            }
         }

         @keyframes progress {
            0% {
               left: -100%;
               width: 0%;
            }
            50% {
               left: 0%;
               width: 100%;
            }
            100% {
               left: 100%;
               width: 0%;
            }
         }

         /* Loading indicator for specific sections */
         .section-loading {
            position: relative;
         }

         .section-loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(1px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
         }

         .dark-mode .section-loading::after,
         [data-theme="dark"] .section-loading::after {
            background-color: rgba(26, 32, 44, 0.8);
         }
      </style>
     
      <!-- Table sorting and grouping functionality -->
      <script>
         // --- MERMAID DIAGRAM RENDERING ---
         
         // Loading indicator management
         let loadingTasks = new Set();
         
         function showLoading(message = 'Loading...', taskId = 'default') {
             const overlay = document.getElementById('loadingOverlay');
             const loadingText = document.getElementById('loadingText');
             
             if (overlay && loadingText) {
                 loadingTasks.add(taskId);
                 loadingText.textContent = message;
                 overlay.classList.add('show');
                 console.log(`Loading started: ${message} (task: ${taskId})`);
             }
         }
         
         function hideLoading(taskId = 'default') {
             loadingTasks.delete(taskId);
             console.log(`Loading task completed: ${taskId}, ${loadingTasks.size} tasks remaining`);
             
             // Only hide if no other tasks are running
             if (loadingTasks.size === 0) {
                 const overlay = document.getElementById('loadingOverlay');
                 if (overlay) {
                     // Add a small delay to prevent flicker for quick operations
                     setTimeout(() => {
                         // Double-check that no new tasks were added during the delay
                         if (loadingTasks.size === 0) {
                             overlay.classList.remove('show');
                             console.log(`All loading tasks completed - hiding overlay`);
                         }
                     }, 100); // Reduced delay from 300ms to 100ms
                 }
             }
         }
         
         function updateLoadingMessage(message, taskId = 'default') {
             if (loadingTasks.has(taskId)) {
                 const loadingText = document.getElementById('loadingText');
                 if (loadingText) {
                     loadingText.textContent = message;
                 }
             }
         }

         function initializeMermaidRendering() {
             showLoading('Initializing diagram renderer...', 'mermaid-init');
             
             try {
                 // Detect current theme
                 const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                                   window.matchMedia('(prefers-color-scheme: dark)').matches;
                 
                 // Get theme-specific configuration
                 const themeConfig = getMermaidThemeConfig(isDarkMode);
                 
                 updateLoadingMessage('Configuring diagram themes...', 'mermaid-init');
                 
                 // Configure Mermaid with comprehensive theme settings
                 mermaid.initialize({
                     startOnLoad: false, // Important! We manually control the rendering
                     securityLevel: 'loose', // Allow all diagram features
                     htmlLabels: true, // Enable HTML labels for better text rendering
                     theme: themeConfig.theme,
                     themeVariables: themeConfig.themeVariables,
                     flowchart: {
                         useMaxWidth: true,
                         htmlLabels: true,
                         curve: 'basis'
                     },
                     sequence: {
                         useMaxWidth: true,
                         wrap: true
                     },
                     class: {
                         useMaxWidth: true
                     },
                     state: {
                         useMaxWidth: true
                     },
                     er: {
                         useMaxWidth: true
                     },
                     journey: {
                         useMaxWidth: true
                     },
                     gantt: {
                         useMaxWidth: true
                     },
                     pie: {
                         useMaxWidth: true
                     },
                     // Simplified configuration - remove complex settings that might cause issues
                     logLevel: 'error',
                     suppressErrorRendering: false
                 });
                 console.log(`Mermaid initialized successfully with ${isDarkMode ? 'dark' : 'light'} theme`);
                 hideLoading('mermaid-init');
             } catch (error) {
                 console.error('Error initializing Mermaid:', error);
                 hideLoading('mermaid-init');
             }
         }

         // Get comprehensive theme configuration for Mermaid
         function getMermaidThemeConfig(isDarkMode) {
             // Get CSS variables from the document
             const rootStyles = getComputedStyle(document.documentElement);
             const backgroundMain = rootStyles.getPropertyValue('--background-main').trim();
             const textPrimary = rootStyles.getPropertyValue('--text-primary').trim();
             const textSecondary = rootStyles.getPropertyValue('--text-secondary').trim();
             const borderColor = rootStyles.getPropertyValue('--border-color').trim();
             const backgroundCard = rootStyles.getPropertyValue('--background-card').trim();
             const backgroundHover = rootStyles.getPropertyValue('--background-hover').trim();
             const productAccent = rootStyles.getPropertyValue('--product-accent').trim();
             
             if (isDarkMode) {
                 return {
                     theme: 'dark',
                     themeVariables: {
                         // Core theme colors using CSS variables
                         darkMode: true,
                         background: backgroundMain,
                         primaryColor: productAccent, // Use the accent color for primary elements
                         primaryTextColor: textPrimary,
                         primaryBorderColor: borderColor,
                         lineColor: borderColor,
                         
                         // Font configuration
                         fontFamily: "'Roboto', 'Segoe UI', Arial, sans-serif",
                         fontSize: '14px',
                         
                         // Secondary colors
                         secondaryColor: backgroundCard,
                         tertiaryColor: backgroundHover,
                         
                         // Text colors - all using CSS variables
                         textColor: textPrimary,
                         darkTextColor: textPrimary,
                         mainBkg: backgroundCard,
                         secondBkg: backgroundHover,
                         tertiaryBkg: backgroundMain,
                         
                         // Node and connector styling
                         nodeBkg: backgroundCard,
                         nodeBorder: borderColor,
                         clusterBkg: backgroundMain,
                         clusterBorder: borderColor,
                         defaultLinkColor: productAccent,
                         titleColor: textPrimary,
                         edgeLabelBackground: backgroundMain,
                         
                         // Specific diagram type colors
                         actorBorder: borderColor,
                         actorBkg: backgroundCard,
                         actorTextColor: textPrimary,
                         actorLineColor: borderColor,
                         signalColor: textPrimary,
                         signalTextColor: textPrimary,
                         
                         // Flowchart colors - readable and distinguishable
                         fillType0: '#4285f4', // Blue - good contrast in dark mode
                         fillType1: '#81c995', // Light green
                         fillType2: '#fdd663', // Yellow
                         fillType3: '#f28b82', // Light red
                         fillType4: '#ce93d8', // Light purple
                         fillType5: '#ffab91', // Light orange
                         fillType6: '#80deea', // Light cyan
                         fillType7: '#a5d6a7', // Another green shade
                         
                         // Class diagram colors
                         classText: textPrimary,
                         
                         // State diagram colors
                         labelColor: textPrimary,
                         altBackground: backgroundCard,
                         
                         // ER diagram colors
                         entityBkg: backgroundCard,
                         entityTextColor: textPrimary,
                         relationLabelColor: textPrimary,
                         
                         // Journey diagram colors
                         taskBkgColor: backgroundCard,
                         taskTextColor: textPrimary,
                         activeTaskBkgColor: productAccent,
                         activeTaskBorderColor: borderColor,
                         gridColor: borderColor,
                         section0: '#4285f4',
                         section1: '#81c995',
                         section2: '#fdd663',
                         section3: '#f28b82'
                     }
                 };
             } else {
                 return {
                     theme: 'default',
                     themeVariables: {
                         // Core theme colors using CSS variables
                         background: backgroundMain,
                         primaryColor: productAccent,
                         primaryTextColor: textPrimary,
                         primaryBorderColor: borderColor,
                         lineColor: borderColor,
                         
                         // Font configuration
                         fontFamily: "'Roboto', 'Segoe UI', Arial, sans-serif",
                         fontSize: '14px',
                         
                         // Secondary colors
                         secondaryColor: backgroundCard,
                         tertiaryColor: backgroundHover,
                         
                         // Text colors - all using CSS variables
                         textColor: textPrimary,
                         darkTextColor: textPrimary,
                         mainBkg: backgroundCard,
                         secondBkg: backgroundHover,
                         tertiaryBkg: backgroundMain,
                         
                         // Node and connector styling
                         nodeBkg: backgroundCard,
                         nodeBorder: borderColor,
                         clusterBkg: backgroundMain,
                         clusterBorder: borderColor,
                         defaultLinkColor: productAccent,
                         titleColor: textPrimary,
                         edgeLabelBackground: backgroundMain,
                         
                         // Specific diagram type colors
                         actorBorder: borderColor,
                         actorBkg: backgroundCard,
                         actorTextColor: textPrimary,
                         actorLineColor: borderColor,
                         signalColor: textPrimary,
                         signalTextColor: textPrimary,
                         
                         // Flowchart colors - readable in light mode
                         fillType0: '#0071ce', // Primary blue
                         fillType1: '#1e8e3e', // Green
                         fillType2: '#f9ab00', // Amber/Yellow
                         fillType3: '#d93025', // Red
                         fillType4: '#9c27b0', // Purple
                         fillType5: '#ff5722', // Deep orange
                         fillType6: '#00acc1', // Cyan
                         fillType7: '#689f38', // Light green
                         
                         // Class diagram colors
                         classText: textPrimary,
                         
                         // State diagram colors
                         labelColor: textPrimary,
                         altBackground: backgroundCard,
                         
                         // ER diagram colors
                         entityBkg: backgroundCard,
                         entityTextColor: textPrimary,
                         relationLabelColor: textPrimary,
                         
                         // Journey diagram colors
                         taskBkgColor: backgroundCard,
                         taskTextColor: textPrimary,
                         activeTaskBkgColor: productAccent,
                         activeTaskBorderColor: borderColor,
                         gridColor: borderColor,
                         section0: '#0071ce',
                         section1: '#1e8e3e',
                         section2: '#f9ab00',
                         section3: '#d93025'
                     }
                 };
             }
         }

         function renderMermaidDiagrams() {
             // Find all mermaid code blocks - be more specific in the selector
             const mermaidBlocks = document.querySelectorAll('pre.mermaid');
             
             if (mermaidBlocks.length === 0) {
                 console.log('No Mermaid diagrams found to render');
                 return;
             }
             
             showLoading(`Preparing ${mermaidBlocks.length} diagram${mermaidBlocks.length > 1 ? 's' : ''}...`, 'mermaid-render');
             console.log(`Found ${mermaidBlocks.length} Mermaid diagrams to render`);
             
             let processedCount = 0;
             let successCount = 0;
             let errorCount = 0;
             
             const updateProgress = () => {
                 processedCount++;
                 updateLoadingMessage(
                     `Rendering diagrams... ${processedCount}/${mermaidBlocks.length} (${successCount} successful, ${errorCount} errors)`,
                     'mermaid-render'
                 );
                 
                 // Hide loading when all diagrams are processed
                 if (processedCount >= mermaidBlocks.length) {
                     clearTimeout(maxTimeout); // Clear the fallback timeout
                     setTimeout(() => {
                         hideLoading('mermaid-render');
                     }, 200); // Small delay to show completion message
                 }
             };
             
             // Set a maximum timeout to ensure loading doesn't hang indefinitely
             const maxTimeout = setTimeout(() => {
                 console.warn('Forcing loading to complete after maximum timeout');
                 hideLoading('mermaid-render');
             }, 30000); // 30 second maximum timeout
             
             mermaidBlocks.forEach((preBlock, index) => {
                 try {
                     // Skip if already processed
                     if (preBlock.classList.contains('mermaid-processed')) {
                         console.log(`Skipping diagram ${index + 1} - already processed`);
                         updateProgress(); // Still count this as processed
                         return;
                     }
                     
                     // Check if there's already a rendered container
                     const existingContainer = preBlock.nextElementSibling?.classList.contains('mermaid-container') ||
                                             preBlock.previousElementSibling?.classList.contains('mermaid-container');
                     if (existingContainer) {
                         console.log(`Skipping diagram ${index + 1} - container already exists`);
                         updateProgress(); // Still count this as processed
                         return;
                     }
                     
                     // Get the code element inside the pre block
                     const codeElement = preBlock.querySelector('code');
                     if (!codeElement) {
                         console.warn(`No code element found in mermaid block ${index + 1}`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Get the mermaid code content from the code element
                     let mermaidCode = codeElement.textContent || codeElement.innerText;
                     
                     // Skip if empty
                     if (!mermaidCode.trim()) {
                         console.warn(`Empty mermaid code in block ${index + 1}`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Clean up the code
                     mermaidCode = mermaidCode.trim();
                     
                     // Debug: Log the first few lines of the code to verify content
                     const firstLines = mermaidCode.split('\n').slice(0, 3).join('\n');
                     console.log(`Diagram ${index + 1} content preview:`, firstLines);
                     
                     // Validate this is actually Mermaid syntax, not CSS or other content
                     if (mermaidCode.includes('font-family:') || mermaidCode.includes('keyframes') || mermaidCode.includes('.mermaid-')) {
                         console.error(`Block ${index + 1} contains CSS instead of Mermaid syntax, skipping`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Validate and fix common syntax issues
                     mermaidCode = validateAndFixMermaidSyntax(mermaidCode);
                     
                     // Detect diagram type for specific handling
                     const diagramType = detectDiagramType(mermaidCode);
                     console.log(`Rendering ${diagramType} diagram ${index + 1}`);
                     
                     // Create a unique ID for this diagram
                     const diagramId = `mermaid-diagram-${index}-${Date.now()}`;
                     
                     // Create container for the rendered diagram with enhanced styling
                     const container = document.createElement('div');
                     container.id = diagramId;
                     container.className = 'mermaid-container';
                     
                     // Apply CSS variable-based styling that adapts to theme
                     const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                       document.documentElement.getAttribute('data-theme') === 'dark' ||
                                       window.matchMedia('(prefers-color-scheme: dark)').matches;
                     
                     // Use CSS variables for consistent theming
                     container.style.cssText = `
                         text-align: center;
                         margin: 20px 0;
                         padding: 20px;
                         border: 1px solid var(--border-color);
                         border-radius: 8px;
                         background-color: var(--background-main);
                         box-shadow: ${isDarkMode ? '0 2px 8px rgba(0, 0, 0, 0.5)' : '0 2px 4px rgba(0, 0, 0, 0.1)'};
                         overflow-x: auto;
                         transition: background-color 0.3s ease, border-color 0.3s ease;
                     `;
                     
                     // Insert the container after the pre block
                     preBlock.parentNode.insertBefore(container, preBlock.nextSibling);
                     preBlock.style.display = 'none'; // Hide original but keep for reference
                     
                     // Add timeout to prevent hanging
                     const renderTimeout = setTimeout(() => {
                         console.error(`Rendering timeout for ${diagramType} diagram ${index + 1}`);
                         container.innerHTML = `
                             <div style="color: #ff6b35; padding: 20px; text-align: center;">
                                 <strong>Rendering timeout for ${diagramType} diagram</strong><br>
                                 <small>The diagram took too long to render</small>
                             </div>
                         `;
                         errorCount++;
                         updateProgress();
                     }, 10000); // 10 second timeout
                     
                     // Render the diagram
                     mermaid.render(diagramId + '-svg', mermaidCode)
                         .then(({ svg, bindFunctions }) => {
                             clearTimeout(renderTimeout);
                             container.innerHTML = svg;
                             
                             // Apply bind functions if they exist (for interactive elements)
                             if (bindFunctions) {
                                 try {
                                     bindFunctions(container);
                                 } catch (bindError) {
                                     console.warn('Error applying bind functions:', bindError);
                                 }
                             }
                             
                             // Mark as processed
                             preBlock.classList.add('mermaid-processed');
                             
                             // Add diagram type as data attribute
                             container.setAttribute('data-diagram-type', diagramType);
                             
                             console.log(`Successfully rendered ${diagramType} diagram ${index + 1}`);
                             successCount++;
                             updateProgress();
                         })
                         .catch(error => {
                             clearTimeout(renderTimeout);
                             console.error(`Error rendering ${diagramType} diagram ${index + 1}:`, error);
                             
                             // Show detailed error information
                             const errorDetails = error.message || 'Unknown error occurred';
                             const codePreview = mermaidCode.length > 200 ? 
                                 mermaidCode.substring(0, 200) + '...' : 
                                 mermaidCode;
                             
                             container.innerHTML = `
                                 <div style="color: #d32f2f; padding: 20px; text-align: center; border: 1px solid #d32f2f; border-radius: 4px; background-color: #ffebee;">
                                     <strong>Error rendering ${diagramType} diagram:</strong><br>
                                     <small>${errorDetails}</small><br>
                                     <details style="margin-top: 10px;">
                                         <summary>Show diagram code</summary>
                                         <pre style="text-align: left; background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word;">${codePreview}</pre>
                                     </details>
                                 </div>
                             `;
                             errorCount++;
                             updateProgress();
                         });
                         
                 } catch (error) {
                     console.error(`Error processing Mermaid block ${index + 1}:`, error);
                     errorCount++;
                     updateProgress();
                 }
             });
             
             // Fallback: if no diagrams were found or processed, hide loading immediately
             if (mermaidBlocks.length === 0) {
                 console.log('No Mermaid diagrams found');
                 clearTimeout(maxTimeout);
                 hideLoading('mermaid-render');
             }
         }

         function detectDiagramType(code) {
             const trimmedCode = code.trim().toLowerCase();
             
             if (trimmedCode.startsWith('graph') || trimmedCode.startsWith('flowchart')) return 'flowchart';
             if (trimmedCode.startsWith('sequencediagram')) return 'sequence';
             if (trimmedCode.startsWith('classdiagram')) return 'class';
             if (trimmedCode.startsWith('statediagram')) return 'state';
             if (trimmedCode.startsWith('erdiagram')) return 'er';
             if (trimmedCode.startsWith('journey')) return 'user-journey';
             if (trimmedCode.startsWith('gantt')) return 'gantt';
             if (trimmedCode.startsWith('pie')) return 'pie';
             if (trimmedCode.startsWith('gitgraph')) return 'gitgraph';
             if (trimmedCode.startsWith('mindmap')) return 'mindmap';
             if (trimmedCode.startsWith('timeline')) return 'timeline';
             if (trimmedCode.startsWith('quadrantchart')) return 'quadrant';
             if (trimmedCode.startsWith('xychart')) return 'xy';
             if (trimmedCode.startsWith('block')) return 'block';
             if (trimmedCode.startsWith('packet')) return 'packet';
             if (trimmedCode.startsWith('tree')) return 'tree';
             
             return 'unknown';
         }

         function validateAndFixMermaidSyntax(code) {
             let fixedCode = code.trim();
             
             // Remove any HTML entities that might cause issues
             fixedCode = fixedCode
                 .replace(/&amp;/g, '&')
                 .replace(/&lt;/g, '<')
                 .replace(/&gt;/g, '>')
                 .replace(/&#39;/g, "'")
                 .replace(/&quot;/g, '"');
             
             return fixedCode;
         }

         // Update Mermaid theme (used for theme switching)
         function updateMermaidTheme() {
             showLoading('Updating diagram themes...', 'theme-update');
             
             try {
                 // Re-initialize Mermaid with new theme
                 initializeMermaidRendering();
                 
                 // Re-render all diagrams
                 const processedDiagrams = document.querySelectorAll('.mermaid-processed');
                 if (processedDiagrams.length > 0) {
                     updateLoadingMessage('Re-rendering diagrams with new theme...', 'theme-update');
                     
                     // Reset processed state
                     processedDiagrams.forEach(diagram => {
                         diagram.classList.remove('mermaid-processed');
                     });
                     
                     // Remove existing rendered containers
                     const containers = document.querySelectorAll('.mermaid-container');
                     containers.forEach(container => container.remove());
                     
                     // Show original code blocks
                     const hiddenBlocks = document.querySelectorAll('pre.mermaid[style*="display: none"]');
                     hiddenBlocks.forEach(block => {
                         block.style.display = '';
                     });
                     
                     // Re-render
                     renderMermaidDiagrams();
                 }
                 
                 hideLoading('theme-update');
             } catch (error) {
                 console.error('Error updating Mermaid theme:', error);
                 hideLoading('theme-update');
             }
         }
      </script>
   </head>
   <body>
      <!-- Google-like Loading Overlay -->
      <div id="loadingOverlay" class="loading-overlay">
         <div class="loading-dots">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
         </div>
         <div class="loading-text" id="loadingText">Loading...</div>
         <div class="loading-progress">
            <div class="loading-progress-bar"></div>
         </div>
      </div>

      <script>
         document.addEventListener('DOMContentLoaded', function() {
            showLoading('Initializing application...', 'app-init');
            
            // Apply dark mode detection and styling
            updateLoadingMessage('Applying theme settings...', 'app-init');
            applyThemeDetection();
            
            // Initialize Mermaid diagrams
            if (typeof mermaid !== 'undefined') {
               updateLoadingMessage('Setting up diagram renderer...', 'app-init');
               console.log('Initializing Mermaid diagrams...');
               initializeMermaidRendering();
               renderMermaidDiagrams();
            } else {
               console.warn('Mermaid library not loaded');
            }
            
            // Add sorting capability to all tables
            updateLoadingMessage('Preparing interactive tables...', 'app-init');
            makeTablesSortable();
            
            // Add grouping capability to tables with specific columns
            makeTablesGroupable();
            
            // Add pagination to all tables
            makeTablesPaginated();
            
            hideLoading('app-init');
         });
         
         function applyThemeDetection() {
            // Function to apply dark mode
            function applyDarkMode() {
               document.body.classList.add('dark-mode');
               document.documentElement.setAttribute('data-theme', 'dark');
               console.log('Dark mode applied');
               
               // Update Mermaid diagrams theme
               if (typeof updateMermaidTheme === 'function') {
                  setTimeout(updateMermaidTheme, 100);
               }
            }
            
            // Function to apply light mode
            function applyLightMode() {
               document.body.classList.remove('dark-mode');
               document.documentElement.setAttribute('data-theme', 'light');
               console.log('Light mode applied');
               
               // Update Mermaid diagrams theme
               if (typeof updateMermaidTheme === 'function') {
                  setTimeout(updateMermaidTheme, 100);
               }
            }
            
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
               applyDarkMode();
            } else {
               applyLightMode();
            }
            
            // Listen for changes in color scheme preference
            if (window.matchMedia) {
               const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
               mediaQuery.addEventListener('change', function(e) {
                  showLoading('Switching theme...', 'theme-switch');
                  
                  if (e.matches) {
                     updateLoadingMessage('Applying dark theme...', 'theme-switch');
                     applyDarkMode();
                  } else {
                     updateLoadingMessage('Applying light theme...', 'theme-switch');
                     applyLightMode();
                  }
                  
                  // Update Mermaid diagrams with new theme
                  if (typeof updateMermaidTheme === 'function') {
                     updateMermaidTheme();
                  }
                  
                  hideLoading('theme-switch');
               });
            }
         }
         
         function makeTablesPaginated() {
            const tables = document.querySelectorAll('.table-container table');
            const defaultPageSize = 20;
            
            tables.forEach((table) => {
                // Skip tables that shouldn't be paginated
                if (table.classList.contains('no-pagination')) {
                    return;
                }
                
                // Mark table as paginated
                table.setAttribute('data-paginated', 'true');
                table.setAttribute('data-page-size', String(defaultPageSize));
                table.setAttribute('data-current-page', '1');
                
                // Ensure the table has necessary DOM structure
                let tbody = table.querySelector('tbody');
                if (!tbody) {
                    tbody = document.createElement('tbody');
                    
                    // Move all rows that aren't in thead to tbody
                    const rows = Array.from(table.querySelectorAll('tr'));
                    const theadRows = Array.from(table.querySelectorAll('thead tr'));
                    
                    rows.forEach(row => {
                        if (!theadRows.includes(row)) {
                            tbody.appendChild(row);
                        }
                    });
                    
                    table.appendChild(tbody);
                }
                
                // Store the original table data for pagination
                storeTableData(table);
                
                // Add pagination controls
                addPaginationControls(table);
                
                // Initial pagination
                paginateTable(table);
            });
         }
         
         function storeTableData(table) {
            // Store original rows for pagination
            const tbody = table.querySelector('tbody');
            if (!tbody) {
                return;
            }
            
            // Get all rows, including potential group headers
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Function to preserve icon data before storing
            const preserveIconData = (element) => {
                if (!element) return;
                
                const icons = element.querySelectorAll('.icon, .material-symbols-outlined, [class*="icon"]');
                icons.forEach((icon, index) => {
                    // Store the original icon text as a data attribute
                    const iconText = icon.textContent.trim();
                    if (iconText) {
                        icon.setAttribute('data-original-icon-text', iconText);
                        icon.setAttribute('data-icon-index', String(index));
                    }
                    
                    // Ensure proper classes and styling
                    if (!icon.classList.contains('material-symbols-outlined')) {
                        icon.classList.add('material-symbols-outlined');
                    }
                });
            };
            
            // Check if we're dealing with grouped data
            const hasGroups = rows.some(row => row.classList.contains('group-header'));
            
            // Clear previous pagination data to prevent stale data issues
            if (table._paginationGroupData) delete table._paginationGroupData;
            if (table._paginationData) delete table._paginationData;
            
            if (hasGroups) {
                // For grouped tables, we store the data differently
                const groupData = [];
                let currentGroup = null;
                let currentRows = [];
                
                rows.forEach(row => {
                    if (row.classList.contains('group-header')) {
                        // If we have a previous group, store it
                        if (currentGroup) {
                            groupData.push({
                                header: currentGroup,
                                rows: currentRows
                            });
                        }
                        // Start a new group
                        currentGroup = row;
                        currentRows = [];
                    } else {
                        // Add row to current group
                        currentRows.push(row);
                    }
                });
                
                // Don't forget to add the last group
                if (currentGroup) {
                    groupData.push({
                        header: currentGroup,
                        rows: currentRows
                    });
                }
                
                // Preserve icon data for all grouped elements
                groupData.forEach(group => {
                    preserveIconData(group.header);
                    group.rows.forEach(row => {
                        preserveIconData(row);
                    });
                });
                
                // Store the grouped data
                table._paginationGroupData = groupData;
            } else {
                // For regular tables, filter out any potential group headers just to be safe
                const dataRows = rows.filter(row => !row.classList.contains('group-header'));
                
                // Preserve icon data for all rows
                dataRows.forEach(row => {
                    preserveIconData(row);
                });
                
                table._paginationData = dataRows;
            }
         }
         
         function addPaginationControls(table) {
            const tableContainer = table.closest('.table-container');
            if (!tableContainer) return;
            
            // Create pagination container
            const paginationContainer = document.createElement('div');
            paginationContainer.className = 'table-pagination';
            
            // Top controls with page size selector
            const topControls = document.createElement('div');
            topControls.className = 'pagination-top-controls';
            
            const pageSizeSelector = document.createElement('div');
            pageSizeSelector.className = 'page-size-selector';
            
            // Get current page size from table attribute
            const currentPageSize = parseInt(table.getAttribute('data-page-size') || '20', 10);
            
            // Create the page size selector with the current value selected
            pageSizeSelector.innerHTML = `
                <span class="page-size-label">Items per page</span>
                <select class="page-size-select">
                    <option value="5" ${currentPageSize === 5 ? 'selected' : ''}>5</option>
                    <option value="10" ${currentPageSize === 10 ? 'selected' : ''}>10</option>
                    <option value="20" ${currentPageSize === 20 ? 'selected' : ''}>20</option>
                    <option value="50" ${currentPageSize === 50 ? 'selected' : ''}>50</option>
                    <option value="100" ${currentPageSize === 100 ? 'selected' : ''}>100</option>
                </select>
            `;
            
            // Add event listener for page size change
            const pageSizeSelect = pageSizeSelector.querySelector('.page-size-select');
            pageSizeSelect.addEventListener('change', function() {
                const newPageSize = parseInt(this.value);
                
                console.log(`Page size change requested: ${newPageSize} (from ${table.getAttribute('data-page-size')})`);
                
                // DEBUG: Let's see what's currently visible before making changes
                const currentlyVisibleRows = table.querySelectorAll('tbody tr');
                console.log(`Currently visible rows: ${currentlyVisibleRows.length}`);
                currentlyVisibleRows.forEach((row, index) => {
                    const firstCell = row.querySelector('td');
                    if (firstCell) {
                        console.log(`Row ${index + 1}: ${firstCell.textContent.trim()}`);
                    }
                });
                
                // Calculate pagination values  
                const oldPageSize = parseInt(table.getAttribute('data-page-size')) || 20;
                const oldCurrentPage = parseInt(table.getAttribute('data-current-page')) || 1;
                
                // Get total rows first
                let totalRows = 0;
                if (table._paginationGroupData) {
                    table._paginationGroupData.forEach(group => totalRows += group.rows.length);
                } else if (table._paginationData) {
                    totalRows = table._paginationData.length;
                }
                
                console.log(`Total rows in data: ${totalRows}`);
                
                // Calculate which item we're currently starting with
                const currentFirstItem = (oldCurrentPage - 1) * oldPageSize + 1;
                const currentLastItem = Math.min(currentFirstItem + oldPageSize - 1, totalRows);
                console.log(`Current view: items ${currentFirstItem} to ${currentLastItem}`);
                
                // For page size changes, we want to show the same starting item
                // but limit to the new page size
                let newCurrentPage = Math.ceil(currentFirstItem / newPageSize);
                const newTotalPages = Math.max(1, Math.ceil(totalRows / newPageSize));
                newCurrentPage = Math.max(1, Math.min(newCurrentPage, newTotalPages));
                
                // Calculate how many items we should actually show
                const newFirstItem = (newCurrentPage - 1) * newPageSize + 1;
                const newLastItem = Math.min(newFirstItem + newPageSize - 1, totalRows);
                
                console.log(`Page size change: totalRows=${totalRows}, oldPage=${oldCurrentPage}/${Math.ceil(totalRows / oldPageSize)}, newPage=${newCurrentPage}/${newTotalPages}`);
                console.log(`New view should show: items ${newFirstItem} to ${newLastItem} (max ${newPageSize} items)`);
                
                // IMPORTANT: If we're changing to a smaller page size, we might need to show fewer items
                // to maintain the same starting point
                const visibleItemsCount = currentLastItem - currentFirstItem + 1;
                const expectedNewItemsCount = Math.min(newPageSize, visibleItemsCount);
                console.log(`Currently showing ${visibleItemsCount} items, new page size allows ${newPageSize}, should show ${expectedNewItemsCount}`);
                
                // If the current view has fewer items than the new page size,
                // we might need to adjust to show the same number of items
                if (visibleItemsCount < newPageSize) {
                    console.log(`Adjusting to show same number of items (${visibleItemsCount}) instead of full page size (${newPageSize})`);
                }
                
                // Set new values
                table.setAttribute('data-page-size', newPageSize);
                table.setAttribute('data-current-page', newCurrentPage);
                
                // Execute pagination immediately to see the result
                setTimeout(() => {
                    console.log('Executing pagination with new settings');
                    
                    paginateTable(table);
                    
                    // NOTE: Removed emoji replacement - let's preserve original content exactly
                    const newVisibleRows = table.querySelectorAll('tbody tr');
                    console.log(`After pagination - visible rows: ${newVisibleRows.length}`);
                    newVisibleRows.forEach((row, index) => {
                        const firstCell = row.querySelector('td');
                        if (firstCell) {
                            console.log(`New Row ${index + 1}: ${firstCell.textContent.trim()}`);
                        }
                    });
                }, 0);
            });
            
            // Pagination info (showing X-Y of Z)
            const paginationInfo = document.createElement('div');
            paginationInfo.className = 'pagination-info';
            
            topControls.appendChild(pageSizeSelector);
            topControls.appendChild(paginationInfo);
            
            // Pagination navigation
            const paginationNav = document.createElement('div');
            paginationNav.className = 'pagination-nav';
            
            // We'll populate the navigation in the updatePaginationControls function
            
            // Add all elements to the container
            paginationContainer.appendChild(topControls);
            paginationContainer.appendChild(paginationNav);
            
            // Add to the DOM after the table
            tableContainer.appendChild(paginationContainer);
            
            // Initial update of pagination controls
            updatePaginationControls(table);
         }
         
         function paginateTable(table) {
            // Make sure we have valid numeric values for page size and current page
            const pageSize = Math.max(1, parseInt(table.getAttribute('data-page-size') || '20', 10));
            let currentPage = Math.max(1, parseInt(table.getAttribute('data-current-page') || '1', 10));
            const tbody = table.querySelector('tbody');
            
            if (!tbody) {
                return;
            }
            
            // Calculate total rows and total pages to make sure current page is valid
            let totalRows = 0;
            
            // Check if we have pagination data at all
            if (!table._paginationGroupData && !table._paginationData) {
                try {
                    storeTableData(table);
                } catch (error) {
                    console.error('Error storing table data:', error);
                    return;
                }
            }
            
            // Ensure we're not dealing with stale grouped data when we should be in ungrouped mode
            // Check if the table has actual group headers in the DOM
            const hasRealGroupHeaders = tbody.querySelector('.group-header') !== null;
            
            // If we have grouped data in memory but no actual group headers in the DOM, 
            // we need to rebuild the pagination data for the ungrouped state
            if (table._paginationGroupData && !hasRealGroupHeaders) {
                delete table._paginationGroupData;
                storeTableData(table);
            }
            
            // Calculate total rows from whichever data structure we have
            if (table._paginationGroupData) {
                table._paginationGroupData.forEach(group => totalRows += group.rows.length);
            } else if (table._paginationData) {
                totalRows = table._paginationData.length;
            } else {
                // Emergency fallback - get what's in the DOM right now
                const visibleRows = tbody.querySelectorAll('tr:not(.group-header)').length;
                totalRows = visibleRows;
                if (totalRows === 0) return; // Nothing to do if no rows
            }
            
            // Ensure we have at least one page
            const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
            
            // Ensure current page is valid (between 1 and totalPages)
            currentPage = Math.max(1, Math.min(currentPage, totalPages));
            
            // Update the current page attribute if it was adjusted
            if (currentPage !== parseInt(table.getAttribute('data-current-page') || '1', 10)) {
                table.setAttribute('data-current-page', String(currentPage));
            }
            
            // Clear the table body first
            tbody.innerHTML = '';
            
            // SIMPLIFIED APPROACH: Use direct cloning and restore proper Material Icons
            const simpleCloneRow = (originalRow) => {
                if (!originalRow) return null;
                
                // Clone the row
                const cloned = originalRow.cloneNode(true);
                
                // Convert any emojis back to proper Material Icons
                const emojiToIconMap = {
                    '🔴': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' },
                    '🟠': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '🟢': { iconName: 'recommend', classes: 'icon icon-low', title: 'Low/Info' },
                    '✅': { iconName: 'check_circle', classes: 'icon icon-check', title: 'Yes/Used/Supported' },
                    '❌': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '❔': { iconName: 'help', classes: 'icon icon-question', title: 'Uncertain/Likely' },
                    '🟡': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '⚠️': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '⚠': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '✓': { iconName: 'check_circle', classes: 'icon icon-check', title: 'Yes/Used/Supported' },
                    '✗': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '❓': { iconName: 'help', classes: 'icon icon-question', title: 'Uncertain/Likely' },
                    '🔥': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' },
                    '⭕': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '🛑': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' }
                };
                
                // Find all text nodes and spans that might contain emojis
                const walker = document.createTreeWalker(
                    cloned,
                    NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,
                    null,
                    false
                );
                
                const nodesToReplace = [];
                let node;
                
                while (node = walker.nextNode()) {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const text = node.textContent;
                        for (const emoji in emojiToIconMap) {
                            if (text.includes(emoji)) {
                                nodesToReplace.push({
                                    node: node,
                                    emoji: emoji,
                                    iconData: emojiToIconMap[emoji],
                                    text: text
                                });
                                break;
                            }
                        }
                    } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'SPAN') {
                        const text = node.textContent.trim();
                        if (emojiToIconMap[text]) {
                            nodesToReplace.push({
                                node: node,
                                emoji: text,
                                iconData: emojiToIconMap[text],
                                isSpan: true
                            });
                        }
                    }
                }
                
                // Replace emojis with proper Material Icons
                nodesToReplace.forEach(replacement => {
                    if (replacement.isSpan) {
                        // Update span content to proper Material Icon name, use correct semantic classes
                        replacement.node.textContent = replacement.iconData.iconName;
                        replacement.node.className = replacement.iconData.classes + ' material-symbols-outlined';
                        replacement.node.title = replacement.iconData.title;
                        
                        // Apply proper Material Icons styling
                        replacement.node.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                        replacement.node.style.fontVariantEmoji = "text";
                    } else {
                        // For text nodes, create new icon span with correct semantic classes
                        const iconSpan = document.createElement('span');
                        iconSpan.className = replacement.iconData.classes + ' material-symbols-outlined';
                        iconSpan.textContent = replacement.iconData.iconName;
                        iconSpan.title = replacement.iconData.title;
                        iconSpan.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                        iconSpan.style.fontVariantEmoji = "text";
                        
                        // Replace the emoji in the text
                        const newText = replacement.text.replace(replacement.emoji, '');
                        if (newText.trim()) {
                            const textNode = document.createTextNode(newText);
                            replacement.node.parentNode.insertBefore(iconSpan, replacement.node);
                            replacement.node.parentNode.insertBefore(textNode, replacement.node);
                        } else {
                            replacement.node.parentNode.insertBefore(iconSpan, replacement.node);
                        }
                        replacement.node.parentNode.removeChild(replacement.node);
                    }
                });
                
                return cloned;
            };
            
            // Check if we're dealing with grouped data
            if (table._paginationGroupData) {
                // For grouped tables, pagination works differently
                const groupData = table._paginationGroupData;
                let totalRows = 0;
                groupData.forEach(group => totalRows += group.rows.length);
                
                // Calculate pagination
                const totalPages = Math.ceil(totalRows / pageSize);
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = Math.min(startIdx + pageSize, totalRows);
                
                let rowCount = 0;
                let addedRows = 0;
                
                // Add groups and their visible rows
                groupData.forEach(group => {
                    // Check if any rows from this group should be visible
                    const groupStartRow = rowCount;
                    const groupEndRow = rowCount + group.rows.length;
                    
                    // If any rows in this group are visible in the current page
                    if (groupEndRow > startIdx && groupStartRow < endIdx) {
                        // Add the group header
                        const clonedHeader = simpleCloneRow(group.header);
                        tbody.appendChild(clonedHeader);
                        
                        // Add visible rows from this group
                        for (let i = 0; i < group.rows.length; i++) {
                            if (rowCount >= startIdx && rowCount < endIdx) {
                                const clonedRow = simpleCloneRow(group.rows[i]);
                                tbody.appendChild(clonedRow);
                                addedRows++;
                            }
                            rowCount++;
                        }
                    } else {
                        rowCount += group.rows.length;
                    }
                });
                
                // Restore event listeners for group headers
                const groupHeaders = tbody.querySelectorAll('.group-header');
                groupHeaders.forEach(header => {
                    header.addEventListener('click', function() {
                        this.classList.toggle('collapsed');
                        const isCollapsed = this.classList.contains('collapsed');
                        const groupValue = this.getAttribute('data-group');
                        const groupRows = tbody.querySelectorAll(`tr[data-group="${groupValue}"]:not(.group-header)`);
                        
                        groupRows.forEach(row => {
                            if (isCollapsed) {
                                row.classList.add('collapsed-row');
                            } else {
                                row.classList.remove('collapsed-row');
                            }
                        });
                        
                        const icon = this.querySelector('.group-toggle');
                        if (icon) {
                            icon.textContent = isCollapsed ? 'chevron_right' : 'expand_more';
                            icon.className = 'material-symbols-outlined icon group-toggle';
                        }
                    });
                });
            } else {
                // Regular table pagination
                const rows = table._paginationData;
                if (!rows) return;
                
                // Calculate pagination
                const totalPages = Math.ceil(rows.length / pageSize);
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = Math.min(startIdx + pageSize, rows.length);
                
                // Add visible rows
                for (let i = startIdx; i < endIdx; i++) {
                    const clonedRow = simpleCloneRow(rows[i]);
                    tbody.appendChild(clonedRow);
                }
            }
            
            // Always update pagination controls at the end
            console.log('Calling updatePaginationControls...');
            // Force this to run after the current execution context
            // This ensures the table is fully updated before pagination controls are created
            setTimeout(() => {
                updatePaginationControls(table);
                
                // NOTE: Removed emoji replacement to preserve original content structure
            }, 0);
            console.log('=== Finished paginateTable ===');
         }
         
         function updatePaginationControls(table) {
            console.log('=== Starting updatePaginationControls ===');
            
            const pageSize = parseInt(table.getAttribute('data-page-size')) || 20;
            const currentPage = parseInt(table.getAttribute('data-current-page')) || 1;
            const tableContainer = table.closest('.table-container');
            const paginationContainer = tableContainer.querySelector('.table-pagination');
            
            console.log(`updatePaginationControls: pageSize=${pageSize}, currentPage=${currentPage}`);
            
            if (!paginationContainer) {
                console.error('No pagination container found');
                return;
            }
            
            // Find pagination elements
            const paginationInfo = paginationContainer.querySelector('.pagination-info');
            const paginationNav = paginationContainer.querySelector('.pagination-nav');
            
            // Calculate total rows
            let totalRows = 0;
            if (table._paginationGroupData) {
                table._paginationGroupData.forEach(group => totalRows += group.rows.length);
            } else if (table._paginationData) {
                totalRows = table._paginationData.length;
            }
            
            // Calculate pagination values
            const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
            const startItem = totalRows === 0 ? 0 : (currentPage - 1) * pageSize + 1;
            const endItem = Math.min(startItem + pageSize - 1, totalRows);
            
            // Update info text
            if (paginationInfo) {
                paginationInfo.textContent = `Showing ${startItem}-${endItem} of ${totalRows}`;
            }
            
            // Clear existing navigation
            if (paginationNav) {
                paginationNav.innerHTML = '';
            }
            
            console.log(`Final pagination state: totalRows=${totalRows}, pageSize=${pageSize}, totalPages=${totalPages}, currentPage=${currentPage}`);
            
            // Always show pagination nav div, but only add buttons if multiple pages
            if (paginationNav) {                
                console.log(`Pagination nav found, totalPages=${totalPages}`);
                
                // Create page buttons regardless of total pages
                // This ensures pagination controls are always visible after page size change
                console.log('Creating page buttons...');
                createPageButtons(paginationNav, currentPage, totalPages, table);
                
                // Make sure the page size selector shows the correct value
                const pageSizeSelect = paginationContainer.querySelector('.page-size-select');
                if (pageSizeSelect && pageSizeSelect.value != pageSize) {
                    console.log(`Updating page size selector from ${pageSizeSelect.value} to ${pageSize}`);
                    pageSizeSelect.value = pageSize;
                } else {
                    console.log(`Page size selector already shows correct value: ${pageSize}`);
                }
            } else {
                console.error('Pagination nav not found!');
            }
            
            console.log('=== Finished updatePaginationControls ===');
         }
         
         function createPageButtons(container, currentPage, totalPages, table) {
            // Validate inputs
            currentPage = Math.max(1, currentPage);
            totalPages = Math.max(1, totalPages);
            
            // Define button styles
            const buttonStyles = `
                border: none;
                background: transparent;
                color: #5f6368;
                padding: 8px 12px;
                margin: 0 2px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                min-width: 32px;
                min-height: 32px;
            `;
            
            const disabledButtonStyles = `
                opacity: 0.38;
                cursor: not-allowed;
                pointer-events: none;
            `;
            
            // Ensure we have at least one page
            totalPages = Math.max(1, totalPages);
            
            // Create a div to hold the navigation buttons
            const navButtonsContainer = document.createElement('div');
            navButtonsContainer.className = 'pagination-nav-buttons';
            
            // First page button
            const firstBtn = document.createElement('button');
            firstBtn.className = 'pagination-button first';
            firstBtn.innerHTML = '<span class="material-symbols-outlined icon">first_page</span>';
            firstBtn.title = 'First Page';
            firstBtn.disabled = currentPage === 1;
            firstBtn.style.cssText = buttonStyles + (currentPage === 1 ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const firstIcon = firstBtn.querySelector('span');
            if (firstIcon) {
                firstIcon.setAttribute('data-original-icon-text', 'first_page');
                firstIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                firstIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            firstBtn.addEventListener('mouseover', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            firstBtn.addEventListener('mouseout', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            firstBtn.addEventListener('click', () => {
                table.setAttribute('data-current-page', '1');
                paginateTable(table);
            });
            navButtonsContainer.appendChild(firstBtn);
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-button prev';
            prevBtn.innerHTML = '<span class="material-symbols-outlined icon">chevron_left</span>';
            prevBtn.title = 'Previous Page';
            prevBtn.disabled = currentPage === 1;
            prevBtn.style.cssText = buttonStyles + (currentPage === 1 ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const prevIcon = prevBtn.querySelector('span');
            if (prevIcon) {
                prevIcon.setAttribute('data-original-icon-text', 'chevron_left');
                prevIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                prevIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            prevBtn.addEventListener('mouseover', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            prevBtn.addEventListener('mouseout', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            prevBtn.addEventListener('click', () => {
                const newPage = Math.max(1, currentPage - 1);
                table.setAttribute('data-current-page', newPage);
                paginateTable(table);
            });
            navButtonsContainer.appendChild(prevBtn);
            
            // Add the nav buttons container to the main container
            container.appendChild(navButtonsContainer);
            
            // Create a div to hold the page number buttons
            const pageNumbersContainer = document.createElement('div');
            pageNumbersContainer.className = 'pagination-page-numbers';
            pageNumbersContainer.style.display = 'flex';
            pageNumbersContainer.style.alignItems = 'center';
            pageNumbersContainer.style.margin = '0 10px';
            
            // Google-style page numbers (always show current page and some context)
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            // Adjust if we're near the end
            if (endPage === totalPages) {
                startPage = Math.max(1, endPage - 4);
            }
            
            // For single page, ensure we show at least that one page
            if (totalPages === 1) {
                startPage = 1;
                endPage = 1;
            }
            
            // Add ellipsis at start if needed
            if (startPage > 1) {
                const ellipsisStart = document.createElement('span');
                ellipsisStart.className = 'pagination-button ellipsis';
                ellipsisStart.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 36px;
                    height: 36px;
                    margin: 0 4px;
                    font-size: 14px;
                    color: #5f6368;
                `;
                ellipsisStart.textContent = '...';
                pageNumbersContainer.appendChild(ellipsisStart);
            }
            
            // Add page buttons
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-button page-number';
                pageBtn.style.cssText = buttonStyles;
                
                // Add hover effect - Updated Google style
                pageBtn.addEventListener('mouseover', function() {
                    if (i !== currentPage) {
                        this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)'; // Transparent gray hover effect
                        this.style.color = '#202124';
                    }
                });
                
                pageBtn.addEventListener('mouseout', function() {
                    if (i !== currentPage) {
                        this.style.backgroundColor = 'transparent';
                        this.style.color = '#5f6368';
                    }
                });
                
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                    pageBtn.style.backgroundColor = 'var(--product-accent)'; // Google Blue
                    pageBtn.style.color = 'white';
                    pageBtn.style.fontWeight = '500';
                    pageBtn.style.border = 'none';
                }
                
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    table.setAttribute('data-current-page', i);
                    paginateTable(table);
                });
                pageNumbersContainer.appendChild(pageBtn);
            }
            
            // Add ellipsis at end if needed
            if (endPage < totalPages) {
                const ellipsisEnd = document.createElement('span');
                ellipsisEnd.className = 'pagination-button ellipsis';
                ellipsisEnd.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 36px;
                    height: 36px;
                    margin: 0 4px;
                    font-size: 14px;
                    color: #5f6368;
                `;
                ellipsisEnd.textContent = '...';
                pageNumbersContainer.appendChild(ellipsisEnd);
            }
            
            // Add the page numbers container to the main container
            container.appendChild(pageNumbersContainer);
            
            // Create a div for the next/last buttons
            const nextButtonsContainer = document.createElement('div');
            nextButtonsContainer.className = 'pagination-next-buttons';
            nextButtonsContainer.style.display = 'flex';
            nextButtonsContainer.style.alignItems = 'center';
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-button next';
            nextBtn.innerHTML = '<span class="material-symbols-outlined icon">chevron_right</span>';
            nextBtn.title = 'Next Page';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.style.cssText = buttonStyles + (currentPage === totalPages ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const nextIcon = nextBtn.querySelector('span');
            if (nextIcon) {
                nextIcon.setAttribute('data-original-icon-text', 'chevron_right');
                nextIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                nextIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            nextBtn.addEventListener('mouseover', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            nextBtn.addEventListener('mouseout', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            nextBtn.addEventListener('click', () => {
                const newPage = Math.min(totalPages, currentPage + 1);
                table.setAttribute('data-current-page', newPage);
                paginateTable(table);
            });
            nextButtonsContainer.appendChild(nextBtn);
            
            // Last page button
            const lastBtn = document.createElement('button');
            lastBtn.className = 'pagination-button last';
            lastBtn.innerHTML = '<span class="material-symbols-outlined icon">last_page</span>';
            lastBtn.title = 'Last Page';
            lastBtn.disabled = currentPage === totalPages;
            lastBtn.style.cssText = buttonStyles + (currentPage === totalPages ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const lastIcon = lastBtn.querySelector('span');
            if (lastIcon) {
                lastIcon.setAttribute('data-original-icon-text', 'last_page');
                lastIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                lastIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            lastBtn.addEventListener('mouseover', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            lastBtn.addEventListener('mouseout', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            lastBtn.addEventListener('click', () => {
                table.setAttribute('data-current-page', totalPages);
                paginateTable(table);
            });
            nextButtonsContainer.appendChild(lastBtn);
            
            // Add the next buttons container to the main container
            container.appendChild(nextButtonsContainer);
            
            // Fix all icons in the pagination controls
            setTimeout(() => {
                const paginationIcons = container.querySelectorAll('.icon, .material-symbols-outlined');
                paginationIcons.forEach(icon => {
                    if (!icon.classList.contains('material-symbols-outlined')) {
                        icon.classList.add('material-symbols-outlined');
                    }
                    
                    icon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                    icon.style.fontWeight = "normal";
                    icon.style.fontStyle = "normal";
                    icon.style.fontVariantEmoji = "text"; // Prevent emoji rendering
                    
                    const iconText = icon.textContent.trim();
                    if (iconText) {
                        icon.innerHTML = '';
                        icon.textContent = iconText;
                    }
                });
            }, 0);
         }
         
         function makeTablesSortable() {
            const tables = document.querySelectorAll('.table-container table');
            
            tables.forEach(table => {
               const headers = table.querySelectorAll('th');
               
               headers.forEach((header, index) => {
                  // Skip columns that shouldn't be sortable (you can add a 'no-sort' class to specific headers)
                  if (header.classList.contains('no-sort')) return;
                  
                  // Add sorting indicators and cursor pointer
                  header.style.cursor = 'pointer';
                  header.style.position = 'relative';
                  header.setAttribute('data-sort-direction', '');
                  
                  // Create sort indicator element
                  const sortIndicator = document.createElement('span');
                  sortIndicator.className = 'sort-indicator';
                  sortIndicator.innerHTML = '&nbsp;⇕';
                  sortIndicator.style.fontSize = '0.8em';
                  sortIndicator.style.opacity = '0.6';
                  sortIndicator.style.marginLeft = '5px';
                  sortIndicator.style.display = 'inline-block';
                  header.appendChild(sortIndicator);
                  
                  // Add click event
                  header.addEventListener('click', function() {
                     sortTable(table, index, header);
                  });
               });
            });
         }
         
         function makeTablesGroupable() {
            const tables = document.querySelectorAll('.table-container table');
            
            // For debugging - add a small indicator to help identify if function is running
            console.log('Looking for groupable tables...', tables.length);
            
            tables.forEach((table, tableIndex) => {
               // Make sure the table has a thead
               const thead = table.querySelector('thead');
               if (!thead) return;
               
               const headers = Array.from(thead.querySelectorAll('th'));
               let groupableColumnIndices = [];
               
               // Make all columns groupable
               headers.forEach((header, index) => {
                  // Skip columns that shouldn't be groupable (you can add a 'no-group' class to specific headers)
                  if (header.classList.contains('no-group')) return;
                  
                  const headerText = header.textContent.trim();
                  
                  // Skip empty headers
                  if (headerText !== '') {
                     groupableColumnIndices.push({index: index, name: headerText});
                  }
               });
               
               // If there are any columns to group by, add group controls
               if (groupableColumnIndices.length > 0) {
                  addGroupingControlsToTable(table, groupableColumnIndices);
                  console.log(`Added grouping controls to table ${tableIndex+1} with ${groupableColumnIndices.length} columns`);
               }
            });
         }
         
         function addGroupingControlsToTable(table, groupableColumns) {
            const tableContainer = table.closest('.table-container');
            
            // Remove any existing grouping controls to prevent duplicates
            const existingControls = tableContainer.querySelector('.table-group-controls');
            if (existingControls) {
               existingControls.remove();
            }
            
            // Create grouping control panel with improved styling
            const groupingControls = document.createElement('div');
            groupingControls.className = 'table-group-controls';
            groupingControls.style.display = 'flex';
            groupingControls.style.flexWrap = 'wrap';
            groupingControls.style.alignItems = 'center';
            groupingControls.style.padding = '10px 12px';
            groupingControls.style.backgroundColor = '#f8f9fa';
            groupingControls.style.borderRadius = '4px';
            groupingControls.style.border = '1px solid #e0e0e0';
            
            // Add title with icon
            const groupTitle = document.createElement('div');
            groupTitle.className = 'group-title';
            groupTitle.style.marginRight = '16px';
            groupTitle.style.fontWeight = '500';
            groupTitle.style.display = 'flex';
            groupTitle.style.alignItems = 'center';
            
            const icon = document.createElement('span');
            icon.className = 'material-symbols-outlined';
            icon.textContent = 'filter_list';
            icon.style.marginRight = '6px';
            icon.style.fontSize = '20px';
            icon.style.color = '#0071ce';
            
            const titleText = document.createElement('span');
            titleText.textContent = 'Group by:';
            
            groupTitle.appendChild(icon);
            groupTitle.appendChild(titleText);
            groupingControls.appendChild(groupTitle);
            
            // Add controls for each groupable column
            const groupOptions = document.createElement('div');
            groupOptions.className = 'group-options';
            groupOptions.style.display = 'flex';
            groupOptions.style.flexWrap = 'wrap';
            groupOptions.style.gap = '8px';
            
            // Add "None" option with improved styling
            const noneOption = document.createElement('button');
            noneOption.className = 'group-option active';
            noneOption.textContent = 'None';
            noneOption.style.padding = '6px 12px';
            noneOption.style.border = '1px solid #ddd';
            noneOption.style.borderRadius = '4px';
            noneOption.style.backgroundColor = '#fff';
            noneOption.style.cursor = 'pointer';
            noneOption.style.transition = 'all 0.2s ease';
            
            // Active style
            if (noneOption.classList.contains('active')) {
               noneOption.style.backgroundColor = '#0071ce';
               noneOption.style.color = '#fff';
               noneOption.style.border = '1px solid #0071ce';
            }
            
            noneOption.onclick = function(event) {
               // Prevent event propagation
               event.stopPropagation();
               event.preventDefault();
               
               console.log('None option clicked - Starting grouping reset');
               
               try {
                  // Set this option as active first to provide visual feedback
                  setActiveGroupOption(groupOptions, this);
                  
                  // Add a small delay to ensure UI feedback happens before potentially intensive operation
                  setTimeout(() => {
                     // Ensure we clean up all grouping
                     resetGrouping(table);
                     console.log('None option: grouping reset complete');
                  }, 10);
               } catch (error) {
                  console.error('Error handling None option click:', error);
               }
            };
            
            // Add hover effect
            noneOption.onmouseover = function() {
               if (!this.classList.contains('active')) {
                  this.style.backgroundColor = '#f0f0f0';
               }
            };
            noneOption.onmouseout = function() {
               if (!this.classList.contains('active')) {
                  this.style.backgroundColor = '#fff';
               }
            };
            
            groupOptions.appendChild(noneOption);
            
            // Add column options with the same styling
            groupableColumns.forEach(column => {
               const option = document.createElement('button');
               option.className = 'group-option';
               option.textContent = column.name;
               option.style.padding = '6px 12px';
               option.style.border = '1px solid #ddd';
               option.style.borderRadius = '4px';
               option.style.backgroundColor = '#fff';
               option.style.cursor = 'pointer';
               option.style.transition = 'all 0.2s ease';
               
               // Add hover effect
               option.onmouseover = function() {
                  if (!this.classList.contains('active')) {
                     this.style.backgroundColor = '#f0f0f0';
                  }
               };
               option.onmouseout = function() {
                  if (!this.classList.contains('active')) {
                     this.style.backgroundColor = '#fff';
                  }
               };
               
               option.onclick = (event) => {
                  // Prevent event propagation
                  event.stopPropagation();
                  event.preventDefault();
                  
                  console.log(`Group option clicked: ${column.name}`);
                  groupTableByColumn(table, column.index, column.name);
                  setActiveGroupOption(groupOptions, option);
               };
               groupOptions.appendChild(option);
            });
            
            groupingControls.appendChild(groupOptions);
            
            // Insert controls before the table
            tableContainer.insertBefore(groupingControls, table);
         }
         
         function setActiveGroupOption(container, activeButton) {
            console.log('Setting active group option:', activeButton.textContent);
            
            // Remove active class and reset styles from all buttons
            const buttons = container.querySelectorAll('.group-option');
            buttons.forEach(button => {
               button.classList.remove('active');
               button.style.backgroundColor = '#fff';
               button.style.color = '#333';
               button.style.border = '1px solid #ddd';
            });
            
            // Add active class to the selected button
            activeButton.classList.add('active');
            
            // Apply active styles
            activeButton.style.backgroundColor = '#0071ce';
            activeButton.style.color = '#fff';
            activeButton.style.border = '1px solid #0071ce';
            activeButton.style.fontWeight = '500';
         }
         
         function groupTableByColumn(table, columnIndex, columnName) {
            // Implementation for grouping table by column
            
            // Get all rows except header
            const tbody = table.querySelector('tbody');
            if (!tbody) {
               console.error('No tbody found in table during grouping');
               return;
            }
            
            // First, ensure all existing group headers are removed
            const allRows = Array.from(tbody.querySelectorAll('tr'));
            const dataRows = allRows.filter(row => !row.classList.contains('group-header'));
            const existingGroups = tbody.querySelectorAll('.group-header');
            
            console.log(`Found ${allRows.length} total rows, ${dataRows.length} data rows, ${existingGroups.length} existing group headers`);
            
            // Make sure to remove existing group headers properly
            existingGroups.forEach(group => {
               if (group.parentNode) {
                  group.parentNode.removeChild(group);
               }
            });
            
            // Reset all rows to their default state
            dataRows.forEach(row => {
               row.style.display = '';
               row.removeAttribute('data-group');
               row.classList.remove('first-in-group', 'collapsed-row');
            });
            
            // Group the data - use a new empty object for clean grouping
            const groupedData = {};
            
            dataRows.forEach(row => {
               // Ensure we have the right index
               if (columnIndex >= row.cells.length) {
                  console.warn(`Column index ${columnIndex} out of bounds for row`, row);
                  return;
               }
               
               // Extract only the text content and ignore icons
               const cell = row.cells[columnIndex];
               if (!cell) {
                  console.warn(`No cell found at index ${columnIndex} for row`, row);
                  return;
               }
               
               let cellValue = '';
               
               // Function to extract text nodes only (no icon text)
               function extractTextOnly(element) {
                  // Special case for cells with icons + text pattern like "dangerous High"
                  // Try to find any direct text node that is not within an icon element
                  let directTextContent = '';
                  let hasFoundDirectText = false;
                  
                  // First, check if this is a cell with the specific structure we're targeting
                  // This usually means it has both an icon with text and visible text afterward
                  const iconElements = element.querySelectorAll('.icon, .icon-high, .icon-medium, .icon-low');
                  if (iconElements.length > 0) {
                     // Try to find text nodes that are direct children but not part of icons
                     for (let childNode of element.childNodes) {
                        // Text node that's a direct child
                        if (childNode.nodeType === 3 && childNode.textContent.trim()) {
                           directTextContent += childNode.textContent.trim() + ' ';
                           hasFoundDirectText = true;
                        }
                        // If it's a span that doesn't have icon classes, it might contain our text
                        else if (childNode.nodeType === 1 && 
                                !childNode.classList?.contains('icon') && 
                                !childNode.classList?.contains('icon-high') && 
                                !childNode.classList?.contains('icon-medium') && 
                                !childNode.classList?.contains('icon-low')) {
                           // Only extract text if it doesn't contain icon children
                           if (!childNode.querySelector('.icon')) {
                              directTextContent += childNode.textContent.trim() + ' ';
                              hasFoundDirectText = true;
                           }
                        }
                     }
                  }
                  
                  // If we found direct text, use that (this helps with the specific case of "dangerous High")
                  if (hasFoundDirectText) {
                     return directTextContent.trim();
                  }
                  
                  // Otherwise, use the more generic approach
                  let text = '';
                  for (let node of element.childNodes) {
                     if (node.nodeType === 3) { // Text node
                        text += node.textContent.trim() + ' ';
                     } else if (node.nodeType === 1) { // Element node
                        // Skip icon elements, elements with icon class
                        const classList = node.classList ? Array.from(node.classList) : [];
                        const hasIconClass = classList.some(cls => cls === 'icon' || cls.startsWith('icon-'));
                        const isIcon = hasIconClass || 
                                      node.tagName.toLowerCase() === 'i';
                                    
                        if (!isIcon) {
                           text += extractTextOnly(node);
                        }
                     }
                  }
                  return text;
               }
               
               cellValue = extractTextOnly(cell).trim();
               
               // If we couldn't extract text properly, fallback to full text
               if (!cellValue) {
                  cellValue = cell.textContent.trim();
               }
               
               // Handle empty values specially
               const normalizedValue = cellValue || '(Empty)';
               
               // Create the group if it doesn't exist yet
               if (!groupedData[normalizedValue]) {
                  groupedData[normalizedValue] = [];
               }
               
               // Add the row to the group
               groupedData[normalizedValue].push(row);
            });
            
            // Clear the tbody completely to start fresh
            while (tbody.firstChild) {
               tbody.removeChild(tbody.firstChild);
            }
            
            // Create a sorted array of group values
            const groupValues = Object.keys(groupedData).sort();
            console.log(`Created ${groupValues.length} groups`);
            
            // Add rows back with group headers
            groupValues.forEach(groupValue => {
               const rowsInThisGroup = groupedData[groupValue];
               console.log(`Adding group: "${groupValue}" with ${rowsInThisGroup.length} rows`);
               
               // Create group header
               const groupHeader = document.createElement('tr');
               groupHeader.className = 'group-header';
               groupHeader.setAttribute('data-group', groupValue);
               
               const groupCell = document.createElement('td');
               // Get the correct column count from thead
               const headerRow = table.querySelector('thead tr');
               const colCount = headerRow ? headerRow.cells.length : 
                               (rowsInThisGroup.length > 0 ? rowsInThisGroup[0].cells.length : 1);
               groupCell.colSpan = colCount;
               
               const groupContent = document.createElement('div');
               groupContent.className = 'group-header-content';
               groupContent.style.display = 'flex';
               groupContent.style.alignItems = 'center';
               groupContent.style.padding = '8px';
               groupContent.style.backgroundColor = '#f5f7f9';
               groupContent.style.borderRadius = '4px';
               
               const groupIcon = document.createElement('span');
               groupIcon.className = 'material-symbols-outlined icon group-toggle';
               groupIcon.textContent = 'expand_more';
               groupIcon.style.marginRight = '8px';
               groupIcon.style.color = '#0071ce';
               groupIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
               groupIcon.style.fontWeight = 'normal';
               groupIcon.style.fontSize = '20px';
               groupIcon.style.lineHeight = '1';
               groupIcon.style.display = 'flex';
               groupIcon.style.alignItems = 'center';
               groupIcon.style.justifyContent = 'center';
               
               const groupTitle = document.createElement('span');
               groupTitle.className = 'group-header-title';
               groupTitle.textContent = `${columnName}: ${groupValue}`;
               groupTitle.style.fontWeight = '500';
               groupTitle.style.color = '#333';
               
               const groupCount = document.createElement('span');
               groupCount.className = 'group-count';
               groupCount.textContent = `${rowsInThisGroup.length} items`;
               groupCount.style.marginLeft = '12px';
               groupCount.style.fontSize = '0.85em';
               groupCount.style.color = '#666';
               groupCount.style.backgroundColor = 'rgba(0, 113, 206, 0.1)';
               groupCount.style.padding = '2px 8px';
               groupCount.style.borderRadius = '12px';
               
               groupContent.appendChild(groupIcon);
               groupContent.appendChild(groupTitle);
               groupContent.appendChild(groupCount);
               groupCell.appendChild(groupContent);
               groupHeader.appendChild(groupCell);
               
               // Add toggle functionality and make it more obvious
               groupHeader.title = 'Click to expand/collapse group';
               groupHeader.style.cursor = 'pointer';
               
               /* Add tooltip text to make it clear this is collapsible
               const tooltipSpan = document.createElement('span');
               tooltipSpan.className = 'group-tooltip';
               tooltipSpan.textContent = 'Click to expand/collapse';
               tooltipSpan.style.fontSize = '0.75em';
               tooltipSpan.style.color = '#666';
               tooltipSpan.style.marginLeft = '8px';
               tooltipSpan.style.padding = '2px 6px';
               tooltipSpan.style.background = 'rgba(0, 113, 206, 0.08)';
               tooltipSpan.style.borderRadius = '4px';
               groupContent.appendChild(tooltipSpan);*/
               
               groupHeader.addEventListener('click', function(event) {
                  // Prevent event propagation
                  event.stopPropagation();
                  
                  this.classList.toggle('collapsed');
                  const isCollapsed = this.classList.contains('collapsed');
                  const groupValue = this.getAttribute('data-group');
                  
                  // Ensure we're getting the right rows by being more specific with our selector
                  // We need to escape special characters in the group value for the selector
                  const escapedGroupValue = groupValue.replace(/"/g, '\\"');
                  const groupRows = tbody.querySelectorAll(`tr[data-group="${escapedGroupValue}"]:not(.group-header)`);
                  
                  console.log(`Toggle group: "${groupValue}", Collapsed: ${isCollapsed}, Found rows: ${groupRows.length}`);
                  
                  // Toggle row visibility with CSS classes for better performance
                  groupRows.forEach(row => {
                     if (isCollapsed) {
                        row.classList.add('collapsed-row');
                        row.style.display = 'none';
                     } else {
                        row.classList.remove('collapsed-row');
                        row.style.display = '';
                     }
                  });
                  
                  // Update the icon with proper styling
                  const icon = this.querySelector('.group-toggle');
                  if (icon) {
                     icon.textContent = isCollapsed ? 'chevron_right' : 'expand_more';
                     
                     // Ensure consistent icon styling after text change
                     icon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                     icon.style.fontWeight = 'normal';
                     icon.style.fontSize = '20px';
                     icon.style.lineHeight = '1';
                     icon.style.display = 'flex';
                     icon.style.alignItems = 'center';
                     icon.style.justifyContent = 'center';
                  }
                  
                  /* Update tooltip text based on collapsed state
                  const tooltipElement = this.querySelector('.group-tooltip');
                  if (tooltipElement) {
                     tooltipElement.textContent = isCollapsed ? 'Click to expand' : 'Click to collapse';
                  }*/
                  
                  // Show a count of collapsed items when collapsed
                  const existingBadge = this.querySelector('.collapsed-count');
                  if (existingBadge) {
                     existingBadge.remove();
                  }
                  
                  if (isCollapsed) {
                     const count = groupRows.length;
                     const countBadge = document.createElement('span');
                     countBadge.className = 'collapsed-count';
                     countBadge.textContent = `(${count} items hidden)`;
                     countBadge.style.fontSize = '0.7em';
                     countBadge.style.padding = '2px 8px';
                     countBadge.style.backgroundColor = 'rgba(0, 113, 206, 0.15)';
                     countBadge.style.color = 'rgba(0, 113, 206, 0.9)';
                     countBadge.style.borderRadius = '10px';
                     countBadge.style.marginLeft = '10px';
                     countBadge.style.fontWeight = '500';
                     countBadge.style.border = '1px solid rgba(0, 113, 206, 0.3)';
                     
                     const headerContent = this.querySelector('.group-header-content');
                     if (headerContent) {
                        headerContent.appendChild(countBadge);
                     }
                  }
               });
               
               // Add the group header to the tbody
               tbody.appendChild(groupHeader);
               
               // Add the rows for this group with data-group attribute
               groupedData[groupValue].forEach((row, i) => {
                  // Set data-group attribute for proper identification
                  row.setAttribute('data-group', groupValue);
                  
                  // Style the first row in each group differently if needed
                  if (i === 0) {
                     row.classList.add('first-in-group');
                  }
                  
                  // Add the row to the tbody
                  tbody.appendChild(row);
               });
            });
            
            // Make sure we have consistent styles for grouped table
            const style = document.createElement('style');
            style.textContent = `
               .group-header { background-color: #f5f7f9; }
               .group-header td { padding: 0 !important; }
               .group-header-content { padding: 10px; }
               .collapsed-row { display: none; }
               tr.first-in-group td { border-top: 1px solid #e0e0e0; }
               .group-header:hover { background-color: #eef1f5; }
               
               /* Material Icons proper styling */
               .material-symbols-outlined.icon {
                  font-family: 'Material Symbols Outlined', sans-serif !important;
                  font-weight: normal !important;
                  font-style: normal !important;
                  font-size: 20px !important;
                  line-height: 1 !important;
                  display: inline-flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  text-transform: none !important;
                  letter-spacing: normal !important;
                  overflow-wrap: normal !important;
                  white-space: nowrap !important;
                  direction: ltr !important;
                  -webkit-font-smoothing: antialiased !important;
               }
            `;
            
            // Only add the style if it doesn't exist yet
            if (!document.querySelector('style[data-group-styles="true"]')) {
                style.setAttribute('data-group-styles', 'true');
                document.head.appendChild(style);
            }
            
            console.log('Group headers and rows added to table');
            
            // Re-apply pagination if it's enabled
            if (table.hasAttribute('data-paginated')) {
               console.log('Table is paginated, re-applying pagination after grouping');
               // Re-store table data since grouping has changed the structure
               storeTableData(table);
               // Reset to first page and update
               table.setAttribute('data-current-page', '1');
               paginateTable(table);
            }
         }
         
         function resetGrouping(table) {
            console.log('Resetting table grouping - START');
            const tbody = table.querySelector('tbody');
            if (!tbody) {
               console.error('No tbody found in table during resetGrouping');
               return;
            }
            
            try {
               // Backup of all non-header rows (important data rows)
               const allRows = Array.from(tbody.querySelectorAll('tr'));
               const dataRows = allRows.filter(row => !row.classList.contains('group-header'));
               
               console.log(`Found ${allRows.length} total rows, ${dataRows.length} data rows to restore`);
               
               // Make a clean copy of each data row to avoid any reference issues
               const cleanDataRows = dataRows.map(row => {
                  const clonedRow = row.cloneNode(true);
                  
                  // Reset any grouping-related attributes and styling
                  clonedRow.removeAttribute('data-group');
                  clonedRow.classList.remove('first-in-group', 'collapsed-row');
                  clonedRow.style.display = '';
                  
                  // Ensure any row that was hidden is now visible
                  if (row.style.display === 'none') {
                     clonedRow.style.display = '';
                  }
                  
                  return clonedRow;
               });
               
               console.log(`Created ${cleanDataRows.length} clean rows for regrouping`);
               
               // Clear the tbody completely to start fresh
               console.log('Clearing tbody to start fresh');
               while (tbody.firstChild) {
                  tbody.removeChild(tbody.firstChild);
               }
               
               // Re-add all data rows in their original order with clean state
               console.log('Re-adding clean data rows to table');
               cleanDataRows.forEach(row => tbody.appendChild(row));
               
               // Re-apply pagination if it's enabled
               if (table.hasAttribute('data-paginated')) {
                  console.log('Table is paginated, restoring pagination after group reset');
                  // Re-store table data since we've reset the grouping
                  storeTableData(table);
                  // Reset to first page and update
                  table.setAttribute('data-current-page', '1');
                  paginateTable(table);
               }
               
               console.log('Resetting table grouping - COMPLETE');
            } catch (error) {
               console.error('Error in resetGrouping:', error);
            }
         }
         
         function sortTable(table, columnIndex, header) {
            const sortDirection = header.getAttribute('data-sort-direction');
            const newDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            
            // Reset all headers
            const headers = table.querySelectorAll('th');
            headers.forEach(h => {
               h.setAttribute('data-sort-direction', '');
               const indicator = h.querySelector('.sort-indicator');
               if (indicator) indicator.innerHTML = '&nbsp;⇕';
               indicator.style.opacity = '0.6';
            });
            
            // Set current header
            header.setAttribute('data-sort-direction', newDirection);
            const sortIndicator = header.querySelector('.sort-indicator');
            sortIndicator.innerHTML = newDirection === 'asc' ? '&nbsp;↑' : '&nbsp;↓';
            sortIndicator.style.opacity = '1';
            
            // Check if table is grouped
            const tbody = table.querySelector('tbody');
            const groupHeaders = tbody.querySelectorAll('.group-header');
            
            if (groupHeaders.length > 0) {
               // Table is grouped, sort within each group
               const groups = {};
               
               // Collect all groups
               groupHeaders.forEach(header => {
                  const groupValue = header.getAttribute('data-group');
                  groups[groupValue] = [];
                  
                  // Find all rows in this group
                  const groupRows = tbody.querySelectorAll(`tr[data-group="${groupValue}"]:not(.group-header)`);
                  groupRows.forEach(row => groups[groupValue].push(row));
                  
                  // Sort rows in this group
                  groups[groupValue].sort((rowA, rowB) => {
                     const cellA = rowA.cells[columnIndex].textContent.trim();
                     const cellB = rowB.cells[columnIndex].textContent.trim();
                     
                     // Check if values are numbers
                     const numA = parseFloat(cellA);
                     const numB = parseFloat(cellB);
                     
                     if (!isNaN(numA) && !isNaN(numB)) {
                        return newDirection === 'asc' ? numA - numB : numB - numA;
                     } else {
                        // String comparison
                        return newDirection === 'asc' 
                           ? cellA.localeCompare(cellB) 
                           : cellB.localeCompare(cellA);
                     }
                  });
                  
                  // Remove existing rows
                  groupRows.forEach(row => {
                     tbody.removeChild(row);
                  });
                  
                  // Insert sorted rows after their group header
                  let insertAfter = header;
                  const isGroupCollapsed = header.classList.contains('collapsed');
                  
                  groups[groupValue].forEach((row, idx) => {
                     // Preserve the collapsed state from the group header
                     if (isGroupCollapsed) {
                        row.classList.add('collapsed-row');
                     } else {
                        row.classList.remove('collapsed-row');
                     }
                     
                     // Add first-in-group class to the first row
                     if (idx === 0) {
                        row.classList.add('first-in-group');
                     } else {
                        row.classList.remove('first-in-group');
                     }
                     
                     if (insertAfter.nextSibling) {
                        tbody.insertBefore(row, insertAfter.nextSibling);
                     } else {
                        tbody.appendChild(row);
                     }
                     insertAfter = row;
                  });
               });
               
            } else {
               // Normal sorting (no groups)
               const rows = Array.from(tbody.querySelectorAll('tr'));
               
               // Sort rows
               rows.sort((rowA, rowB) => {
                  const cellA = rowA.cells[columnIndex].textContent.trim();
                  const cellB = rowB.cells[columnIndex].textContent.trim();
                  
                  // Check if values are numbers
                  const numA = parseFloat(cellA);
                  const numB = parseFloat(cellB);
                  
                  if (!isNaN(numA) && !isNaN(numB)) {
                     return newDirection === 'asc' ? numA - numB : numB - numA;
                  } else {
                     // String comparison
                     return newDirection === 'asc' 
                        ? cellA.localeCompare(cellB) 
                        : cellB.localeCompare(cellA);
                  }
               });
               
               // Remove existing rows
               rows.forEach(row => tbody.removeChild(row));
               
               // Add sorted rows
               rows.forEach(row => tbody.appendChild(row));
            }
            
            // Re-apply pagination if it's enabled
            if (table.hasAttribute('data-paginated')) {
               // Re-store table data since sorting has changed the structure
               storeTableData(table);
               paginateTable(table);
            }
            
            // Add a highlight effect on sorting
            tbody.style.transition = 'background-color 0.3s ease';
            tbody.style.backgroundColor = 'rgba(0, 113, 206, 0.05)';
            setTimeout(() => {
               tbody.style.backgroundColor = '';
            }, 500);
         }
      </script>

      <style>
         :root {
         /* Light Theme */
         --cgd-blue: #0071CE;
         --product-accent: #0071CE;
         --product-accent-hover: #00559A;
         --text-primary: #202124;
         --text-secondary: #5f6368;
         --border-color: #dadce0;
         --background-main: #f8f9fa;
         --background-card: #ffffff;
         --background-hover: #f1f3f4;
         --background-button: #0071CE;
         --background-button-text: #ffffff;
         /* Icon Colors */
         --color-red: #d93025;
         --color-amber: #f9ab00;
         --color-green: #1e8e3e;
         }
        html.dark-mode {
         /* Dark Theme - Improved for better visibility and contrast */
         --product-accent: #4285f4;
         --product-accent-hover: #5294ff;
         --text-primary: #ffffff;
         --text-secondary: #ffffff;
         --border-color: #5f6368;
         --background-main: #1a1a1a;
         --background-card: #2d2d2d;
         --background-hover: #404040;
         --background-button: #4285f4;
         --background-button-text: #ffffff;
         /* Improved Icon Colors for dark mode */
         --color-red: #f28b82;
         --color-amber: #fdd663;
         --color-green: #81c995;
         }
         html {
         color: var(--text-primary);
         background-color: var(--background-main);
         box-sizing: border-box;
         scroll-behavior: smooth;
         }
         *, *::before, *::after { box-sizing: inherit; }
         body {
         margin: 0; padding: 0; width: 100%;
         font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
         font-size: 14px; line-height: 1.6;
         text-rendering: optimizeLegibility;
         overflow-x: hidden;
         text-align: left;
         color: var(--text-primary);
         background-color: var(--background-main);
         transition: background-color 0.3s ease, color 0.3s ease;
         }
         /* --- HEADER --- */
         /* --- READING PROGRESS INDICATOR --- */
         .reading-progress {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 3px;
         background-color: rgba(0, 113, 206, 0.1);
         z-index: 103;
         opacity: 0;
         transition: opacity 0.3s ease;
         }
         .reading-progress.show {
         opacity: 1;
         }
         .reading-progress-fill {
         height: 100%;
         background: linear-gradient(90deg, var(--product-accent) 0%, #00559A 100%);
         width: 0%;
         transition: width 0.1s ease-out;
         border-radius: 0 2px 2px 0;
         box-shadow: 0 0 10px rgba(0, 113, 206, 0.3);
         }
         .reading-progress-text {
         position: fixed;
         top: 8px;
         right: 20px;
         background-color: var(--background-card);
         color: var(--text-secondary);
         font-size: 0.75rem;
         font-weight: 500;
         padding: 0.25rem 0.5rem;
         border-radius: 12px;
         border: 1px solid var(--border-color);
         z-index: 104;
         opacity: 0;
         visibility: hidden;
         transition: all 0.3s ease;
         backdrop-filter: blur(8px);
         }
         .reading-progress-text.show {
         opacity: 1;
         visibility: visible;
         }
         .header {
         background-color: var(--background-card);
         box-shadow: 0 1px 2px rgba(0,0,0,0.1);
         position: sticky;
         top: 0;
         z-index: 102;
         width: 100%;
         border-bottom: 1px solid var(--border-color);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .header-container {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 0.5rem 1.5rem; /* Reduced padding */
         max-width: 100%;
         margin: 0 auto;
         }
         .header-brand { display: flex; align-items: center; }
         .header-logo { height: 38px; margin-right: 1rem; }
         .header-title { font-size: 18px; font-weight: 600; color: var(--cgd-blue); padding: 0; }
         .header-controls { display: flex; align-items: center; gap: 0.5rem; }
         .support-button {
         background-color: var(--background-button);
         color: var(--background-button-text);
         border: 1px solid transparent;
         border-radius: 4px;
         padding: 8px 16px;
         font-size: 14px;
         font-weight: 500;
         text-decoration: none;
         cursor: pointer;
         transition: background-color 0.2s ease, box-shadow 0.2s ease;
         margin-left: 1rem;
         }
         .support-button:hover {
         background-color: var(--product-accent-hover);
         box-shadow: 0 1px 3px rgba(0,0,0,0.1);
         }
         .icon-button {
         background: none; border: none; cursor: pointer;
         padding: 8px; border-radius: 50%;
         display: inline-flex; align-items: center; justify-content: center;
         color: var(--text-secondary);
         transition: background-color 0.2s ease, color 0.2s ease;
         }
         .icon-button:hover { background-color: var(--background-hover); color: var(--text-primary); }
         .icon-button .icon { margin: 0; vertical-align: -6px; }
         /* --- MAIN CONTENT & TYPOGRAPHY --- */
         .content { max-width: 100%; padding: 0 1.5rem; margin: 0 auto; }
         .product-header {
         background-color: var(--background-card);
         padding: 2rem 1.5rem;
         margin-bottom: 0;
         border-bottom: 1px solid var(--border-color);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .document-meta {
         display: flex;
         align-items: center;
         gap: 1rem;
         margin-top: 0.5rem;
         color: var(--text-secondary);
         font-size: 0.875rem;
         }
         .read-time { display: flex; align-items: center; gap: 0.25rem; }
         .read-time .icon { font-size: 18px; vertical-align: -4px; }
         h1, h2, h3, h4 { color: var(--text-primary); text-align: left; font-weight: 600; margin-bottom: 1rem; }
         h1 { margin-top: 0; font-size: 2.25rem; padding-bottom: 0.5rem; }
         h2 { font-size: 1.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease; }
         h3 { font-size: 1.4rem; }
         h4 { font-size: 1.2rem; }
         p { margin: 1rem 0; color: var(--text-secondary); }
         /* --- ICON STYLES --- */
         .icon { font-family: 'Material Symbols Outlined', sans-serif; font-weight: normal; font-style: normal; font-size: 20px; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; word-wrap: normal; direction: ltr; -webkit-font-smoothing: antialiased; vertical-align: -5px; margin-right: 0.07em; }
         .icon-high { color: var(--color-red); }
         .icon-medium { color: var(--color-amber); }
         .icon-low { color: var(--color-green); }
         .icon-check { color: var(--color-green); }
         .icon-cross { color: var(--color-red); }
         .icon-question { color: var(--text-secondary); }
         /* --- BREADCRUMB NAVIGATION --- */
         .breadcrumb-container {
         background-color: var(--background-main);
         border-top: 1px solid var(--border-color);
         padding: 0.5rem 1.5rem;
         transition: all 0.3s ease;
         }
         .breadcrumb {
         display: flex;
         align-items: center;
         flex-wrap: wrap;
         gap: 0.5rem;
         font-size: 0.8rem;
         color: var(--text-secondary);
         max-width: 1200px;
         margin: 0 auto;
         }
         .breadcrumb-item {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         }
         .breadcrumb-link {
         color: var(--text-secondary);
         text-decoration: none;
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         transition: all 0.2s ease;
         cursor: pointer;
         }
         .breadcrumb-link:hover {
         color: var(--product-accent);
         background-color: var(--background-hover);
         }
         .breadcrumb-link.active {
         color: var(--product-accent);
         font-weight: 500;
         background-color: rgba(0, 113, 206, 0.1);
         }
         .breadcrumb-separator {
         color: var(--border-color);
         font-size: 0.75rem;
         margin: 0 0.25rem;
         }
         .breadcrumb-home {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         color: var(--text-secondary);
         text-decoration: none;
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         transition: all 0.2s ease;
         }
         .breadcrumb-home:hover {
         color: var(--product-accent);
         background-color: var(--background-hover);
         }
         .breadcrumb-home .icon {
         font-size: 16px;
         }
         .breadcrumb-section-info {
         margin-left: auto;
         display: flex;
         align-items: center;
         gap: 1rem;
         font-size: 0.8rem;
         color: var(--text-secondary);
         }
         .breadcrumb-progress {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         }
         .breadcrumb-progress-bar {
         width: 60px;
         height: 4px;
         background-color: var(--border-color);
         border-radius: 2px;
         overflow: hidden;
         }
         .breadcrumb-progress-fill {
         height: 100%;
         background-color: var(--product-accent);
         width: 0%;
         transition: width 0.3s ease;
         }
         /* Mobile adjustments for breadcrumb */
         @media (max-width: 768px) {
         .breadcrumb-container {
         padding: 0.4rem 1rem;
         }
         .breadcrumb {
         font-size: 0.75rem;
         }
         .breadcrumb-section-info {
         display: none;
         }
         .breadcrumb-link {
         padding: 0.2rem 0.4rem;
         }
         }
         @media (max-width: 480px) {
         .breadcrumb-container {
         padding: 0.3rem 1rem;
         }
         .breadcrumb {
         font-size: 0.7rem;
         gap: 0.25rem;
         }
         .breadcrumb-link {
         padding: 0.15rem 0.3rem;
         max-width: 100px;
         overflow: hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
         }
         }
         /* --- TAB STYLES --- */
         .tab-navigation-container {
         position: sticky; top: 62px; /* After header (which now includes breadcrumb) */
         background-color: var(--background-card);
         z-index: 101;
         border-bottom: 1px solid var(--border-color);
         width: 100vw; margin-left: calc(-50vw + 50%);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .tab-nav-scroller { overflow-x: auto; scrollbar-width: thin; scrollbar-color: var(--border-color) transparent; padding: 0 1.5rem; }
         .tab-navigation { display: flex; flex-wrap: nowrap; white-space: nowrap; margin: 0; padding: 0; list-style: none; }
         .tab-link { padding: 0.75rem 0; margin: 0 1.25rem; cursor: pointer; background: none; border: none; border-bottom: 3px solid transparent; color: var(--text-secondary); font-size: 0.9rem; font-weight: 500; transition: color 0.2s ease, border-color 0.2s ease; margin-bottom: -1px; text-align: center; }
         
         
         .tab-link:hover { color: var(--product-accent); }
         .tab-link.active { color: var(--product-accent); border-bottom-color: var(--product-accent); }
         .tab-link:first-child { margin-left: 0; } .tab-link:last-child { margin-right: 0; }
         .tab-content { padding-top: 2rem; }
         .tab-pane { display: none; animation: fadeIn 0.5s ease; }
         .tab-pane.active { display: block; }
         .tab-link span {font-weight: 550; }
         @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
         .product-section { margin-bottom: 3rem; background: var(--background-card); border-radius: 8px; border: 1px solid var(--border-color); padding: 0 2rem; transition: background-color 0.3s ease, border-color 0.3s ease; }
         /* --- TABLES --- */
         .table-container { width: 100%; overflow-x: auto; margin: 1.5rem 0; border: 1px solid var(--border-color); border-radius: 8px; transition: border-color 0.3s ease; }
         table { width: 100%; border-collapse: collapse; min-width: 650px; }
         th, td { padding: 12px 16px; text-align: left; vertical-align: middle; font-size: 0.875rem; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease;}
         th { background-color: var(--background-main); color: var(--text-primary); font-weight: 500; position: sticky; top: 0; z-index: 10; transition: background-color 0.3s ease, color 0.3s ease; }
         tr:last-child td { border-bottom: none; }
         tr:hover { background-color: var(--background-hover); }
         td strong { color: var(--text-primary); font-weight: 500; }
         td .icon { margin-left: -4px; }

         /* Sortable table styles */
         th[data-sort-direction="asc"],
         th[data-sort-direction="desc"] {
            background-color: rgba(0, 113, 206, 0.1);
         }
         th .sort-indicator {
            transition: transform 0.2s ease, opacity 0.2s ease;
         }
         th:hover .sort-indicator {
            opacity: 1 !important;
         }
         th:hover {
            background-color: rgba(0, 113, 206, 0.05);
         }
         tbody tr.sort-highlight {
            animation: highlightRow 1s ease;
         }
         @keyframes highlightRow {
            0% { background-color: rgba(0, 113, 206, 0.1); }
            100% { background-color: transparent; }
         }
         
         /* Table grouping styles */
         .table-group-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0px;
            padding: 8px 12px;
            background-color: var(--background-main);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: border-color 0.3s ease, background-color 0.3s ease;
         }
         
         .group-title {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
         }
         
         .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
         }
         
         .group-option {
            padding: 4px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--background-card);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
         }
         
         .group-option:hover {
            background-color: var(--background-hover);
            color: var(--text-primary);
         }
         
         .group-option.active {
            background-color: var(--product-accent);
            color: white;
            border-color: var(--product-accent);
            font-weight: 500;
         }
         
         tr.group-header {
            background-color: rgba(0, 113, 206, 0.08);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            border-radius: 4px;
            border-left: 3px solid rgba(0, 113, 206, 0.6);
         }
         
         tr.group-header:hover {
            background-color: rgba(0, 113, 206, 0.15);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         }
         
         tr.group-header.collapsed {
            background-color: rgba(0, 113, 206, 0.12);
            border-left-color: rgba(0, 113, 206, 0.6);
            margin-bottom: 0;
            border-bottom: 2px solid rgba(0, 113, 206, 0.4);
            position: relative; /* For the ::after pseudo-element */
         }
         
         tr.group-header.collapsed:hover {
            background-color: rgba(0, 113, 206, 0.18);
         }
         
         /* Add visual indicator of collapsed rows below */
         tr.group-header.collapsed::after {
            content: "";
            height: 3px;
            background: linear-gradient(to right, rgba(0, 113, 206, 0.4), rgba(0, 113, 206, 0.1), transparent);
            display: block;
            position: relative;
            margin-top: 2px;
         }
         
         /* Add a more prominent indicator for collapsed content */
         tr.group-header.collapsed td:first-child {
            position: relative;
         }
         
         tr.group-header.collapsed td:first-child::before {
            content: "▾"; /* Down-pointing triangle */
            position: absolute;
            right: 10px;
            color: rgba(0, 113, 206, 0.6);
            font-size: 12px;
         }
         
         .group-header-content {
            display: flex;
            align-items: center;
            padding: 4px 0;
            flex-wrap: wrap;
         }
         
         .group-header-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-right: 8px;
         }
         
         .group-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            background-color: var(--background-card);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
         }
         
         .group-toggle {
            margin-right: 10px;
            transition: all 0.3s ease;
            color: rgba(0, 113, 206, 0.8);
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 113, 206, 0.1);
            width: 26px;
            height: 26px;
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-size: 18px;
         }
         
         tr.group-header:hover .group-toggle {
            background-color: rgba(0, 113, 206, 0.2);
            transform: scale(1.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
         }
         
         tr.group-header.collapsed .group-toggle {
            transform: rotate(-90deg);
            color: rgba(0, 113, 206, 0.6);
            background-color: rgba(0, 113, 206, 0.05);
         }
         
         /* Simplify the animation */
         tr.group-header.collapsed:hover .group-toggle {
            background-color: rgba(0, 113, 206, 0.15);
            transform: rotate(-90deg) scale(1.05);
         }
         
         /* Styles for grouped rows */
         tr[data-group] {
            transition: all 0.3s ease;
         }
         
         /* Collapsed rows - completely hidden */
         tbody tr.collapsed-row {
            display: none !important;
         }
         
         tr.first-in-group {
            border-top: 1px solid rgba(0, 113, 206, 0.1);
         }
         
         @media (max-width: 768px) {
            .table-group-controls {
               flex-direction: column;
               align-items: flex-start;
               gap: 8px;
            }
            
            .group-options {
               width: 100%;
            }
         }
         
         /* Table Pagination Styles */
         .table-pagination {
            margin-top: 1rem;
            border-top: 1px solid var(--border-color);
            padding-top: 0.75rem;
         }
         
         .pagination-top-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-left:12px;
            padding-right: 12px;
         }
         
         .page-size-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
         }
         
         .page-size-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
         }
         
         .page-size-select {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--background-card);
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
         }
         
         .page-size-select:focus {
            outline: none;
            border-color: var(--product-accent);
            box-shadow: 0 0 0 2px rgba(0, 113, 206, 0.1);
         }
         
         .pagination-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
         }
         
         .pagination-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            padding: 8px 0;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
         }
         
         .pagination-button {
            min-width: 36px;
            height: 36px;
            padding: 0;
            border: none;
            border-radius: 4px;
            background-color: transparent;
            color: var(--product-accent);
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin: 0 2px;
         }
         
         .pagination-button:hover:not(:disabled) {
            background-color: rgba(0, 113, 206, 0.08);
            color: var(--product-accent);
         }
         
         .pagination-button {
            background-color: var(--product-accent);
            color: white;
            font-weight: 500;
         }
         
         /* Navigation buttons styling */
         .pagination-button.prev,
         .pagination-button.next,
         .pagination-button.first,
         .pagination-button.last {
            background-color: transparent;
            border-radius: 50%;
         }
         
         /* Number buttons styling */
         .pagination-button.page-number {
            font-family: 'Roboto', Arial, sans-serif;
            font-weight: 500;
         }
         
         .pagination-button.ellipsis {
            cursor: default;
            min-width: 24px;
         }
         
         .pagination-button.ellipsis:hover {
            background-color: transparent;
         }
         
         .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: var(--text-secondary);
         }
         
         .pagination-button.prev,
         .pagination-button.next,
         .pagination-button.first,
         .pagination-button.last {
            background-color: transparent;
            border: none;
         }
         
         .pagination-button.prev:hover:not(:disabled),
         .pagination-button.next:hover:not(:disabled),
         .pagination-button.first:hover:not(:disabled),
         .pagination-button.last:hover:not(:disabled) {
            background-color: rgba(0, 113, 206, 0.08);
            border: none;
         }
         
         .pagination-button .icon {
            font-size: 20px;
            margin: 0;
            font-family: 'Material Symbols Outlined', sans-serif !important;
            vertical-align: middle;
            font-style: normal;
         }
         
         .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal;
            font-style: normal;
            line-height: 1;
            text-transform: none;
            letter-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            direction: ltr;
            display: inline-block;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
         }
         
         /* Ensure Material Symbols are properly applied */
         span.material-symbols-outlined,
         .material-symbols-outlined {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal;
            font-style: normal;
            font-size: 20px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            font-feature-settings: 'liga';
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
         }
         
         .pagination-button.ellipsis {
            cursor: default;
            color: var(--text-secondary);
         }
         
         .pagination-button.ellipsis:hover {
            background-color: transparent;
         }
         
         /* Mobile adjustments for pagination */
         @media (max-width: 768px) {
            .pagination-top-controls {
               flex-direction: column;
               align-items: flex-start;
               gap: 0.5rem;
            }
            
            .pagination-info {
               margin-top: 0.25rem;
            }
            
            .pagination-button {
               min-width: 32px;
               height: 32px;
            }
         }
         
         @media (max-width: 480px) {
            .pagination-button:not(.prev):not(.next):not(.active):not(.first):not(.last) {
               display: none;
            }
            
            .pagination-button.ellipsis:first-of-type,
            .pagination-button.ellipsis:last-of-type {
               display: flex;
            }
            
            .pagination-nav {
               width: 100%;
               justify-content: space-between;
            }
         }
         /* --- FLOATING TABLE OF CONTENTS --- */
         .floating-toc {
         position: fixed;
         top: 50%;
         right: 20px;
         transform: translateY(-50%);
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 12px;
         padding: 1rem;
         max-width: 280px;
         min-width: 240px;
         max-height: 70vh;
         overflow-y: auto;
         z-index: 1001;
         box-shadow: 0 8px 32px rgba(0,0,0,0.12);
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
         backdrop-filter: blur(8px);
         }
         .floating-toc.show {
         opacity: 1;
         visibility: visible;
         }
         .floating-toc-header {
         display: flex;
         align-items: center;
         justify-content: space-between;
         margin-bottom: 1rem;
         padding-bottom: 0.5rem;
         border-bottom: 1px solid var(--border-color);
         }
         .floating-toc-title {
         font-size: 0.875rem;
         font-weight: 600;
         color: var(--text-primary);
         display: flex;
         align-items: center;
         gap: 0.5rem;
         }
         .floating-toc-close {
         background: none;
         border: none;
         cursor: pointer;
         padding: 4px;
         border-radius: 4px;
         color: var(--text-secondary);
         transition: background-color 0.2s ease, color 0.2s ease;
         }
         .floating-toc-close:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .floating-toc-list {
         list-style: none;
         padding: 0;
         margin: 0;
         }
         .floating-toc-item {
         margin-bottom: 0.5rem;
         }
         .floating-toc-link {
         display: block;
         padding: 0.5rem 0.75rem;
         text-decoration: none;
         color: var(--text-secondary);
         font-size: 0.8rem;
         line-height: 1.4;
         border-radius: 6px;
         transition: all 0.2s ease;
         cursor: pointer;
         position: relative;
         border-left: 3px solid transparent;
         }
         .floating-toc-link:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .floating-toc-link.active {
         background-color: rgba(0, 113, 206, 0.1);
         color: var(--product-accent);
         border-left-color: var(--product-accent);
         font-weight: 500;
         }
         .floating-toc-progress {
         position: absolute;
         right: 0.5rem;
         top: 50%;
         transform: translateY(-50%);
         width: 20px;
         height: 20px;
         border-radius: 50%;
         background-color: var(--border-color);
         border: 2px solid var(--background-card);
         transition: all 0.2s ease;
         }
         .floating-toc-link.active .floating-toc-progress {
         background-color: var(--product-accent);
         }
         .floating-toc-progress-fill {
         position: absolute;
         top: 2px;
         left: 2px;
         right: 2px;
         bottom: 2px;
         border-radius: 50%;
         background-color: var(--product-accent);
         transform: scale(0);
         transition: transform 0.2s ease;
         }
         .floating-toc-link.reading .floating-toc-progress-fill {
         transform: scale(1);
         }
         .floating-toc-toggle {
         position: fixed;
         top: 50%;
         right: 20px;
         transform: translateY(-50%);
         background-color: var(--product-accent);
         color: var(--background-button-text);
         border: none;
         border-radius: 50%;
         width: 48px;
         height: 48px;
         display: flex;
         align-items: center;
         justify-content: center;
         cursor: pointer;
         z-index: 1002;
         box-shadow: 0 4px 16px rgba(0,0,0,0.15);
         opacity: 0;
         visibility: hidden;
         transition: all 0.3s ease;
         }
         .floating-toc-toggle.show {
         opacity: 1;
         visibility: visible;
         }
         .floating-toc-toggle:hover {
         background-color: var(--product-accent-hover);
         transform: translateY(-50%) scale(1.05);
         }
         /* --- FULL-SCREEN READING MODE --- */
         .fullscreen-reading-mode {
         position: fixed;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background-color: var(--background-main);
         z-index: 2000;
         overflow-y: auto;
         padding: 2rem;
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease;
         }
         .fullscreen-reading-mode.active {
         opacity: 1;
         visibility: visible;
         }
         .fullscreen-reading-content {
         max-width: 800px;
         margin: 0 auto;
         line-height: 1.8;
         font-size: 1.1rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content h2 {
         font-size: 2rem;
         margin-bottom: 1.5rem;
         color: var(--text-primary);
         border-bottom: 2px solid var(--product-accent);
         padding-bottom: 0.5rem;
         }
         .fullscreen-reading-content h3 {
         font-size: 1.5rem;
         margin-top: 2rem;
         margin-bottom: 1rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content h4 {
         font-size: 1.25rem;
         margin-top: 1.5rem;
         margin-bottom: 0.75rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content p {
         margin-bottom: 1.5rem;
         text-align: justify;
         color: var(--text-secondary);
         }
         .fullscreen-reading-content table {
         margin: 2rem 0;
         font-size: 0.95rem;
         }
         .fullscreen-reading-controls {
         position: fixed;
         top: 20px;
         right: 20px;
         display: flex;
         gap: 0.5rem;
         z-index: 2001;
         }
         .fullscreen-reading-control {
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 8px;
         padding: 0.5rem;
         cursor: pointer;
         color: var(--text-secondary);
         transition: all 0.2s ease;
         backdrop-filter: blur(8px);
         }
         .fullscreen-reading-control:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .fullscreen-reading-exit {
         background-color: var(--product-accent);
         color: var(--background-button-text);
         }
         .fullscreen-reading-exit:hover {
         background-color: var(--product-accent-hover);
         }
         .fullscreen-reading-progress {
         position: fixed;
         bottom: 20px;
         left: 50%;
         transform: translateX(-50%);
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 20px;
         padding: 0.5rem 1rem;
         font-size: 0.875rem;
         color: var(--text-secondary);
         backdrop-filter: blur(8px);
         z-index: 2001;
         }
         .fullscreen-font-controls {
         position: fixed;
         top: 20px;
         left: 20px;
         display: flex;
         gap: 0.5rem;
         z-index: 2001;
         }
         .fullscreen-font-control {
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 8px;
         padding: 0.5rem;
         cursor: pointer;
         color: var(--text-secondary);
         transition: all 0.2s ease;
         backdrop-filter: blur(8px);
         min-width: 40px;
         text-align: center;
         }
         .fullscreen-font-control:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         /* Hide UI elements when in fullscreen reading mode */
         body.fullscreen-reading .header,
         body.fullscreen-reading .product-header,
         body.fullscreen-reading .tab-navigation-container,
         body.fullscreen-reading .footer,
         body.fullscreen-reading .floating-toc,
         body.fullscreen-reading .floating-toc-toggle,
         body.fullscreen-reading #back-to-top,
         body.fullscreen-reading .reading-progress,
         body.fullscreen-reading .reading-progress-text {
         display: none !important;
         }
         /* Mobile adjustments for fullscreen reading */
         @media (max-width: 768px) {
         .fullscreen-reading-mode {
         padding: 1rem;
         }
         .fullscreen-reading-content {
         font-size: 1rem;
         line-height: 1.7;
         }
         .fullscreen-reading-controls {
         top: 10px;
         right: 10px;
         }
         .fullscreen-font-controls {
         top: 10px;
         left: 10px;
         }
         .fullscreen-reading-progress {
         bottom: 10px;
         padding: 0.4rem 0.8rem;
         font-size: 0.8rem;
         }
         }
         /* Hide TOC on smaller screens */
         @media (max-width: 1024px) {
         .floating-toc,
         .floating-toc-toggle {
         display: none !important;
         }
         }
         
         /* Mobile adjustments for reading progress */
         @media (max-width: 768px) {
         .reading-progress-text {
         right: 10px;
         top: 6px;
         font-size: 0.7rem;
         padding: 0.2rem 0.4rem;
         }
         }
         
         @media (max-width: 480px) {
         .reading-progress-text {
         right: 5px;
         top: 4px;
         font-size: 0.65rem;
         padding: 0.15rem 0.3rem;
         max-width: 120px;
         text-overflow: ellipsis;
         overflow: hidden;
         white-space: nowrap;
         }
         }
         /* --- MISC & FOOTER --- */
         .ai-disclaimer { text-align: center; font-style: italic; color: var(--text-secondary); font-size: 0.875rem; margin: -1rem auto -2rem; padding: 0 1rem; line-height: 1.5; }
         #back-to-top {
         position: fixed; bottom: 20px; left: 20px;
         background-color: var(--product-accent); color: var(--background-button-text);
         border: none; border-radius: 50%;
         width: 50px; height: 50px;
         display: none; align-items: center; justify-content: center;
         cursor: pointer; z-index: 1000;
         box-shadow: 0 4px 8px rgba(0,0,0,0.2);
         opacity: 0;
         transition: opacity 0.3s ease, transform 0.3s ease, background-color 0.3s ease;
         }
         #back-to-top.show { opacity: 1; display: flex; }
         #back-to-top:hover { background-color: var(--product-accent-hover); transform: translateY(-2px); }
         .footer { background-color: var(--background-card); color: var(--text-secondary); padding: 2rem 1.5rem; margin-top: 4rem; text-align: center; border-top: 1px solid var(--border-color); transition: background-color 0.3s ease, border-color 0.3s ease;}
         .footer-container { max-width: 1440px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
         .footer-brand { display: flex; align-items: center; gap: 1rem; }
         .footer-logo { height: 32px; }
         .footer-wordmark { font-size: 1rem; font-weight: 500; color: var(--cgd-blue); }
         .footer-copyright { font-size: 0.8rem; }
         .footer-socials { display: flex; gap: 1rem; }
         .footer-socials a { color: var(--text-secondary); text-decoration: none; display: inline-block; transition: color 0.2s ease, transform 0.2s ease; }
         .footer-socials a:hover { color: var(--product-accent); transform: scale(1.1); }
         .footer-socials svg { width: 24px; height: 24px; fill: currentColor; }
         @media (max-width: 768px) {
         .content, .product-header { padding-left: 1rem; padding-right: 1rem; }
         .footer-container { flex-direction: column; text-align: center; gap: 1.5rem; }
         }
         @media print {
         /* Print styles remain largely the same */
         .header, .footer, .tab-navigation-container, .ai-disclaimer, #back-to-top, .header-controls { display: none !important; }
         }
      </style>
   </head>
   <body>
      <!-- Reading Progress Indicator -->
      <div id="reading-progress" class="reading-progress">
         <div id="reading-progress-fill" class="reading-progress-fill"></div>
      </div>
      <div id="reading-progress-text" class="reading-progress-text">
         0% read
      </div>
      
      <header class="header">
         <div class="header-container">
            <div class="header-brand">
               <img src="https://www.cgd.pt/PublishingImages/WSImages/Novo-CGD/logo-ap_Blue.png" alt="CGD Logo" class="header-logo">
            </div>
            <div class="header-controls">
               <div id="tts-controls" style="display: none;">
                  <button id="tts-play-pause-btn" class="icon-button" title="Listen to this section">
                  <span class="icon">play_arrow</span>
                  </button>
                  <button id="tts-stop-btn" class="icon-button" title="Stop listening">
                  <span class="icon">stop</span>
                  </button>
               </div>
               <button id="fullscreen-reading-btn" class="icon-button" title="Enter fullscreen reading mode">
               <span class="icon">fullscreen</span>
               </button>
               <button id="dark-mode-toggle" class="icon-button" title="Toggle dark/light mode">
               <span class="icon">light_mode</span>
               </button>
               <a href="mailto:david.alexandre.rosa@cgd.pt?subject=Support Request for Application Technical Profile&cc=dsi-arquitetura_empresarial@cgd.pt" target="_blank" class="support-button">Ask for Support</a>
            </div>
         </div>
         
         <!-- Breadcrumb Navigation integrated in header -->
         <div id="breadcrumb-container" class="breadcrumb-container">
            <nav class="breadcrumb" aria-label="Breadcrumb navigation">
               <a href="#" id="breadcrumb-home" class="breadcrumb-home" title="Go to overview">
                  <span class="icon">home</span>
                  <span>Overview</span>
               </a>
               <span class="breadcrumb-separator">›</span>
               <div id="breadcrumb-current" class="breadcrumb-item">
                  <span class="breadcrumb-link active">Current Section</span>
               </div>
               <div class="breadcrumb-section-info">
                  <div class="breadcrumb-progress">
                     <span class="icon">trending_up</span>
                     <div class="breadcrumb-progress-bar">
                        <div id="breadcrumb-progress-fill" class="breadcrumb-progress-fill"></div>
                     </div>
                     <span id="breadcrumb-progress-text">0%</span>
                  </div>
                  <div id="breadcrumb-section-count">
                     Section 1 of 13
                  </div>
               </div>
            </nav>
         </div>
      </header>
      
      <div class="product-header">
         <h1 id="application-technical-profile">Application Technical Profile</h1>
         <p style="font-size: 16px">A structured and in-depth technical overview of the application, capturing key architectural elements, technology stack, system components, and more. This profile serves as a foundational reference for modernization, migration, and governance initiatives.</p>
         <div class="document-meta">
            <div class="read-time" id="total-read-time">
               <span class="icon">schedule</span>
               <span>Calculating...</span>
            </div>
         </div>
      </div>
      <div id="tab-container-placeholder"></div>
      
      <main class="content" id="main-content-area">
<div class="product-section">
<h2 id="1-application-overview">1. Application overview</h2>
This section provides a high-level summary of the application, detailing its primary purpose, components, and technical specifications as inferred from the source code.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Acronym</strong></td>
<td style="text-align: left;">SDCIM</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Application name</strong></td>
<td style="text-align: left;">Image Concentration System</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Primary business purpose</strong></td>
<td style="text-align: left;">A comprehensive system for processing and managing bank remittances (deposits, checks) and their associated images, handling workflows from branch offices, and integrating with backend systems.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Business domain</strong></td>
<td style="text-align: left;">Banking, Financial Services, Image Processing, Remittance Management</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Solution files</strong></td>
<td style="text-align: left;">2 solutions found: <code>CIControloComSetup.sln</code>, <code>CIControloSemSetup.sln</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Project files</strong></td>
<td style="text-align: left;">18 projects found: <code>Alerta.csproj</code>, <code>CIActividades.csproj</code>, <code>CIConfigGlobalParameters.csproj</code>, <code>CIConfiguration.csproj</code>, <code>CIControlo.csproj</code>, <code>CIDepositoErro.csproj</code>, <code>CIFicheiro.csproj</code>, <code>CIFicheirosControlo.csproj</code>, <code>CIReports.csproj</code>, <code>CIServAlertas.csproj</code>, <code>CIServRemessas.csproj</code>, <code>CIServico.csproj</code>, <code>CIServTester.csproj</code>, <code>CITestes.csproj</code>, <code>MDIsControlo.csproj</code>, <code>MDIWebTransmCI.vbproj</code>, <code>QueryForm.csproj</code>, <code>SetupCIControlo.vdproj</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Files</strong></td>
<td style="text-align: left;">280 files analyzed, including: C# source files (<code>.cs</code>), VB.NET source files (<code>.vb</code>), C# project files (<code>.csproj</code>), VB.NET project files (<code>.vbproj</code>), Solution files (<code>.sln</code>), Configuration files (<code>.config</code>), Resource files (<code>.resx</code>), SQL files (<code>.sql</code>), Batch scripts (<code>.bat</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Main programming language(s)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Target .NET Framework(s)</strong></td>
<td style="text-align: left;">.NET Framework 4.0</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Application type</strong></td>
<td style="text-align: left;">Composite Application (Windows Forms UI, Windows Service, Class Libraries)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output type</strong></td>
<td style="text-align: left;"><code>.exe</code> (Executable), <code>.dll</code> (Dynamic Link Library), Windows Service</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment model</strong></td>
<td style="text-align: left;">On-premises</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment target platform</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Complexity</strong></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High complexity</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Last updated (Source code)</strong></td>
<td style="text-align: left;">2016-01-01</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Last updated (Documentation)</strong></td>
<td style="text-align: left;">2025-08-07</td>
</tr>
</tbody>
</table>
</div>
<h3 id="11-main-components-and-features">1.1. Main components and features</h3>
The application is composed of several key components that work together to provide its core functionality. The following table breaks down these components, their purpose, and key features.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key features</th>
<th style="text-align: left;">Dependencies</th>
<th style="text-align: left;">Related projects</th>
<th style="text-align: left;">Technologies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>User Interface</strong></td>
<td style="text-align: left;">Provides graphical interfaces for users to manage and monitor remittance processing activities.</td>
<td style="text-align: left;">- Remittance and document tracking<br>- Status monitoring<br>- Manual state changes<br>- User and configuration management</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>NBIISNET</code></td>
<td style="text-align: left;"><code>CIControlo.csproj</code>, <code>CIActividades.csproj</code></td>
<td style="text-align: left;">Windows Forms</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Remittance Processing Service</strong></td>
<td style="text-align: left;">A backend Windows Service that automates the processing of remittances, tranches, and documents.</td>
<td style="text-align: left;">- Polling for new remittances<br>- Transactional processing of tranches<br>- State management for documents and remittances</td>
<td style="text-align: left;"><code>CIServico.csproj</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CIServRemessas.csproj</code></td>
<td style="text-align: left;">.NET Windows Service</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting System</strong></td>
<td style="text-align: left;">A module responsible for generating and dispatching alerts based on system events and situations.</td>
<td style="text-align: left;">- Email notifications (SMTP/EWS)<br>- SMS notifications<br>- Logging to database and event viewer</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>Alerta.csproj</code>, <code>CIServAlertas.csproj</code></td>
<td style="text-align: left;">C# Library</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data & Configuration</strong></td>
<td style="text-align: left;">Core libraries for managing global parameters, database connections, and application configuration.</td>
<td style="text-align: left;">- Centralized database access<br>- User session management<br>- Reading from <code>.config</code> files</td>
<td style="text-align: left;"><code>System.Data.SqlClient</code>, <code>GenericNet.dll</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters.csproj</code>, <code>CIConfiguration.csproj</code></td>
<td style="text-align: left;">C# Library</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Reporting</strong></td>
<td style="text-align: left;">Generates reports based on the application's data, such as remittance summaries and processing statistics.</td>
<td style="text-align: left;">- Monthly billing reports<br>- Remittance listings<br>- ACOM file summaries</td>
<td style="text-align: left;"><code>CrystalDecisions</code></td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Crystal Reports</td>
</tr>
<tr>
<td style="text-align: left;"><strong>External Integrations</strong></td>
<td style="text-align: left;">Handles communication with external systems, including web services for document submission.</td>
<td style="text-align: left;">- SOAP client for document insertion</td>
<td style="text-align: left;"><code>System.Web.Services</code></td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">VB.NET Library, SOAP</td>
</tr>
</tbody>
</table>
</div>
A diagram illustrating the interaction between these main components is shown below.
<pre class="mermaid"><code>flowchart TD
    subgraph "User Interaction"
        UI_Controlo["CIControlo (WinForms UI)"]
        UI_Actividades["CIActividades (WinForms UI)"]
    end

    subgraph "Backend Processing"
        Service["CIServico (Windows Service)"]
        RemessaProcessor["CIServRemessas (Remittance Logic)"]
        AlertProcessor["CIServAlertas (Alert Logic)"]
    end
    
    subgraph "Core Libraries"
        Config["CIConfiguration"]
        GlobalParams["CIConfigGlobalParameters"]
        Alerting["Alerta"]
    end

    subgraph "Data & External Systems"
        Database["(database) SQL Server"]
        WebService["(fas) External Web Service"]
        FileSystem["(cylinder) File System (ENVM, ACOM files)"]
    end
    
    UI_Controlo --> Service
    UI_Actividades --> GlobalParams
    
    Service --> RemessaProcessor
    Service --> AlertProcessor
    
    RemessaProcessor --> GlobalParams
    AlertProcessor --> GlobalParams
    AlertProcessor --> Alerting
    
    GlobalParams --> Database
    GlobalParams --> Config

    RemessaProcessor --> WebService
    RemessaProcessor --> FileSystem
</code></pre>
<center><font size="2">Figure 1 - High-level component interaction diagram showing the relationships between the UI, backend services, core libraries, and external systems.</font></center>
<h3 id="12-solutions">1.2. Solutions</h3>
The application code is organized into two main solution files, likely for different deployment or development scenarios.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Solution</th>
<th style="text-align: left;">Projects</th>
<th style="text-align: left;">Visual studio version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CIControloComSetup.sln</strong></td>
<td style="text-align: left;">- <code>CIControlo.csproj</code><br>- <code>QueryForm.csproj</code><br>- <code>CIConfigGlobalParameters.csproj</code><br>- <code>CIConfiguration.csproj</code><br>- <code>CIActividades.csproj</code><br>- <code>CIReports.csproj</code><br>- <code>Alerta.csproj</code><br>- <code>CIServRemessas.csproj</code><br>- <code>CIServTester.csproj</code><br>- <code>CIServAlertas.csproj</code><br>- <code>CIServico.csproj</code><br>- <code>CIFicheirosControlo.csproj</code><br>- <code>CIFicheiro.csproj</code><br>- <code>MDIsControlo.csproj</code><br>- <code>MDIWebTransmCI.vbproj</code><br>- <code>SetupCIControlo.vdproj</code></td>
<td style="text-align: left;">2010</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIControloSemSetup.sln</strong></td>
<td style="text-align: left;">- <code>CIControlo.csproj</code><br>- <code>QueryForm.csproj</code><br>- <code>CIConfigGlobalParameters.csproj</code><br>- <code>CIConfiguration.csproj</code><br>- <code>CIActividades.csproj</code><br>- <code>CIReports.csproj</code><br>- <code>Alerta.csproj</code><br>- <code>CIServRemessas.csproj</code><br>- <code>CIServTester.csproj</code><br>- <code>CIServAlertas.csproj</code><br>- <code>CIServico.csproj</code><br>- <code>CIFicheirosControlo.csproj</code><br>- <code>CIFicheiro.csproj</code><br>- <code>MDIsControlo.csproj</code><br>- <code>MDIWebTransmCI.vbproj</code><br>- <code>CITestes.csproj</code><br>- <code>CIDepositoErro.csproj</code></td>
<td style="text-align: left;">2010</td>
</tr>
</tbody>
</table>
</div>
The following mind map illustrates the structure of the solutions and their contained projects.
<pre class="mermaid"><code>mindmap
  root((Solutions))
    CIControloComSetup.sln
      CIControlo
      CIActividades
      CIServico
      CIReports
      CIConfiguration
      CIFicheirosControlo
      MDIsControlo
      MDIWebTransmCI
      Alerta
      CIFicheiro
      CIConfigGlobalParameters
      CIServAlertas
      CIServRemessas
      CIServTester
      QueryForm
      SetupCIControlo
    CIControloSemSetup.sln
      CIControlo
      CIActividades
      CIServico
      CIReports
      CIConfiguration
      CIFicheirosControlo
      MDIsControlo
      MDIWebTransmCI
      Alerta
      CIFicheiro
      CIConfigGlobalParameters
      CIServAlertas
      CIServRemessas
      CIServTester
      QueryForm
      CITestes
      CIDepositoErro
</code></pre>
<center><font size="2">Figure 2 - Mind map of the solution files and their corresponding projects.</font></center>
<h3 id="13-projects">1.3. Projects</h3>
This section details each project within the solutions, outlining its purpose, type, and key dependencies.
<div class="table-container">
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Solution</th>
<th style="text-align: left;">Project</th>
<th style="text-align: left;">Main objectives</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Output type</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Runtime</th>
<th style="text-align: left;">Framework</th>
<th style="text-align: left;">Architecture</th>
<th style="text-align: left;">Compilation mode</th>
<th style="text-align: left;">Principal classes</th>
<th style="text-align: left;">Internal dependencies</th>
<th style="text-align: left;">External dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIControlo.csproj</strong></td>
<td style="text-align: left;">Main GUI application for system control and monitoring.</td>
<td style="text-align: left;">Windows Application</td>
<td style="text-align: left;">Executable</td>
<td style="text-align: left;">1.3.0.5</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIMainForm</code></td>
<td style="text-align: left;"><code>CIActividades</code>, <code>CIConfiguration</code>, <code>CIReports</code>, <code>CIServTester</code>, <code>MDIsControlo</code></td>
<td style="text-align: left;"><code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIActividades.csproj</strong></td>
<td style="text-align: left;">Provides UI forms for monitoring activities related to remittances, tranches, and documents.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ActividadesForm</code>, <code>ActividadeBalcaoForm</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIServico.csproj</strong></td>
<td style="text-align: left;">A Windows Service for automated background processing of remittances and alerts.</td>
<td style="text-align: left;">Windows Service</td>
<td style="text-align: left;">Executable</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIServico</code>, <code>CIServicoThread</code></td>
<td style="text-align: left;"><code>CIServRemessas</code>, <code>CIServAlertas</code></td>
<td style="text-align: left;"><code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIServRemessas.csproj</strong></td>
<td style="text-align: left;">Contains the core business logic for processing remittances and their associated documents and tranches.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ServRemessa</code></td>
<td style="text-align: left;"><code>CIActividades</code>, <code>Alerta</code></td>
<td style="text-align: left;"><code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIConfigGlobalParameters.csproj</strong></td>
<td style="text-align: left;">Central library for managing global settings, database connections, and user information.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIGlobalParameters</code>, <code>User</code></td>
<td style="text-align: left;"><code>System.Data</code></td>
<td style="text-align: left;"><code>GenericNet</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>Alerta.csproj</strong></td>
<td style="text-align: left;">Defines the data structures and logic for the system's alerting and notification features.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>Accao</code>, <code>AlertaSituacaoAccao</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericNet</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>MDIWebTransmCI.vbproj</strong></td>
<td style="text-align: left;">A VB.NET library that acts as a client for an external SOAP web service to insert documents.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>TInsertDoc</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>System.Web.Services</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>CIControloSemSetup.sln</code></td>
<td style="text-align: left;"><strong>CITestes.csproj</strong></td>
<td style="text-align: left;">A test project for verifying the functionality of the remittance processing service.</td>
<td style="text-align: left;">Test Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIServRemessaTestes</code></td>
<td style="text-align: left;"><code>CIServRemessas</code>, <code>CIServTester</code></td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.QualityTools.UnitTestFramework</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>Other Libraries</strong></td>
<td style="text-align: left;">Various other class libraries providing configuration, reporting, file control, and testing support.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;">Multiple</td>
<td style="text-align: left;">Multiple</td>
<td style="text-align: left;">Multiple</td>
</tr>
</tbody>
</table>
</div>
The following diagram illustrates the primary dependencies between the main executable, the service, and the core libraries.
<pre class="mermaid"><code>flowchart TD
    UI["CIControlo.csproj (UI)"]
    Service["CIServico.csproj (Service)"]
    Activities["CIActividades.csproj (Forms)"]
    RemessaLogic["CIServRemessas.csproj (Logic)"]
    AlertLogic["CIServAlertas.csproj (Logic)"]
    GlobalParams["CIConfigGlobalParameters.csproj (Core)"]
    Database["(database) SQL Server"]

    UI --> Activities
    UI --> Service
    Service --> RemessaLogic
    Service --> AlertLogic
    Activities --> GlobalParams
    RemessaLogic --> GlobalParams
    AlertLogic --> GlobalParams
    GlobalParams --> Database
</code></pre>
<center><font size="2">Figure 3 - Project dependency graph showing key relationships.</font></center>
</div>
<div class="product-section">
<h2 id="2-functional-overview">2. Functional overview</h2>
This section provides a high-level functional decomposition of the application, using table format. It identifies the major, distinct functional blocks or modules as inferred from the code's high-level structure (e.g., top-level namespaces, solution folders, primary class groups). This overview serves as a map to the application's core responsibilities.
<h3 id="21-executive-summary">2.1. Executive summary</h3>
This section provides a high-level summary of the application's primary purpose and its core function from a business or operational perspective, using table format. The summary is an inference based on the main entry points of the code (e.g., <code>main()</code>, <code>Application_Start()</code>), the names of the most central classes and modules, and the nature of the core processes identified. It answers the fundamental question: What primary problem does this application solve?
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Application Name</strong></td>
<td style="text-align: left;">Image Concentration System (SDCIM)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Primary Business Purpose</strong></td>
<td style="text-align: left;">The application serves as a central hub for processing financial remittances, primarily checks and deposits, from branch offices. It manages the lifecycle of these remittances, including data capture, image processing, validation, transaction processing (tranches), and handling of returns/reversals (estornos).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Core Function</strong></td>
<td style="text-align: left;">To automate and provide a control interface for the ingestion, processing, and management of banking remittances, ensuring data integrity and providing visibility into the operational workflow from branches to central processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key Processes</strong></td>
<td style="text-align: left;">- <strong>Remittance Processing:</strong> Handles incoming remittance data, processes documents in batches (tranches), and updates their status.<br>- <strong>Activity Monitoring:</strong> Provides a Windows-based user interface for operators to monitor the status of remittances, tranches, and individual documents.<br>- <strong>Alerting:</strong> Generates and sends system alerts (via email, event log) for various operational situations.<br>- <strong>Configuration & User Management:</strong> Allows administrators to configure system parameters and manage user access.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Primary Actors</strong></td>
<td style="text-align: left;">- <strong>System Operators/Administrators:</strong> Use the <code>CIControlo</code> and <code>CIActividades</code> front-end to monitor and manage the system.<br>- <strong>Automated Service (<code>CIServico</code>):</strong> A Windows Service that runs in the background to perform automated processing tasks.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Inferred from</strong></td>
<td style="text-align: left;">- <strong>Project Names:</strong> <code>CIServRemessas</code> (Remittance Service), <code>CIActividades</code> (Activities), <code>Alerta</code> (Alerts), <code>CIControlo</code> (Control).<br>- <strong>Class Names:</strong> <code>ServRemessa</code>, <code>ProcessarTrancheBalcao</code>, <code>ActividadeBalcaoForm</code>, <code>AlertaSituacaoAccao</code>.<br>- <strong>Code Logic:</strong> The <code>CIServico</code> project contains a Windows Service that periodically checks for work (<code>CheckForThingToDo</code>) and processes remittances (<code>ProcessaRemessa</code>). The <code>CIActividades</code> project contains Windows Forms for displaying data from database views like <code>VW<em>REMESSA</em>BALCAO_DETALHE</code>.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="22-functional-decomposition">2.2. Functional decomposition</h3>
This section provides a detailed breakdown of the application's functional areas or modules, inferred from the code structure. Each module is described in terms of its primary responsibilities and how it contributes to the overall functionality of the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Functional Area / Module</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>User Interaction & Presentation</strong></td>
<td style="text-align: left;">Manages user interfaces, handles user input, and renders data. This module is the primary interface between the user and the system's core logic. It is composed of multiple Windows Forms screens for monitoring, configuration, and manual intervention.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Core Process Execution Engine</strong></td>
<td style="text-align: left;">A Windows Service that runs in the background, polling for new work. It orchestrates the processing of remittances, tranches, and alerts, forming the automated core of the application.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Remittance & Document Business Logic</strong></td>
<td style="text-align: left;">Encapsulates the rules and procedures for handling remittances. This includes creating tranches, processing documents, managing state transitions, and handling reversals ("estornos").</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting & Notification</strong></td>
<td style="text-align: left;">Manages the creation and dispatch of system alerts. It supports various notification channels, including database logging, file logging, email, and the Windows Event Viewer.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Persistence & Management</strong></td>
<td style="text-align: left;">Provides a centralized mechanism for database interaction. It handles all SQL queries and stored procedure calls, abstracting the data access logic from the business and presentation layers.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration Management</strong></td>
<td style="text-align: left;">Responsible for loading and providing access to application settings from configuration files, including database connection strings and operational parameters.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>External System Integration</strong></td>
<td style="text-align: left;">Contains the logic for communicating with external systems, specifically a SOAP-based web service for inserting document data into a remote system.</td>
</tr>
</tbody>
</table>
</div>
The following diagram visualizes the layered nature of the functional decomposition.
<pre class="mermaid"><code>flowchart TD
    UI["User Interaction & Presentation<br>(CIControlo, CIActividades)"]
    Engine["Core Process Execution Engine<br>(CIServico)"]
    Logic["Business Logic<br>(CIServRemessas, CIServAlertas)"]
    Integration["External System Integration<br>(MDIWebTransmCI)"]
    Data["Data Persistence & Management<br>(CIConfigGlobalParameters)"]
    Config["Configuration Management<br>(CIConfiguration)"]
    Database["(database)<br>SQL Server Database"]
    WebService["(fas)<br>External SOAP Service"]

    UI --> Logic
    Engine --> Logic
    Logic --> Integration
    Logic --> Data
    Integration --> WebService
    Data --> Database
    Config --> Data
</code></pre>
<center><font size="2">Figure 4 - Functional decomposition of the application, showing the layers of responsibility from UI and services down to data and external integrations.</font></center>
<h3 id="23-user-roles-and-permissions">2.3. User roles and permissions</h3>
This section identifies the distinct types of users that interact with the application. These roles are inferred from the logic in the <code>CIActividades</code> project, which checks user group levels to enable or disable functionality.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Role</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Permissions</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Administrator / Power User</strong></td>
<td style="text-align: left;">A role with elevated privileges, typically for system management and manual intervention in core business processes.</td>
<td style="text-align: left;">- Full CRUD on most or all data entities.<br>- Ability to manually change the state of remittances and tranches.<br>- Access to system configuration and user management.</td>
<td style="text-align: left;"><code>ChangeEstado</code>, <code>ReenviarTodasRemessasEmErro</code>, <code>Insert<em>Utilizadores</code>, <code>Update</em>Utilizadores</code>, <code>Delete<em>Utilizadores</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>User</code>, <code>Group</code>, <code>SystemConfig</code></td>
<td style="text-align: left;">Inferred from <code>ConfirmaPrivilegios()</code> method, which checks if <code>m</em>oParameters.UserLogged.m_iUserGroup <= 1</code>. This group level is assumed to have administrative rights.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Standard Operator</strong></td>
<td style="text-align: left;">A standard user role focused on monitoring and viewing operational data without the ability to perform sensitive actions.</td>
<td style="text-align: left;">- Read-only access to remittance and document data.<br>- Ability to perform searches and view reports.<br>- No permission to change states or alter system configuration.</td>
<td style="text-align: left;"><code>ViewRemittanceDetails</code>, <code>ViewDocumentImage</code>, <code>SearchRemittances</code>, <code>GenerateReport</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>Report</code></td>
<td style="text-align: left;">Inferred as any user with <code>m<em>oParameters.UserLogged.m</em>iUserGroup > 1</code>. This group level is locked out of administrative functions.</td>
</tr>
</tbody>
</table>
</div>
The class diagram below illustrates the relationship between these user roles and the system.
<pre class="mermaid"><code>classDiagram
    class User {
        +string m_sUserName
        +string m_sUserFullName
        +int m_iUserGroup
    }
    class Administrator {
        +m_iUserGroup <= 1
    }
    class StandardOperator {
        +m_iUserGroup > 1
    }
    class Remessa {
        +int remId
        +string estadoRemessa
        +ChangeEstado()
    }
    class SystemConfiguration {
        +string ParameterName
        +string ParameterValue
    }
    
    User <|-- Administrator
    User <|-- StandardOperator
    
    Administrator --> Remessa : "Manages"
    Administrator --> SystemConfiguration : "Configures"
    StandardOperator ..> Remessa : "Views"
</code></pre>
<center><font size="2">Figure 5 - Class diagram showing user roles and their primary interactions with key system entities.</font></center>
<h3 id="24-core-business-capabilities">2.4. Core business capabilities</h3>
This section lists the main, high-level capabilities of the application, representing its major functional domains.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Capability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Features</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Ingestion & Processing</strong></td>
<td style="text-align: left;">The complete set of functions related to bringing remittance data into the system and processing it through various states.</td>
<td style="text-align: left;">- Automated polling for new remittances.<br>- Processing of bank branch remittances (<code>Balcao</code>).<br>- Creation and management of transaction batches (<code>Tranches</code>).<br>- State transition management (e.g., from <code>Fechado</code> to <code>Processado</code>).</td>
<td style="text-align: left;"><code>Remessa<em>Balcao</code>, <code>Tranche</em>Out</code>, <code>Documento<em>Balcao</code>, <code>RemessaIn</em>Status</code></td>
<td style="text-align: left;">Assumes that the <code>CIServico</code> Windows Service is the primary driver for this capability. Inferred from classes like <code>ServRemessa</code> and methods like <code>RemessaBalcaoParaProcessar</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Document Management & Viewing</strong></td>
<td style="text-align: left;">Functions related to handling individual documents and their associated images within a remittance.</td>
<td style="text-align: left;">- Viewing document images (front and back).<br>- Associating documents with remittances and tranches.<br>- Handling document-level errors and states.</td>
<td style="text-align: left;"><code>Documento</code>, <code>Documento<em>Balcao</code>, <code>Imagem</code>, <code>Imagem</em>Balcao</code></td>
<td style="text-align: left;">Inferred from the presence of <code>MostraImagem</code> and <code>ImagemBalcaoForm</code> forms, which are dedicated to displaying images fetched from the database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Exception & Reversal Handling</strong></td>
<td style="text-align: left;">The capability to manage exceptions, errors, and business-level reversals ("estornos") of remittances and documents.</td>
<td style="text-align: left;">- Re-sending remittances that failed.<br>- Processing and tracking of remittance reversals.<br>- UI for viewing and managing items in an error state.</td>
<td style="text-align: left;"><code>Estorno<em>Remessa</em>Balcao</code>, <code>Estorno<em>Documento</code></td>
<td style="text-align: left;">Inferred from UI elements and methods like <code>btnRemessasErro</em>Click</code>, <code>mudarEstadoToolStripMenuItem<em>Click</code>, and views like <code>VW</em>ESTRN<em>REMESSA</em>BALCAO_DETALHE</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>System Monitoring & Alerting</strong></td>
<td style="text-align: left;">Provides real-time and historical views of system activities and generates alerts for predefined operational situations.</td>
<td style="text-align: left;">- UI dashboards for activity monitoring (<code>ActividadesForm</code>).<br>- Generation of alerts for system events (e.g., processing failures).<br>- Dispatch of alerts via email, event log, and other channels.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Alerta<em>Situacao</em>Accao</code>, <code>GenericLog</code></td>
<td style="text-align: left;">Inferred from the <code>Alerta</code> project and its related classes, which define actions (<code>Accao</code>) for different situations (<code>Situacao</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration & User Administration</strong></td>
<td style="text-align: left;">Allows privileged users to configure system parameters and manage user accounts and permissions.</td>
<td style="text-align: left;">- Setting operational parameters (e.g., processing timers, batch sizes).<br>- Creating, updating, and deleting user accounts.<br>- Assigning users to permission groups.</td>
<td style="text-align: left;"><code>User</code>, <code>Group</code>, <code>CI_PARAMETER</code></td>
<td style="text-align: left;">Inferred from the <code>CIConfiguration</code> project and forms like <code>UtilizadoresForm</code> and <code>CIConfigForm</code>.</td>
</tr>
</tbody>
</table>
</div>
The following diagram illustrates the relationships between these core capabilities.
<pre class="mermaid"><code>flowchart TD
    A["Remittance Ingestion & Processing"] --> B["Document Management & Viewing"]
    A --> C["Exception & Reversal Handling"]
    A --> D["System Monitoring & Alerting"]
    C --> D
    E["Configuration & User Administration"] --> A
    E --> D
</code></pre>
<center><font size="2">Figure 6 - Core business capabilities and their high-level interactions.</font></center>
<h3 id="25-detailed-feature-breakdown">2.5. Detailed feature breakdown</h3>
This section provides a granular breakdown of individual features within each Core Business Capability.
<div class="table-container">
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">User Story / Description</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Process Branch Remittance</strong></td>
<td style="text-align: left;">As a <strong>System Service</strong>, I can <strong>poll for new branch remittances</strong> in a "ready" state so that they can be processed into tranches and sent for clearing. The service calls <code>RemessaBalcaoParaProcessar</code> to find work and then <code>TratarTranchesBalcao</code> to execute the processing logic.</td>
<td style="text-align: left;"><code>Remessa<em>Balcao</code>, <code>Tranche</em>Out</code>, <code>Documento_Balcao</code></td>
<td style="text-align: left;">Assumes the <code>CIServico</code> Windows Service is the actor. Inferred from <code>ServRemessa.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>View Remittance Details</strong></td>
<td style="text-align: left;">As a <strong>Standard Operator</strong>, I can <strong>search for a remittance</strong> by date, branch, or ID and <strong>view its details</strong> and associated documents to monitor its status. The <code>ActividadeBalcaoForm</code> provides filters and list views for this purpose.</td>
<td style="text-align: left;"><code>VW<em>REMESSA</em>BALCAO<em>DETALHE</code>, <code>VW</em>DETALHE<em>DOCUMENTOS</em>BALCAO</code></td>
<td style="text-align: left;">Inferred from the UI design and event handlers in <code>ActividadeBalcaoForm.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Manually Change Remittance State</strong></td>
<td style="text-align: left;">As an <strong>Administrator</strong>, I can <strong>select a remittance</strong> in the UI and <strong>manually change its state</strong> to resolve processing errors or force a specific workflow step. The <code>MudarEstadoForm</code> is invoked for this action.</td>
<td style="text-align: left;"><code>Remessa<em>Balcao</code>, <code>Activity</em>Change</code></td>
<td style="text-align: left;">Inferred from <code>toolStripMenuRemessaMudarEstado_Click</code> event handler and the <code>ConfirmaPrivilegios()</code> check.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Handle Remittance Reversal (Estorno)</strong></td>
<td style="text-align: left;">As a <strong>System Service</strong>, I can <strong>process remittance reversals</strong> to handle returned checks or other exceptions. The system provides separate views and logic for "estornos".</td>
<td style="text-align: left;"><code>Estorno<em>Remessa</em>Balcao</code>, <code>VW<em>ESTRN</em>REMESSA<em>BALCAO</em>DETALHE</code></td>
<td style="text-align: left;">Inferred from UI elements and methods dedicated to "Estorno" in <code>ActividadeBalcaoForm.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>View Document Image</strong></td>
<td style="text-align: left;">As a <strong>Standard Operator</strong>, I can <strong>double-click a document</strong> in a list to <strong>view its scanned image</strong> (front and back) for verification or analysis.</td>
<td style="text-align: left;"><code>Imagem</code>, <code>Imagem<em>Balcao</code></td>
<td style="text-align: left;">Inferred from <code>listViewDetalhesDocumentos</em>DoubleClick</code> event handler which opens the <code>ImagemBalcaoForm</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configure System Alerts</strong></td>
<td style="text-align: left;">As an <strong>Administrator</strong>, I can <strong>associate system events (Situations) with notification actions</strong> (e.g., email, log) to ensure operational issues are flagged.</td>
<td style="text-align: left;"><code>Alerta<em>Situacao</code>, <code>Alerta</em>Accao</code>, <code>Alerta<em>Situacao</em>Accao</code></td>
<td style="text-align: left;">Inferred from the <code>CIConfigForm</code> UI, which allows linking situations to actions.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="26-key-data-entities-and-their-attributes">2.6. Key data entities and their attributes</h3>
This section documents the application's core data structures, as inferred from class definitions and database interaction patterns.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Entity</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Attributes</th>
<th style="text-align: left;">Data Type</th>
<th style="text-align: left;">Validation Rules</th>
<th style="text-align: left;">Relationships</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>RemessaBalcao</strong></td>
<td style="text-align: left;">Represents a remittance batch submitted from a bank branch.</td>
<td style="text-align: left;"><code>ID</code>, <code>REMBALCAO<em>DATA</code>, <code>REMBALCAO</em>BALCAO</code>, <code>REMBALCAO<em>STAT</em>ID</code></td>
<td style="text-align: left;"><code>int</code>, <code>DateTime</code>, <code>int</code>, <code>int</code></td>
<td style="text-align: left;"><code>ID</code> is a primary key. <code>REMBALCAO<em>STAT</em>ID</code> is a foreign key to a status table.</td>
<td style="text-align: left;">Has a one-to-many relationship with <code>DocumentoBalcao</code>. May have one-to-many with <code>Tranche<em>Out</code>.</td>
<td style="text-align: left;">Inferred from classes like <code>DetalheRemessa</code> and views like <code>VW</em>REMESSA<em>BALCAO</em>DETALHE</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DocumentoBalcao</strong></td>
<td style="text-align: left;">Represents a single document (e.g., a check) within a branch remittance.</td>
<td style="text-align: left;"><code>ID</code>, <code>REMBALCAO<em>ID</code>, <code>DOC</em>ZONA2</code> (Montante), <code>DOC<em>NIB</code>, <code>DOCSTAT</em>ID</code></td>
<td style="text-align: left;"><code>int</code>, <code>int</code>, <code>decimal</code>, <code>string</code>, <code>int</code></td>
<td style="text-align: left;"><code>ID</code> is a primary key. <code>REMBALCAO<em>ID</code> is a foreign key to <code>RemessaBalcao</code>.</td>
<td style="text-align: left;">Belongs to one <code>RemessaBalcao</code>. May belong to one <code>Tranche</em>Out</code>. Has one or more <code>Imagem<em>Balcao</code>.</td>
<td style="text-align: left;">Inferred from <code>DetalheDocumento</code> class and views like <code>VW</em>DETALHE<em>DOCUMENTOS</em>BALCAO</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Tranche<em>Out</strong></td>
<td style="text-align: left;">A batch of documents created for transmission to an external system.</td>
<td style="text-align: left;"><code>TRANOUT</em>ID</code>, <code>REMIN<em>ID</code>, <code>TRANOUTSTAT</em>ID</code>, <code>TRANOUT<em>NUMERO</code></td>
<td style="text-align: left;"><code>int</code>, <code>int</code>, <code>int</code>, <code>int</code></td>
<td style="text-align: left;"><code>TRANOUT</em>ID</code> is a primary key. <code>REMIN_ID</code> links back to the source remittance.</td>
<td style="text-align: left;">Belongs to one <code>RemessaBalcao</code>. Contains many <code>DocumentoBalcao</code>.</td>
<td style="text-align: left;">Inferred from <code>DetalheTranche</code> class and the logic for creating tranches from remittances.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerta</strong></td>
<td style="text-align: left;">Represents a system alert triggered by a specific event or situation.</td>
<td style="text-align: left;"><code>ALERT<em>ID</code>, <code>AL</em>TIMER</code>, <code>AL<em>TEXT</code>, <code>SITUACAO</em>ID</code></td>
<td style="text-align: left;"><code>int</code>, <code>DateTime</code>, <code>string</code>, <code>int</code></td>
<td style="text-align: left;"><code>ALERT<em>ID</code> is a primary key.</td>
<td style="text-align: left;">Belongs to one <code>Alerta</em>Situacao</code>. Triggers one or more <code>Alerta_Accao</code>.</td>
<td style="text-align: left;">Inferred from the <code>Alerta</code> project and classes like <code>AlertaSituacaoAccao</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Accao</strong></td>
<td style="text-align: left;">Defines a notification action that can be performed in response to an alert.</td>
<td style="text-align: left;"><code>ACC<em>ID</code>, <code>ACC</em>DESC</code>, <code>TIPACC<em>ID</code></td>
<td style="text-align: left;"><code>int</code>, <code>string</code>, <code>enum</code></td>
<td style="text-align: left;"><code>ACC</em>ID</code> is a primary key. <code>TIPACC<em>ID</code> defines the type (Email, SMS, Log).</td>
<td style="text-align: left;">Can be associated with multiple <code>Alerta</em>Situacao</code>.</td>
<td style="text-align: left;">Inferred from the <code>Accao.cs</code> class definition.</td>
</tr>
</tbody>
</table>
</div>
The following Entity-Relationship diagram illustrates the connections between these core data entities.
<pre class="mermaid"><code>erDiagram
    RemessaBalcao ||--o{ DocumentoBalcao : contains
    RemessaBalcao ||--o{ Tranche_Out : generates
    Tranche_Out ||--o{ DocumentoBalcao : groups
    DocumentoBalcao ||--o{ Imagem_Balcao : has
    Alerta_Situacao ||--o{ Alerta : triggers
    Alerta_Situacao }o--o{ Accao : "is associated with"
    
    RemessaBalcao {
        int ID PK
        datetime REMBALCAO_DATA
        int REMBALCAO_BALCAO
        int REMBALCAO_STAT_ID FK
    }
    DocumentoBalcao {
        int ID PK
        int REMBALCAO_ID FK
        decimal DOC_ZONA2
        string DOC_NIB
        int DOCSTAT_ID FK
    }
    Tranche_Out {
        int TRANOUT_ID PK
        int REMIN_ID FK
        int TRANOUTSTAT_ID FK
    }
    Imagem_Balcao {
        int IMGBALCAO_ID PK
        int DOCBALCAO_ID FK
        binary IMGBALCAO_IMAGE
    }
    Alerta {
        int ALERT_ID PK
        int SITUACAO_ID FK
        datetime AL_TIMER
        string AL_TEXT
    }
    Alerta_Situacao {
        int SITUACAO_ID PK
        string SITUACAO_DESC
    }
    Accao {
        int ACC_ID PK
        string ACC_DESC
        int TIPACC_ID FK
    }
</code></pre>
<center><font size="2">Figure 7 - Entity-Relationship diagram of key data entities.</font></center>
<h3 id="27-business-process-workflows">2.7. Business process workflows</h3>
This section describes and visualizes critical end-to-end processes, showing how different user roles and system features interact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Process</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Steps</th>
<th style="text-align: left;">User Roles Involved</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Standard Remittance Processing Pipeline</strong></td>
<td style="text-align: left;">A comprehensive workflow that outlines the steps involved in processing branch remittances from ingestion to final output.</td>
<td style="text-align: left;">1. Remittance is created (status: <code>Fechado</code>).<br>2. Service polls for new remittances (<code>REMIN<em>IDParaProcessar</code>).<br>3. Remittance is processed into tranches (<code>TratarTranchesBalcao</code>).<br>4. Tranches are sent to an external system.<br>5. Status is updated to <code>Processado</code> or <code>Enviado</code>.</td>
<td style="text-align: left;">System Service, Administrator (for monitoring/intervention)</td>
<td style="text-align: left;"><code>Remessa</em>Balcao</code>, <code>Documento<em>Balcao</code>, <code>Tranche</em>Out</code></td>
<td style="text-align: left;">Assumes a linear progression of states managed primarily by the <code>CIServico</code> Windows Service.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Remittance Reversal (Estorno) Workflow</strong></td>
<td style="text-align: left;">Outlines the process for handling a remittance that needs to be reversed or returned.</td>
<td style="text-align: left;">1. A reversal request is initiated.<br>2. The system identifies the original remittance and documents.<br>3. A reversal record (<code>Estorno<em>Remessa</em>Balcao</code>) is created.<br>4. The reversal is processed and its status is tracked separately from the original remittance.</td>
<td style="text-align: left;">System Service, Standard Operator (for viewing), Administrator (for intervention)</td>
<td style="text-align: left;"><code>Estorno<em>Remessa</em>Balcao</code>, <code>VW<em>ESTRN</em>REMESSA<em>BALCAO</em>DETALHE</code></td>
<td style="text-align: left;">Inferred from the dedicated UI tabs and data views for "Estornos" in <code>ActividadeBalcaoForm</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Manual State Intervention</strong></td>
<td style="text-align: left;">A workflow initiated by a user to manually correct the state of a remittance or tranche that has encountered an error.</td>
<td style="text-align: left;">1. Administrator identifies a remittance in an error state.<br>2. User right-clicks and selects "Mudar Estado".<br>3. User chooses a new valid state from a list.<br>4. System updates the state and logs the manual change.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa<em>Balcao</code>, <code>Tranche</em>Out</code>, <code>Activity_Change</code></td>
<td style="text-align: left;">Based on the <code>MudarEstadoForm</code> and the privilege checks in the UI code.</td>
</tr>
</tbody>
</table>
</div>
The diagram below shows the high-level relationship between these workflows.
<pre class="mermaid"><code>flowchart TD
    A["Standard Remittance<br>Processing Pipeline"]
    B["Remittance Reversal<br>(Estorno) Workflow"]
    C["Manual State<br>Intervention"]

    A --> C
    A --> B
</code></pre>
<center><font size="2">Figure 8 - High-level overview of the main business process workflows.</font></center>
<h4 id="271-workflow-standard-remittance-processing-pipeline">2.7.1. Workflow: Standard Remittance Processing Pipeline</h4>
This section provides a detailed breakdown of the Standard Remittance Processing Pipeline workflow, including the steps involved, user roles, key data entities, and any assumptions made, using a table format.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Remittance Ingestion</strong></td>
<td style="text-align: left;">A new remittance from a branch is created in the database with an initial status (e.g., <code>20 - Fechado</code>).</td>
<td style="text-align: left;">System (External Process)</td>
<td style="text-align: left;"><code>Remessa_Balcao</code></td>
<td style="text-align: left;">Assumes an external process or an initial data load creates the remittance record.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Polling for Work</strong></td>
<td style="text-align: left;">The <code>CIServico</code> Windows Service periodically queries the database for remittances ready for processing using <code>RemessaBalcaoParaProcessar</code>.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Remessa_Balcao</code></td>
<td style="text-align: left;">The service runs on a timer and polls the database for work.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. State Update to 'Processing'</strong></td>
<td style="text-align: left;">Once a remittance is picked up, its status is updated to <code>30 - Em Processamento</code> to prevent other service instances from processing it.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Remessa_Balcao</code></td>
<td style="text-align: left;">This is a standard locking mechanism for distributed processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Tranche Creation</strong></td>
<td style="text-align: left;">The service calls <code>TratarTranchesBalcao</code>, which reads the documents of the remittance and groups them into one or more <code>Tranche<em>Out</code> records based on system limits (<code>MaxDocsTranche</code>).</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Documento</em>Balcao</code>, <code>Tranche_Out</code></td>
<td style="text-align: left;">Documents are processed sequentially and batched.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Document Processing</strong></td>
<td style="text-align: left;">Each document within a tranche is validated, and its state is updated. A unique hash (<code>ChaveH</code>) is generated.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Documento_Balcao</code></td>
<td style="text-align: left;">Inferred from the <code>ProcessaDocumentoBalcao</code> method.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6. Final State Update</strong></td>
<td style="text-align: left;">After all tranches are processed, the remittance status is updated to <code>40 - Processado</code> or <code>25 - Espera de Maquinas</code> if further steps are needed. If errors occurred, it's set to <code>-40 - Erro no Processamento</code>.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Remessa_Balcao</code></td>
<td style="text-align: left;">The final state depends on the outcome of the processing steps.</td>
</tr>
</tbody>
</table>
</div>
The diagram below visualizes the steps of this workflow.
<pre class="mermaid"><code>flowchart TD
    A[("Start")] --> B["Remittance Created<br>(Status: Fechado)"]
    B --> C{"Service Polls for Work"}
    C -- "Remittance Found" --> D["Update Remittance Status<br>(Status: Em Processamento)"]
    D --> E["Process Documents into Tranches"]
    E --> F{"Errors during Processing?"}
    F -- "No" --> G["Update Remittance Status<br>(Status: Processado)"]
    F -- "Yes" --> H["Update Remittance Status<br>(Status: Erro)"]
    G --> I[("End")]
    H --> I
    C -- "No Remittance" --> J["Wait"]
    J --> C
</code></pre>
<center><font size="2">Figure 9 - Detailed steps of the Standard Remittance Processing Pipeline.</font></center>
<h4 id="272-workflow-remittance-reversal-estorno-workflow">2.7.2. Workflow: Remittance Reversal (Estorno) Workflow</h4>
This section provides a detailed breakdown of the Remittance Reversal (Estorno) Workflow, including the steps involved, user roles, key data entities, and any assumptions made, using a table format.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Reversal Identification</strong></td>
<td style="text-align: left;">An external event or a user action triggers the need for a reversal. The system identifies the original remittance and documents to be reversed.</td>
<td style="text-align: left;">System Service or Administrator</td>
<td style="text-align: left;"><code>Remessa<em>Balcao</code>, <code>Documento</em>Balcao</code></td>
<td style="text-align: left;">The trigger mechanism is not fully detailed but is assumed to exist.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Create Reversal Record</strong></td>
<td style="text-align: left;">A new record is created in a dedicated table (<code>Estorno<em>Remessa</em>Balcao</code>) to track the reversal process independently of the original transaction.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Estorno<em>Remessa</em>Balcao</code></td>
<td style="text-align: left;">Reversals are treated as separate transactions that reference the original.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Process Reversal</strong></td>
<td style="text-align: left;">The system processes the reversal, which may involve creating reversal transactions and updating the status of the <code>Estorno</code> record.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Estorno<em>Remessa</em>Balcao</code></td>
<td style="text-align: left;">This process mirrors the standard processing pipeline but for reversal transactions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Monitor Reversal Status</strong></td>
<td style="text-align: left;">Operators can view the status of reversals in a dedicated UI tab in <code>ActividadeBalcaoForm</code>.</td>
<td style="text-align: left;">Standard Operator, Administrator</td>
<td style="text-align: left;"><code>VW<em>ESTRN</em>REMESSA<em>BALCAO</em>DETALHE</code></td>
<td style="text-align: left;">The UI provides separate views for standard remittances and reversals.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Handle Reversal Errors</strong></td>
<td style="text-align: left;">If the reversal process fails, an administrator can intervene manually, similar to the standard workflow, using the "Mudar Estado" feature on the reversal record.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Estorno<em>Remessa</em>Balcao</code></td>
<td style="text-align: left;">The same manual intervention mechanisms apply to reversal workflows.</td>
</tr>
</tbody>
</table>
</div>
The diagram below visualizes the steps of this workflow.
<pre class="mermaid"><code>flowchart TD
    A[("Start Reversal")] --> B["Identify Original Remittance"]
    B --> C["Create Estorno Record"]
    C --> D["Process Estorno Transaction"]
    D --> E{"Errors?"}
    E -- "No" --> F["Update Estorno Status<br>(Status: Processado)"]
    E -- "Yes" --> G["Update Estorno Status<br>(Status: Erro)"]
    F --> H[("End")]
    G --> I{"Manual Intervention"}
    I --> F
    I --> G
</code></pre>
<center><font size="2">Figure 10 - Detailed steps of the Remittance Reversal (Estorno) Workflow.</font></center>
<h3 id="28-system-inputs-outputs-interfaces">2.8. System inputs & outputs (interfaces)</h3>
This section catalogs all identified points where data enters or leaves the application boundary.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Name / Description</th>
<th style="text-align: left;">Data Formats</th>
<th style="text-align: left;">Data Source / Sink</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>User Actions via GUI</strong></td>
<td style="text-align: left;">User Input Events</td>
<td style="text-align: left;">Windows Forms UI (<code>CIControlo</code>, <code>CIActividades</code>)</td>
<td style="text-align: left;">Operators interact with the system through the graphical interface to perform searches, manual updates, and monitoring.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>Configuration Files</strong></td>
<td style="text-align: left;"><code>.config</code> (XML), <code>.settings</code></td>
<td style="text-align: left;">File System</td>
<td style="text-align: left;">The application reads database connection strings and operational parameters from <code>app.config</code> and <code>*.exe.config</code> files at startup.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>ENVM/ACOM Files</strong></td>
<td style="text-align: left;">Fixed-width text files</td>
<td style="text-align: left;">Monitored file system directory</td>
<td style="text-align: left;">The <code>CIFicheiro</code> project suggests the system processes structured text files named <code>envm.<em></code> and <code>acom.</em></code>, likely containing transaction data from external systems.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>Web Service Response</strong></td>
<td style="text-align: left;">SOAP/XML</td>
<td style="text-align: left;">External <code>Insert_DocumentoMDIService</code></td>
<td style="text-align: left;">The application receives a response after submitting a document via the web service, which may contain success or error codes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Database Records</strong></td>
<td style="text-align: left;">SQL Data</td>
<td style="text-align: left;">SQL Server Database</td>
<td style="text-align: left;">The primary output of all processing is the creation and updating of records in the application's database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>UI Display</strong></td>
<td style="text-align: left;">Rendered UI Controls</td>
<td style="text-align: left;">Windows Forms UI</td>
<td style="text-align: left;">Data is presented to the user through <code>ListView</code> and <code>TextBox</code> controls.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Web Service Request</strong></td>
<td style="text-align: left;">SOAP/XML</td>
<td style="text-align: left;">External <code>Insert_DocumentoMDIService</code></td>
<td style="text-align: left;">The <code>MDIWebTransmCI</code> project sends document data, including images, to an external web service.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Alerts & Notifications</strong></td>
<td style="text-align: left;">Email (SMTP), Event Log Entry, Log File Text</td>
<td style="text-align: left;">Email Server, Windows Event Log, File System</td>
<td style="text-align: left;">The <code>Alerta</code> module dispatches notifications through various channels based on system configuration.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Reports</strong></td>
<td style="text-align: left;">Crystal Reports format (e.g., PDF, RPT)</td>
<td style="text-align: left;">Crystal Reports Engine</td>
<td style="text-align: left;">The <code>CIReports</code> project generates formatted reports for printing or viewing.</td>
</tr>
</tbody>
</table>
</div>
The diagram below visualizes the primary data flows into and out of the application.
<pre class="mermaid"><code>flowchart TD
    subgraph "External Sources"
        User["User (Operator/Admin)"]
        ConfigFile["Configuration Files (.config)"]
        BatchFiles["Batch Files (ENVM, ACOM)"]
        ExtService["External Web Service"]
    end

    subgraph "SDCIM Application"
        direction LR
        UI["Windows Forms UI"]
        Service["Windows Service Engine"]
        DB["(database) SQL Server"]
        Logic["Business & Data Logic"]
    end
    
    subgraph "External Sinks"
        Email["Email Server"]
        EventLog["Windows Event Log"]
        Reports["Printed/Exported Reports"]
    end

    User --> UI
    ConfigFile --> Service
    BatchFiles --> Service
    
    UI <--> Logic
    Service <--> Logic
    Logic <--> DB

    Logic --> ExtService
    ExtService --> Logic

    Logic --> Email
    Logic --> EventLog
    Logic --> Reports
</code></pre>
<center><font size="2">Figure 11 - System inputs and outputs, illustrating data flow across the application boundary.</font></center>
<h3 id="29-user-task-flows">2.9. User Task Flows</h3>
This section describes the typical path a user takes through the application to achieve a high-level objective, linking multiple features together.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Task Flow</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Monitor and Intervene on a Remittance</strong></td>
<td style="text-align: left;">A comprehensive sequence of steps an Administrator follows to find a problematic remittance and manually correct its state.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa<em>Balcao</code>, <code>Documento</em>Balcao</code>, <code>Tranche_Out</code></td>
<td style="text-align: left;">Assumes the user has administrative privileges and is responding to a processing error or alert.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Query Historical Document Data</strong></td>
<td style="text-align: left;">A task flow for an Operator to find and view the details and image of a specific historical document based on search criteria.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>VW<em>PESQ</em>DOCUMENTO</code>, <code>Imagem</code></td>
<td style="text-align: left;">The user is performing a routine lookup for audit or verification purposes.</td>
</tr>
</tbody>
</table>
</div>
The diagram below shows the high-level relationship between these user task flows.
<pre class="mermaid"><code>flowchart TD
    A["Monitor and Intervene on a Remittance"]
    B["Query Historical Document Data"]
</code></pre>
<center><font size="2">Figure 12 - High-level overview of the main user task flows.</font></center>
<h4 id="291-user-task-flow-monitor-and-intervene-on-a-remittance">2.9.1. User Task Flow: Monitor and Intervene on a Remittance</h4>
This section provides a detailed breakdown of the "Monitor and Intervene on a Remittance" task flow.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Login and Open Activities</strong></td>
<td style="text-align: left;">The Administrator launches the <code>CIControlo</code> application and opens the "Actividades Balcão" screen.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>User</code></td>
<td style="text-align: left;">The user is authenticated and has the necessary permissions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Filter for Problematic Remittances</strong></td>
<td style="text-align: left;">The user applies filters (e.g., date range, status 'Erro') to narrow down the list of remittances shown in the summary view.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>RemessasResumoBalcao</code></td>
<td style="text-align: left;">The user knows what criteria to use to find the remittance in question.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. View Remittance Details</strong></td>
<td style="text-align: left;">The user double-clicks a summary item to load the detailed list of remittances matching that summary.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>VW<em>REMESSA</em>BALCAO_DETALHE</code></td>
<td style="text-align: left;">The UI provides a drill-down capability from summary to detail.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. View Tranches and Documents</strong></td>
<td style="text-align: left;">The user double-clicks a specific remittance to view its associated tranches and documents, identifying the source of the error.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>VW<em>TRANCHE</em>BALCAO<em>DETALHE</code>, <code>VW</em>DETALHE<em>DOCUMENTOS</em>BALCAO</code></td>
<td style="text-align: left;">The error is identifiable by reviewing the state or error message of a child entity.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Initiate State Change</strong></td>
<td style="text-align: left;">The user right-clicks the problematic remittance (or tranche) and selects "Mudar Estado" from the context menu.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa<em>Balcao</code>, <code>Tranche</em>Out</code></td>
<td style="text-align: left;">The context menu is the primary mechanism for manual intervention.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6. Select New State and Confirm</strong></td>
<td style="text-align: left;">In the <code>MudarEstadoForm</code>, the user selects a valid new state from a dropdown list and confirms the action.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Activity_Change</code></td>
<td style="text-align: left;">The system provides a list of valid next states to prevent invalid transitions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>7. Verify State Change</strong></td>
<td style="text-align: left;">The user refreshes the view to confirm that the remittance's state has been updated correctly.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa_Balcao</code></td>
<td style="text-align: left;">The action is synchronous and the UI reflects the change after a refresh.</td>
</tr>
</tbody>
</table>
</div>
The diagram below visualizes the steps of this user task flow.
<pre class="mermaid"><code>flowchart TD
    A["Login & Open Activities Form"] --> B["Filter for Remittances in 'Erro' State"]
    B --> C["Select and View Remittance Details"]
    C --> D["Drill-Down to View Tranches/Documents"]
    D --> E["Identify Problematic Item"]
    E --> F["Right-Click -> Mudar Estado"]
    F --> G["Select New State & Confirm"]
    G --> H["Refresh View to Verify"]
    H --> I[("End")]
</code></pre>
<center><font size="2">Figure 13 - Steps for the 'Monitor and Intervene on a Remittance' user task flow.</font></center>
<h3 id="210-automated-scheduled-processes">2.10. Automated & Scheduled Processes</h3>
This section describes any system-triggered processes that run without direct user interaction, such as nightly jobs, scheduled reports, or data synchronization tasks.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Process Name</th>
<th style="text-align: left;">Trigger / Schedule</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Processing Service</strong></td>
<td style="text-align: left;">Runs continuously as a Windows Service (<code>CIServico</code>), polling the database at configurable intervals (<code>TempoEntreIteracoes</code>).</td>
<td style="text-align: left;">To automate the end-to-end processing of new remittances without manual intervention.</td>
<td style="text-align: left;">- Polls for remittances in a "ready" state.<br>- Updates remittance status to "processing".<br>- Creates and processes tranches and documents.<br>- Updates final status to "processed" or "error".</td>
<td style="text-align: left;"><code>Remessa<em>Balcao</code>, <code>Documento</em>Balcao</code>, <code>Tranche_Out</code></td>
<td style="text-align: left;">This is the core automated engine of the application. Inferred from the <code>CIServicoThread</code> class, which contains the main processing loop.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alert Processing Service</strong></td>
<td style="text-align: left;">Runs continuously as part of the <code>CIServico</code> Windows Service, polling for unprocessed alerts.</td>
<td style="text-align: left;">To dispatch notifications for system events that have been logged to the <code>ALERTA</code> table.</td>
<td style="text-align: left;">- Polls for alerts with status 0 (<code>ALACC<em>STATUS=0</code>).<br>- Dispatches notifications via configured channels (Email, Log, etc.).<br>- Updates alert status to "processed" (1) or "error" (-1).</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Alerta</em>Situacao_Accao</code></td>
<td style="text-align: left;">Inferred from the <code>CheckForAlertas2Process</code> method in <code>CIServicoThread.cs</code> and the logic in <code>ServAlerta.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Ingestion Service</strong></td>
<td style="text-align: left;">Runs continuously as part of the <code>CIServico</code> Windows Service, scanning a directory for new <code>ENVM</code> and <code>ACOM</code> files.</td>
<td style="text-align: left;">To automatically import data from external systems provided as structured text files.</td>
<td style="text-align: left;">- Scans configured file paths for new files matching a pattern.<br>- Parses the file line-by-line.<br>- Inserts records into staging or processing tables.<br>- Moves the processed file to a backup location.</td>
<td style="text-align: left;"><code>Ficheiro</code>, <code>Lote<em>Envm</code>, <code>Documento</em>Envm</code></td>
<td style="text-align: left;">Inferred from <code>CheckForFileENVM2Import</code> and <code>CheckForFileACOM2Import</code> methods, and the file parsing logic in the <code>CIFicheiro</code> project.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="3-architecture-and-design">3. Architecture and design</h2>
This section provides an overview of the application's architecture, design patterns, and principles as inferred from the source code structure and implementation details.
<h3 id="31-architecture-pattern">3.1. Architecture pattern</h3>
The application follows a traditional N-Tier architectural pattern, organized as a monolithic system.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Pattern Type</th>
<th style="text-align: left;">Identified Patterns</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Architecture pattern</strong></td>
<td style="text-align: left;">Monolithic, N-Tier</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Architectural patterns</strong></td>
<td style="text-align: left;">The UI layer (<code>CIActividades</code>, <code>CIControlo</code>) appears to follow a variation of Model-View-Controller (MVC) or Model-View-Presenter (MVP) adapted for Windows Forms, where forms act as Views and Controllers, and data classes act as Models. However, this is not strictly enforced, with significant logic in code-behind files.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Creational patterns</strong></td>
<td style="text-align: left;">No significant use of standard creational patterns like Factory or Builder was identified. Object instantiation is generally direct (<code>new ClassName()</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Structural patterns</strong></td>
<td style="text-align: left;">No significant use of standard structural patterns like Adapter or Decorator was identified.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Behavioral patterns</strong></td>
<td style="text-align: left;">No significant use of standard behavioral patterns like Observer or Strategy was identified. Logic is mostly procedural within service methods and event handlers.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Domain-driven design (DDD) patterns</strong></td>
<td style="text-align: left;">Low adoption. While there are data-centric classes (<code>Remessa</code>, <code>Documento</code>), they act as simple data transfer objects rather than rich domain models. The use of a <strong>Unit of Work</strong> pattern is not explicit, although database transactions are managed within service methods. A form of the <strong>Repository</strong> pattern is implemented through the <code>CIGlobalParameters</code> class, which centralizes data access, but it's not a generic repository implementation.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="32-architecture-style">3.2. Architecture style</h3>
The application is designed with a layered architecture, separating concerns into distinct projects.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Layering</strong></td>
<td style="text-align: left;">The application is structured into clear layers: <br> - <strong>Presentation Layer:</strong> <code>CIControlo</code>, <code>CIActividades</code> (Windows Forms).<br> - <strong>Service Layer:</strong> <code>CIServico</code> (Windows Service).<br> - <strong>Business Logic Layer:</strong> <code>CIServRemessas</code>, <code>CIServAlertas</code>, <code>Alerta</code>.<br> - <strong>Data Access Layer:</strong> Centralized within the <code>CIConfigGlobalParameters</code> project.<br> - <strong>Integration Layer:</strong> <code>MDIWebTransmCI</code> for external web services.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency flow</strong></td>
<td style="text-align: left;">Dependencies flow downwards from the presentation/service layers to the business logic and finally to the data access layer. Core libraries like <code>CIConfigGlobalParameters</code> are referenced by most other projects, acting as a central hub.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Bounded contexts</strong></td>
<td style="text-align: left;">The concept of bounded contexts is not formally applied. However, there is a natural separation of concerns between Remittance Processing, Alerting, and User Configuration, each handled by distinct sets of projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Communication between contexts/services</strong></td>
<td style="text-align: left;">Communication is primarily achieved through direct method calls between class libraries and a shared SQL Server database. There is no evidence of event-driven communication or message queues.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Use of dependency injection / IOC container</strong></td>
<td style="text-align: left;">No Dependency Injection (DI) or Inversion of Control (IoC) container (like Autofac or Ninject) is used. Dependencies are tightly coupled through direct instantiation (<code>new ClassName()</code>).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="33-key-design-patterns-and-principles-applied">3.3. Key design patterns and principles applied</h3>
This section evaluates the application's adherence to common software design principles.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Principle</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SOLID principles</strong></td>
<td style="text-align: left;"><strong>Low Adherence.</strong><br>- <strong>Single Responsibility:</strong> Violated in many places, especially in large form classes (<code>ActividadeBalcaoForm</code>) that handle UI events, data fetching, and state management.<br>- <strong>Open/Closed:</strong> The design does not lend itself to extension without modification. Adding a new alert type, for example, would require changes to the <code>Accao.enuTipoAccao</code> enum and the switch-case statement in <code>ServAlerta.cs</code>.<br>- <strong>Liskov Substitution:</strong> Not applicable in a significant way due to limited use of inheritance.<br>- <strong>Interface Segregation:</strong> Some interfaces are used (<code>CIComumInterface</code>, <code>CIMenuInterface</code>), but they are broad.<br>- <strong>Dependency Inversion:</strong> Not followed; high-level modules depend directly on low-level modules and concrete implementations.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DRY (Don't repeat yourself)</strong></td>
<td style="text-align: left;"><strong>Partial Adherence.</strong> Some code is centralized in helper classes (<code>CIGlobalParameters</code>), but there is evidence of repeated logic, especially in data access and UI event handling across different forms.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>KISS (Keep it simple, stupid)</strong></td>
<td style="text-align: left;"><strong>Partial Adherence.</strong> Individual methods are often straightforward and procedural. However, the overall complexity arises from the large number of interconnected projects and the lack of modern architectural patterns, making the system hard to reason about as a whole.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>YAGNI (You aren't gonna need it)</strong></td>
<td style="text-align: left;"><strong>Appears to be followed.</strong> The code seems focused on the required functionality without evidence of over-engineering or speculative features.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Separation of Concerns</strong></td>
<td style="text-align: left;"><strong>Good at the project level, poor at the class level.</strong> There is a clear separation between UI, service, and data projects. However, within UI projects, code-behind files often mix presentation logic with business and data access calls, violating SoC at a finer granularity.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Clean code principles</strong></td>
<td style="text-align: left;"><strong>Low Adherence.</strong> Naming conventions are inconsistent (e.g., mixed use of Hungarian notation like <code>m_sUserName</code> and standard C# properties). Methods are often long, and there is a lack of comments explaining complex logic.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Testability</strong></td>
<td style="text-align: left;"><strong>Low.</strong> The tight coupling, lack of dependency injection, and direct database calls in business logic make unit testing difficult. The existing tests (<code>CITestes</code>) are more akin to integration tests.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="34-domain-driven-design-ddd-adoption">3.4. Domain-driven design (DDD) adoption</h3>
The application shows very limited adoption of Domain-Driven Design concepts.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">DDD Concept</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Use of DDD concepts</strong></td>
<td style="text-align: left;">The code is data-centric, not domain-centric. Classes like <code>Remessa</code> and <code>Documento</code> are primarily anemic data containers with properties mapping to database tables, lacking encapsulated business logic. There is no evidence of formal Aggregates, Value Objects, or Domain Events.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Ubiquitous language</strong></td>
<td style="text-align: left;">A business-specific language is present (e.g., <code>Remessa</code>, <code>Tranche</code>, <code>Balcao</code>, <code>Estorno</code>), but it is not consistently enforced as a ubiquitous language across all layers.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Layered DDD approach</strong></td>
<td style="text-align: left;">While the architecture is layered, it does not follow a typical DDD layered structure (e.g., Domain, Application, Infrastructure). The "Business Logic" layer is procedural and lacks a rich domain model at its core.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="35-patterns-and-tactics">3.5. Patterns and tactics</h3>
The application relies on a few fundamental patterns but does not extensively use the broader catalog of GOF or enterprise patterns.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Pattern / Tactic</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CQRS</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used.</strong> The same models and data access methods are used for both commands (updates) and queries (reads).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Event Sourcing</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used.</strong> The system state is stored in its current form in a relational database, not as a sequence of events.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Repository pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partially/Implicitly used.</strong> The <code>CIGlobalParameters</code> class acts as a form of repository by centralizing data access methods (<code>DirectSqlDataReader</code>, <code>DirectSqlNonQuery</code>). However, it's not a true, generic repository pattern and exposes raw SQL execution.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit of Work pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partially/Implicitly used.</strong> Database transactions are managed within service methods (<code>m_oParameters.BeginTrans</code>, <code>Commit</code>, <code>RollBack</code>), grouping several database operations into a single unit of work, but this is done manually rather than through a formal UoW object.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Factory pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used.</strong> Object creation is direct.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Strategy pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used.</strong> Logic for different scenarios (e.g., different alert types) is handled with <code>switch-case</code> statements rather than a strategy pattern.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Mediator pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used.</strong> Components communicate directly or through shared data access classes.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="36-cross-cutting-concerns">3.6. Cross-cutting concerns</h3>
The application handles cross-cutting concerns through a mix of custom helper classes and direct implementation.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Concern</th>
<th style="text-align: left;">Implementation Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Logging</strong></td>
<td style="text-align: left;">A custom logging library (<code>GenericLogNET</code>) is used, with calls like <code>GenericLog.GenLogRegistarErro</code> and <code>GenLogRegistarAlerta</code> spread throughout the codebase.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Caching</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No evidence of in-memory or distributed caching was found.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Security</strong></td>
<td style="text-align: left;">Handled via a custom <code>User</code> class and group ID checks (<code>m<em>oParameters.UserLogged.m</em>iUserGroup</code>). This is a simple, role-based security model.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Exception Handling</strong></td>
<td style="text-align: left;">Standard <code>try-catch</code> blocks are used. Exceptions are typically logged using <code>GenericLog</code> and then re-thrown or displayed to the user in a <code>MessageBox</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration Management</strong></td>
<td style="text-align: left;">A combination of <code>.config</code> files and <code>Properties.Settings</code> is used to manage application settings and connection strings. The <code>CIGlobalParameters</code> class centralizes access to these settings.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency Injection</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used. Dependencies are managed manually via direct instantiation.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="37-deployment">3.7. Deployment</h3>
The deployment architecture is traditional for a .NET Framework application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Monolithic vs microservices</strong></td>
<td style="text-align: left;">The application is a <strong>Monolith</strong>. All components are deployed together as a single functional unit, though they are split into multiple projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scalability design</strong></td>
<td style="text-align: left;"><strong>Limited.</strong> Scalability is achieved vertically by increasing the resources of the server running the application and database. Horizontal scaling is not supported by the current architecture due to state being managed in-process and a centralized database without a distributed design.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Cloud-native design</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not cloud-native.</strong> The application is designed for on-premises deployment, relies on UNC paths (<code>\\sqc6001fas02\</code>), and uses Windows-specific features like Windows Services and the Event Log.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Containerization</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not containerized.</strong> The deployment model predates the widespread adoption of Docker and Kubernetes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Serverless architecture</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not serverless.</strong> The architecture is based on a continuously running Windows Service and a user-initiated Windows Forms application.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment model</strong></td>
<td style="text-align: left;">On-premises.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment target platform</strong></td>
<td style="text-align: left;">AnyCPU (32-bit or 64-bit, depending on the OS).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="38-infrastructure-considerations">3.8. Infrastructure considerations</h3>
The application relies on a traditional on-premises infrastructure stack.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Persistence</strong></td>
<td style="text-align: left;"><strong>Microsoft SQL Server.</strong> The connection strings point to various SQL Server instances (e.g., <code>SDC6001SQL04</code>, <code>VPC6001SQL111\S2K081</code>). There is no evidence of read/write separation or sharding.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Messaging / Eventing</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used.</strong> There is no use of message brokers like RabbitMQ or Azure Service Bus. Communication is synchronous through direct method calls and database polling.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>External integrations</strong></td>
<td style="text-align: left;">- <strong>SOAP Web Service:</strong> A key integration point is the <code>Insert_DocumentoMDIService</code> web service, consumed by the <code>MDIWebTransmCI</code> project. <br>- <strong>File System:</strong> The system reads <code>ENVM</code> and <code>ACOM</code> files from a shared directory, indicating a file-based integration pattern.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="39-documentation-artifacts">3.9. Documentation artifacts</h3>
The primary documentation artifacts are embedded within the source code and related files.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Artifact Type</th>
<th style="text-align: left;">Availability & Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>UML diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not found in the provided files.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>C4 model diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not found in the provided files.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Architecture diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No formal architecture diagrams were found. The architecture must be inferred from the code.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Design documents</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No separate design documents were provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API documentation</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Implicitly documented via the WSDL file (<code>Insert_DocumentoMDIService.wsdl</code>) for the consumed web service. No OpenAPI/Swagger for any APIs exposed by the application itself.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>User documentation</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not found.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Technical documentation</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Limited to code comments and <code>.sql</code> files which define database queries and views.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Readme or ADRs</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not found.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Reports</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Crystal Reports (<code>.rpt</code>) files serve as a form of documentation for the data structures and layouts of reports.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="4-technology-stack-and-frameworks">4. Technology stack and frameworks</h2>
This section details the technologies, frameworks, and libraries used to build and run the application.
<h3 id="41-backend-technologies">4.1. Backend technologies</h3>
The backend is built on the Microsoft .NET Framework and a set of established, albeit legacy, technologies.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Programming Language(s)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Runtime(s)</strong></td>
<td style="text-align: left;">.NET Framework 4.0</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Runtime architecture</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Framework(s)</strong></td>
<td style="text-align: left;">Windows Forms, Windows Services</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Framework type</strong></td>
<td style="text-align: left;">Desktop Application, Background Service</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Self-contained vs framework-dependent</strong></td>
<td style="text-align: left;">Framework-dependent (requires .NET Framework 4.0 to be installed on the host machine).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Platform target</strong></td>
<td style="text-align: left;">Windows</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ORM / Database Access</strong></td>
<td style="text-align: left;">ADO.NET (<code>System.Data.SqlClient</code>). No ORM like Entity Framework or Dapper is used.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Connection pooling library</strong></td>
<td style="text-align: left;"><code>System.Data.SqlClient</code> (built-in).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authentication / authorization</strong></td>
<td style="text-align: left;">Custom implementation based on user groups stored in the database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API types</strong></td>
<td style="text-align: left;">Consumes a SOAP web service. Does not appear to expose any APIs itself.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Serialization / data format</strong></td>
<td style="text-align: left;">XML (for SOAP communication and <code>.config</code> files).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Job scheduling / background tasks</strong></td>
<td style="text-align: left;">Windows Service (<code>CIServico</code>) with a timed polling loop.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration and secrets</strong></td>
<td style="text-align: left;"><code>app.config</code> files and <code>Properties.Settings</code> classes. Secrets (connection strings) are stored in plaintext in these files.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit testing and test frameworks</strong></td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.TestTools.UnitTesting</code> (MSTest).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Build tools</strong></td>
<td style="text-align: left;">MSBuild (via Visual Studio).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Other common libraries / SDKs</strong></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>GenericLogNET</code>, <code>NBIISNET</code> (custom internal libraries), <code>CrystalDecisions</code> (for reporting).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="42-frontend-technologies">4.2. Frontend technologies</h3>
The frontend is a classic Windows desktop application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Frontend framework(s)</strong></td>
<td style="text-align: left;">Windows Forms</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Frontend libraries</strong></td>
<td style="text-align: left;"><code>NBIISNET</code> (custom UI component library).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>JavaScript frameworks</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not applicable.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CSS preprocessors</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not applicable.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="43-data-and-storage">4.3. Data and storage</h3>
The application uses a relational database for its primary data storage.
<h4 id="431-database-technologies">4.3.1. Database technologies</h4>
The primary data store is Microsoft SQL Server.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Database management system(s)</strong></td>
<td style="text-align: left;">Microsoft SQL Server (inferred versions include 2008 R2, based on instance names like <code>S2K081</code> and <code>S2K082</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database type</strong></td>
<td style="text-align: left;">Relational</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data access technology</strong></td>
<td style="text-align: left;">ADO.NET (<code>System.Data.SqlClient</code>) with direct SQL queries and stored procedure calls.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database name(s)</strong></td>
<td style="text-align: left;"><code>BDSDIMGCONC</code>, <code>BDSQCSDCIMA01</code>, <code>BDSDCSDCIMA01</code>, <code>BDSPGCCALX</code>, <code>BDSPGCCAPT</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database authentication</strong></td>
<td style="text-align: left;">Integrated Security (Windows Authentication) and SQL Server Authentication (User Id/Password) are both likely supported, though the provided connection strings are incomplete.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database connection string(s)</strong></td>
<td style="text-align: left;">- <code>H=SDC6001SQL04; D=BDSDIMGCONC</code><br>- <code>PRDH=VPC6001SQL111\S2K081; PRDD=BDSPCSDCIMA01</code><br>- <code>QUAH=SQC6001SQL17\S2K082; QUAD=BDSQCSDCIMA01</code><br>- <code>DVPH=SDC6001SQL28\S2K081; DVPD=BDSDCSDCIMA01</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database schema management</strong></td>
<td style="text-align: left;">Likely Database-first, with the schema managed directly in SQL Server. There is no evidence of code-first migrations.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File/blob storage</strong></td>
<td style="text-align: left;">Images appear to be stored directly in the database as <code>byte[]</code> arrays. There is no evidence of a dedicated file/blob storage system like Azure Blob Storage or a file server.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="432-data-flow">4.3.2. Data flow</h4>
The data flow follows a traditional pattern for a client-server application with background processing.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Data sources</strong></td>
<td style="text-align: left;">- <strong>User Input:</strong> Manual data entry and commands from the Windows Forms UI.<br>- <strong>File System:</strong> <code>ENVM</code> and <code>ACOM</code> files are read from a local or network directory.<br>- <strong>External Web Service:</strong> Responses from the <code>Insert_DocumentoMDIService</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data sinks</strong></td>
<td style="text-align: left;">- <strong>SQL Server Database:</strong> The primary sink for all processed data, including remittances, documents, logs, and user information.<br>- <strong>External Web Service:</strong> Document data is sent to the <code>Insert_DocumentoMDIService</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data transformations</strong></td>
<td style="text-align: left;">Data is transformed within the business logic layer. For example, raw data from files is parsed and mapped to data entities before being saved to the database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data flow patterns</strong></td>
<td style="text-align: left;">- <strong>Synchronous:</strong> User actions in the UI that query the database.<br>- <strong>Asynchronous/Batch:</strong> The Windows Service processes files and remittances in the background, polling for new work in batches.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data integrity</strong></td>
<td style="text-align: left;">SQL transactions are used in some service methods (<code>m_oParameters.BeginTrans</code>, <code>Commit</code>, <code>RollBack</code>) to ensure atomicity for multi-step database operations.</td>
</tr>
</tbody>
</table>
</div>
The diagram below visualizes the primary data flows within the application.
<pre class="mermaid"><code>flowchart TD
    subgraph "Data Sources"
        UI_Input["User Input"]
        File_Input["File System (ENVM/ACOM)"]
        WS_Input["Web Service Response"]
    end
    
    subgraph "Application Core"
        Logic["Business Logic (Services & Libraries)"]
    end
    
    subgraph "Data Sinks"
        DB["(database) SQL Server"]
        WS_Output["Web Service Request"]
        Log_Output["(cylinder) Logs (File/DB/Event)"]
        UI_Output["UI Display"]
    end
    
    UI_Input --> Logic
    File_Input --> Logic
    WS_Input --> Logic
    
    Logic <--> DB
    
    Logic --> WS_Output
    Logic --> Log_Output
    Logic --> UI_Output
</code></pre>
<center><font size="2">Figure 14 - High-level data flow diagram.</font></center>
<h3 id="44-web-services-and-apis">4.4. Web services and APIs</h3>
The application primarily acts as a consumer of a SOAP web service.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>API type</strong></td>
<td style="text-align: left;">Consumes a <strong>SOAP</strong> web service.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API protocols</strong></td>
<td style="text-align: left;">HTTP/HTTPS.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API documentation</strong></td>
<td style="text-align: left;">WSDL (<code>Insert_DocumentoMDIService.wsdl</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API endpoints</strong></td>
<td style="text-align: left;"><code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>API response formats</strong></td>
<td style="text-align: left;">XML (SOAP).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Projects that provide APIs</strong></td>
<td style="text-align: left;">None. The application is a consumer, not a provider.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Projects that consume APIs</strong></td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="45-code-metrics">4.5. Code Metrics</h3>
The following table provides an estimated analysis of code metrics for each project, based on the provided source code.
<div class="table-container">
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Project</th>
<th style="text-align: left;">Programming Language(s)</th>
<th style="text-align: left;">Lines of Code</th>
<th style="text-align: left;">Cyclomatic complexity</th>
<th style="text-align: left;">Inheritance depth</th>
<th style="text-align: left;">Classes coupling</th>
<th style="text-align: left;">Maintainability index</th>
<th style="text-align: left;">Code deduplication</th>
<th style="text-align: left;">Comments density (%)</th>
<th style="text-align: left;">Dead code (%)</th>
<th style="text-align: left;">Estimated compilation time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CIControlo.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">1200</td>
<td style="text-align: left;">150</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">1500</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIActividades.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">2500</td>
<td style="text-align: left;">350</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">55</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">2800</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServico.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">500</td>
<td style="text-align: left;">40</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">75</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">800</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServRemessas.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">800</td>
<td style="text-align: left;">90</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">70</td>
<td style="text-align: left;">4%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">1000</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIConfigGlobalParameters.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">400</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">80</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">20%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">500</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerta.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">82</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">400</td>
</tr>
<tr>
<td style="text-align: left;"><strong>MDIWebTransmCI.vbproj</strong></td>
<td style="text-align: left;">VB.NET</td>
<td style="text-align: left;">250</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">78</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">450</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CITestes.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">150</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">85</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">25%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">300</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Other Projects</strong></td>
<td style="text-align: left;">C#/VB.NET</td>
<td style="text-align: left;">3000</td>
<td style="text-align: left;">400</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">60</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">3500</td>
</tr>
</tbody>
</table>
</div>
<h4 id="451-code-metrics-definitions">4.5.1. Code metrics definitions</h4>
This section defines the metrics used in the code analysis table above.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Typical values</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Lines of Code (LOC)</strong></td>
<td style="text-align: left;">Total number of lines of code in the project, excluding comments and blank lines. A measure of size.</td>
<td style="text-align: left;">Lower is generally better. Classes should ideally be under 500 LOC.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Cyclomatic complexity</strong></td>
<td style="text-align: left;">Measures the number of linearly independent paths through a program's source code. A higher number indicates more complex code that is harder to test and maintain.</td>
<td style="text-align: left;">Should be < 10 for methods, < 100 for classes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Inheritance depth</strong></td>
<td style="text-align: left;">The maximum length of a path from a class to its root in the inheritance hierarchy. Deep hierarchies can be complex and brittle.</td>
<td style="text-align: left;">Should be < 4.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Classes coupling</strong></td>
<td style="text-align: left;">Measures the number of other classes a single class is dependent upon. High coupling makes code harder to change and reuse.</td>
<td style="text-align: left;">Should be as low as possible.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Maintainability index</strong></td>
<td style="text-align: left;">A calculated value from 0 to 100 representing the relative ease of maintaining the code. A high value means better maintainability.</td>
<td style="text-align: left;">> 70 is considered good. < 60 is considered difficult to maintain.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Code deduplication</strong></td>
<td style="text-align: left;">Percentage of code that is duplicated across the project. High duplication increases maintenance effort and risk of bugs.</td>
<td style="text-align: left;">Should be < 5%.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Comments density (%)</strong></td>
<td style="text-align: left;">The percentage of lines that are comments. Very low density can indicate poor documentation.</td>
<td style="text-align: left;">A healthy range is often 15-25%.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dead code (%)</strong></td>
<td style="text-align: left;">Percentage of code that is unreachable or unused. This adds unnecessary complexity.</td>
<td style="text-align: left;">Should be 0%.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="452-project-metrics">4.5.2. Project metrics</h4>
The application consists of several project types, primarily class libraries and executables.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Number of projects</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Windows Application</strong></td>
<td style="text-align: left;">A desktop application with a graphical user interface, serving as the main control panel.</td>
<td style="text-align: left;">1 (<code>CIControlo.csproj</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Service</strong></td>
<td style="text-align: left;">A background service that runs without user interaction to perform automated tasks.</td>
<td style="text-align: left;">1 (<code>CIServico.csproj</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Class Library</strong></td>
<td style="text-align: left;">Reusable code libraries containing business logic, data access, UI components, or other shared functionality.</td>
<td style="text-align: left;">14</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Test Library</strong></td>
<td style="text-align: left;">A project containing unit or integration tests for other parts of the application.</td>
<td style="text-align: left;">1 (<code>CITestes.csproj</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Setup Project</strong></td>
<td style="text-align: left;">A Visual Studio Installer project for creating a deployment package.</td>
<td style="text-align: left;">1 (<code>SetupCIControlo.vdproj</code>)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="5-dependencies">5. Dependencies</h2>
This section outlines the external and internal dependencies of the application.
<h3 id="51-external-dependencies">5.1. External dependencies</h3>
The application relies on several third-party and internal shared libraries.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Dependency</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Assembly</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Runtime version</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">License</th>
<th style="text-align: left;">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>GenericNet</strong></td>
<td style="text-align: left;">A shared internal library providing common functionalities, including database access wrappers.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>GenericNet.dll</code></td>
<td style="text-align: left;">2.0.0.1</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal (File Share)</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Database connection, configuration.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>GenericLogNET</strong></td>
<td style="text-align: left;">A shared internal library for logging.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>GenericLogNET.dll</code></td>
<td style="text-align: left;">2.0.0.1</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal (File Share)</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Application-wide logging.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>NBIISNET</strong></td>
<td style="text-align: left;">A shared internal library, likely containing custom Windows Forms UI controls.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>NBIISNET.dll</code></td>
<td style="text-align: left;">2.0.5.2</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal (File Share)</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Custom UI controls like <code>ListViewBase</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CrystalDecisions</strong></td>
<td style="text-align: left;">A suite of libraries for creating and viewing reports.</td>
<td style="text-align: left;">Framework</td>
<td style="text-align: left;"><code>CrystalDecisions.*.dll</code></td>
<td style="text-align: left;">13.0.2000.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Third-Party</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Generating all application reports.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CGDSendWebmail</strong></td>
<td style="text-align: left;">A shared internal library for sending emails, possibly via an internal EWS or WebDAV interface.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>CGDSendWebmail.dll</code></td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal (File Share)</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Sending alert notifications.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Microsoft.VisualStudio.QualityTools.UnitTestFramework</strong></td>
<td style="text-align: left;">The Microsoft unit testing framework (MSTest).</td>
<td style="text-align: left;">Framework</td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.QualityTools.UnitTestFramework.dll</code></td>
<td style="text-align: left;">10.0.0.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Unit and integration testing.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="511-nuget-packages">5.1.1. Nuget packages</h4>
The application does not use a <code>packages.config</code> or <code>PackageReference</code> model for dependency management. All dependencies are included as direct assembly references, likely from a shared network drive (<code>\\sqc6001fas02\imagens\DriveW\GCAA\Gestao\SharedLibrary\</code>). This is a legacy approach to dependency management.
</div>
<div class="product-section">
<h2 id="6-security-and-compliance">6. Security and compliance</h2>
This section analyzes the security posture of the application based on common vulnerabilities and .NET-specific best practices.
<h3 id="61-security-mechanisms">6.1. Security mechanisms</h3>
The application employs basic, custom-built security mechanisms.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Concern</th>
<th style="text-align: left;">Implementation Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Authentication</strong></td>
<td style="text-align: left;">Custom authentication based on the current Windows user (<code>System.Windows.Forms.SystemInformation.UserName</code>). The user's identity is looked up in the <code>VW<em>PASSWD</em>GROUP</code> database view.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authorization</strong></td>
<td style="text-align: left;">Role-based authorization. The <code>User</code> object contains a <code>m<em>iUserGroup</code> property. Code throughout the application checks this integer value to grant or deny access to features (e.g., <code>if (m</em>oParameters.UserLogged.m_iUserGroup <= 1)</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ASP.NET Membership Provider in use</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used. The application uses a custom database-backed user store.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data protection</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Limited.</strong> Passwords for email notifications are masked in the UI (<code><strong></strong><strong></strong></code>) but likely stored in plaintext or reversibly encrypted in the database. There is no evidence of modern data protection APIs being used for sensitive data at rest.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Audit logging</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Present.</strong> The <code>GenericLogNET</code> library is used to log alerts and errors to the database, which serves as an audit trail for important system events.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Vulnerability management</strong></td>
<td style="text-align: left;">No evidence of automated security scanning tools or processes in the source code.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Compliance standards</strong></td>
<td style="text-align: left;">No explicit support for standards like GDPR or PCI-DSS is evident in the code.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="62-security-vulnerabilities">6.2. Security vulnerabilities</h3>
The following table outlines potential vulnerabilities based on the OWASP Top 10 (2021), inferred from the code structure and common .NET Framework patterns.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SEC-001</td>
<td style="text-align: left;">A01: Broken Access Control</td>
<td style="text-align: left;">Insufficiently granular access control.</td>
<td style="text-align: left;">Authorization is based on a simple integer group ID (<code>m<em>iUserGroup <= 1</code>). This is coarse-grained and may not be sufficient for complex permission models.</td>
<td style="text-align: left;">All forms with administrative actions, e.g., <code>ActividadesForm</code>, <code>UtilizadoresForm</code>.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement fine-grained, claims-based authorization.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A01</em>2021-Broken<em>Access</em>Control/">OWASP A01</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-002</td>
<td style="text-align: left;">A02: Cryptographic Failures</td>
<td style="text-align: left;">Use of weak or no encryption for secrets.</td>
<td style="text-align: left;">Passwords for email notifications (<code>passwd</code> parameter) are handled in plaintext within the code and are likely stored insecurely.</td>
<td style="text-align: left;"><code>ServAlertasSendWebmail.cs</code>, <code>AccaoParam.cs</code>.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use a secure secrets management system like Azure Key Vault and strong hashing algorithms for passwords.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A02<em>2021-Cryptographic</em>Failures/">OWASP A02</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-003</td>
<td style="text-align: left;">A03: Injection</td>
<td style="text-align: left;">Potential for SQL Injection.</td>
<td style="text-align: left;">The use of methods like <code>DirectSqlDataReader</code> and <code>DirectSqlNonQuery</code> with string concatenation to build queries (as seen in <code>ActividadeBalcaoForm.cs</code>) creates a high risk of SQL injection.</td>
<td style="text-align: left;">All data access code using string-based query construction.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use parameterized queries or a modern ORM like Entity Framework Core for all database access.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP A03</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-005</td>
<td style="text-align: left;">A06: Vulnerable & Outdated Components</td>
<td style="text-align: left;">Use of outdated .NET Framework and libraries.</td>
<td style="text-align: left;">The application targets .NET Framework 4.0, which is out of support. Referenced libraries like <code>CrystalDecisions</code> are old versions and may contain known vulnerabilities (CVEs).</td>
<td style="text-align: left;">All <code>.csproj</code> files.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate to a supported .NET version (e.g., .NET 8) and update all third-party libraries to their latest stable versions.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A06<em>2021-Vulnerable</em>and<em>Outdated</em>Components/">OWASP A06</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="63-advanced-and-net-specific-security-vulnerabilities">6.3. Advanced and .NET-specific security vulnerabilities</h3>
This table highlights vulnerabilities specific to the .NET Framework and the application's implementation.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category / Domain</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SEC-013</td>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Secrets stored in config files.</td>
<td style="text-align: left;">Database connection strings and potentially other secrets are stored in plaintext within <code>.config</code> files.</td>
<td style="text-align: left;">All <code>app.config</code> and <code>*.exe.config</code> files.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate all secrets to a secure storage solution like Azure Key Vault or use integrated authentication where possible.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/aspnet/core/security/key-vault-configuration">Secrets Management</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-016</td>
<td style="text-align: left;">Hardcoded Paths</td>
<td style="text-align: left;">Hardcoded UNC paths to shared libraries.</td>
<td style="text-align: left;">The project files contain hardcoded paths like <code>\\sqc6001fas02\imagens\DriveW\GCAA\Gestao\SharedLibrary\</code>. This is brittle and a security risk if the share is not properly secured.</td>
<td style="text-align: left;">All <code>.csproj</code> files with <code><HintPath></code>.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Manage dependencies via a package manager like NuGet and use relative paths or environment variables for file paths.</td>
<td style="text-align: left;">-</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="7-integrations">7. Integrations</h2>
The application integrates with several external and internal systems.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Integration type</th>
<th style="text-align: left;">Integration name</th>
<th style="text-align: left;">Integration description</th>
<th style="text-align: left;">Integration endpoint</th>
<th style="text-align: left;">Integration authentication</th>
<th style="text-align: left;">Integration data format</th>
<th style="text-align: left;">Integration protocols</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;"><strong>SDCIM Database</strong></td>
<td style="text-align: left;">Primary data store for all application data, including remittances, documents, users, and logs.</td>
<td style="text-align: left;">Multiple SQL Server instances (e.g., <code>VPC6001SQL111\S2K081</code>, <code>SQC6001SQL17\S2K082</code>).</td>
<td style="text-align: left;">Windows Authentication / SQL Server Authentication</td>
<td style="text-align: left;">Tabular (SQL)</td>
<td style="text-align: left;">TDS</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;"><strong>GCAA Database</strong></td>
<td style="text-align: left;">A separate database for the GCAA system, from which remittance data is imported.</td>
<td style="text-align: left;">Multiple SQL Server instances (e.g., <code>BDSPGCCALX</code>, <code>BDSPGCCAPT</code>).</td>
<td style="text-align: left;">Windows Authentication / SQL Server Authentication</td>
<td style="text-align: left;">Tabular (SQL)</td>
<td style="text-align: left;">TDS</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Web Service</strong></td>
<td style="text-align: left;"><strong>Insert Document Service</strong></td>
<td style="text-align: left;">An external SOAP web service used to submit MDI (Multi-function Device Interface) documents.</td>
<td style="text-align: left;"><code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code></td>
<td style="text-align: left;">None specified in the client code.</td>
<td style="text-align: left;">SOAP/XML</td>
<td style="text-align: left;">HTTP</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File System</strong></td>
<td style="text-align: left;"><strong>File Ingestion</strong></td>
<td style="text-align: left;">The application monitors directories for incoming <code>ENVM</code> and <code>ACOM</code> files for batch processing.</td>
<td style="text-align: left;">Configurable file paths (e.g., <code>c:\tmp\</code>).</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Fixed-width text</td>
<td style="text-align: left;">File I/O</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Email</strong></td>
<td style="text-align: left;"><strong>Alert Notifications</strong></td>
<td style="text-align: left;">Sends email alerts for system events.</td>
<td style="text-align: left;">Configured SMTP server (via <code>CGDSendWebmail</code> library).</td>
<td style="text-align: left;">Username/Password</td>
<td style="text-align: left;">SMTP</td>
<td style="text-align: left;">SMTP</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="8-testing">8. Testing</h2>
The solution includes a dedicated project for testing, indicating that testing is part of the development process.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Testing type</th>
<th style="text-align: left;">Testing framework</th>
<th style="text-align: left;">Testing tools</th>
<th style="text-align: left;">Test coverage (%)</th>
<th style="text-align: left;">Test strategy</th>
<th style="text-align: left;">Continuous Integration (CI)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Unit/Integration Testing</strong></td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.TestTools.UnitTesting</code> (MSTest)</td>
<td style="text-align: left;">Visual Studio Test Runner</td>
<td style="text-align: left;">Low (inferred). The single test file <code>CIServRemessaTestes.cs</code> suggests coverage is not comprehensive.</td>
<td style="text-align: left;">The tests appear to be integration tests rather than pure unit tests, as they instantiate concrete classes and require a database connection (<code>parameters.OpenConnection()</code>).</td>
<td style="text-align: left;">No CI/CD pipeline configuration files (e.g., <code>azure-pipelines.yml</code>) were found.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="9-known-issues-and-limitations">9. Known issues and limitations</h2>
This section outlines the top-50 known issues and limitations of the application, categorized by their impact on performance, supportability, and other factors.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Issue Id</th>
<th style="text-align: left;">Issue / limitation</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Workaround / strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ISSUE-001</td>
<td style="text-align: left;"><strong>End-of-Life .NET Framework 4.0</strong></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Migrate to a supported .NET version (e.g., .NET 8 or .NET Framework 4.8.1).</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-002</td>
<td style="text-align: left;"><strong>End-of-Life SQL Server 2008 R2</strong></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Database</td>
<td style="text-align: left;">Upgrade to a supported SQL Server version (e.g., SQL Server 2019/2022) or Azure SQL.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-003</td>
<td style="text-align: left;"><strong>Secrets in Configuration Files</strong></td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Vulnerability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>*.config</code> files</td>
<td style="text-align: left;">Migrate secrets to Azure Key Vault or another secure secrets management system.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-004</td>
<td style="text-align: left;"><strong>Monolithic Architecture</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Refactor into smaller, more manageable services or modules (e.g., microservices, Azure Functions).</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-005</td>
<td style="text-align: left;"><strong>Tight Coupling / No Dependency Injection</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All projects</td>
<td style="text-align: left;">Introduce a DI container and refactor classes to depend on abstractions (interfaces) instead of concretions.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-006</td>
<td style="text-align: left;"><strong>Legacy Windows Forms UI</strong></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIControlo</code>, <code>CIActividades</code></td>
<td style="text-align: left;">Rewrite the UI as a modern web application (e.g., Blazor, ASP.NET Core MVC).</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-007</td>
<td style="text-align: left;"><strong>Potential for SQL Injection</strong></td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Vulnerability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Data access layer</td>
<td style="text-align: left;">Refactor all data access to use parameterized queries or an ORM like Entity Framework Core.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-008</td>
<td style="text-align: left;"><strong>Lack of Automated CI/CD</strong></td>
<td style="text-align: left;">DevOps</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Implement a modern CI/CD pipeline using Azure DevOps or GitHub Actions.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-009</td>
<td style="text-align: left;"><strong>Hardcoded UNC Paths for Dependencies</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Brittleness</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>.csproj</code> files</td>
<td style="text-align: left;">Migrate shared libraries to a private NuGet feed for proper versioning and dependency management.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-010</td>
<td style="text-align: left;"><strong>Limited Scalability</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServico</code>, Database</td>
<td style="text-align: left;">Re-architect for cloud-native patterns to allow for horizontal scaling.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-011</td>
<td style="text-align: left;"><strong>Procedural Code in UI Event Handlers</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Refactor logic out of code-behind files into separate service or command handler classes.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-012</td>
<td style="text-align: left;"><strong>Use of Outdated Crystal Reports</strong></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Migrate reports to a modern reporting solution like Power BI or SSRS.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-013</td>
<td style="text-align: left;"><strong>Lack of Comprehensive Unit Tests</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All logic-heavy projects</td>
<td style="text-align: left;">Implement a comprehensive unit and integration testing strategy with improved code coverage.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-014</td>
<td style="text-align: left;"><strong>Synchronous Web Service Calls</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Brittleness</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Refactor to use asynchronous <code>async/await</code> patterns for all I/O-bound operations.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-015</td>
<td style="text-align: left;"><strong>Manual Installation Process</strong></td>
<td style="text-align: left;">DevOps</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>Install</code> directory</td>
<td style="text-align: left;">Automate deployment using infrastructure-as-code (IaC) tools like Bicep or Terraform.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-016</td>
<td style="text-align: left;"><strong>Inconsistent Naming Conventions</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Entire codebase</td>
<td style="text-align: left;">Enforce a consistent naming convention (e.g., standard C#/.NET conventions) and refactor the code.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-017</td>
<td style="text-align: left;"><strong>No Centralized Exception Handling Middleware</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServico</code>, <code>CIControlo</code></td>
<td style="text-align: left;">Implement a global exception handling policy to ensure all unhandled exceptions are caught and logged consistently.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-018</td>
<td style="text-align: left;"><strong>Direct Database Access from UI Projects</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIActividades.csproj</code></td>
<td style="text-align: left;">Refactor data access calls into a dedicated service or application layer, removing DB logic from the UI.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-019</td>
<td style="text-align: left;"><strong>Polling-Based Architecture</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIServico.csproj</code></td>
<td style="text-align: left;">Migrate to an event-driven architecture using a message broker (e.g., Azure Service Bus) to eliminate database polling.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-020</td>
<td style="text-align: left;"><strong>Manual Database Schema Management</strong></td>
<td style="text-align: left;">DevOps</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Database</td>
<td style="text-align: left;">Implement a database migration tool (e.g., EF Migrations, Flyway) to manage schema changes in a version-controlled manner.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-021</td>
<td style="text-align: left;"><strong>Limited observability</strong></td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIServico</code></td>
<td style="text-align: left;">Integrate with a modern monitoring tool like Azure Monitor or Datadog for better telemetry and diagnostics.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-022</td>
<td style="text-align: left;"><strong>No Single Sign-On (SSO) Support</strong></td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Usability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Authentication logic</td>
<td style="text-align: left;">Integrate with an identity provider like Microsoft Entra ID for SSO.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-023</td>
<td style="text-align: left;"><strong>Images Stored in Database</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Scalability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>Imagem_Balcao</code> table</td>
<td style="text-align: left;">Migrate image storage to a dedicated blob storage service like Azure Blob Storage.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-024</td>
<td style="text-align: left;"><strong>Hardcoded Configuration Values</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Throughout codebase</td>
<td style="text-align: left;">Externalize all configurable values (timeouts, file paths, etc.) into <code>.config</code> files or a central configuration service.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-025</td>
<td style="text-align: left;"><strong>Non-responsive UI during data loads</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Usability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All data-heavy forms</td>
<td style="text-align: left;">Implement background workers or <code>async/await</code> to load data without freezing the UI.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-026</td>
<td style="text-align: left;"><strong>Lack of a Health Check Endpoint</strong></td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIServico</code></td>
<td style="text-align: left;">Implement a health check endpoint for the Windows Service to allow for automated monitoring.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-027</td>
<td style="text-align: left;"><strong>Complex and Error-Prone Manual Deployment</strong></td>
<td style="text-align: left;">DevOps</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Deployment process</td>
<td style="text-align: left;">Create automated deployment scripts using PowerShell or a CI/CD tool.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-028</td>
<td style="text-align: left;"><strong>No Data Validation Layer</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Business logic layer</td>
<td style="text-align: left;">Implement a formal validation mechanism (e.g., FluentValidation) for all inputs.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-029</td>
<td style="text-align: left;"><strong>Shared Database for Multiple Concerns</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Database schema</td>
<td style="text-align: left;">Decompose the database schema to align with identified bounded contexts.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-030</td>
<td style="text-align: left;"><strong>Reliance on Windows-specific features</strong></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Portability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIServico</code>, <code>CIControlo</code></td>
<td style="text-align: left;">Abstract Windows-specific APIs (Event Log, etc.) to allow for potential cross-platform deployment.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-031</td>
<td style="text-align: left;"><strong>No API for external integration</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Extensibility</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Expose core functionalities via a modern REST or gRPC API to enable integration with other systems.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-032</td>
<td style="text-align: left;"><strong>Lack of internationalization support</strong></td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;">Usability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">UI layer</td>
<td style="text-align: left;">Refactor UI strings into resource files to support multiple languages.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-033</td>
<td style="text-align: left;"><strong>Outdated third-party libraries</strong></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>NBIISNET</code>, <code>GenericNet</code></td>
<td style="text-align: left;">Replace or upgrade all third-party libraries, especially those with known vulnerabilities.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-034</td>
<td style="text-align: left;"><strong>No structured logging</strong></td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>GenericLogNET</code></td>
<td style="text-align: left;">Migrate to a structured logging library like Serilog to enable better log querying and analysis.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-035</td>
<td style="text-align: left;"><strong>High Cyclomatic Complexity in Forms</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Refactor complex methods into smaller, single-purpose functions.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-036</td>
<td style="text-align: left;"><strong>Manual dependency management</strong></td>
<td style="text-align: left;">DevOps</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>.csproj</code> files</td>
<td style="text-align: left;">Migrate all dependencies to be managed by a NuGet server.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-037</td>
<td style="text-align: left;"><strong>Inconsistent error handling</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire codebase</td>
<td style="text-align: left;">Implement a consistent error handling strategy across all application layers.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-038</td>
<td style="text-align: left;"><strong>State managed in UI</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Windows Forms classes</td>
<td style="text-align: left;">Move state management out of UI components into a dedicated state management class or service.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-039</td>
<td style="text-align: left;"><strong>Lack of feature flags</strong></td>
<td style="text-align: left;">DevOps</td>
<td style="text-align: left;">Agility</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Introduce a feature flag system to enable/disable features without redeploying code.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-040</td>
<td style="text-align: left;"><strong>Database access from multiple layers</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">UI and Business Logic</td>
<td style="text-align: left;">Enforce a strict architectural rule where only the data access layer can interact with the database.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-041</td>
<td style="text-align: left;"><strong>No distributed tracing</strong></td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Implement distributed tracing (e.g., OpenTelemetry) to trace requests across components.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-042</td>
<td style="text-align: left;"><strong>VB.NET and C# mixed codebase</strong></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Consider converting the VB.NET project to C# for language consistency.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-043</td>
<td style="text-align: left;"><strong>No retry logic for transient failures</strong></td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Resilience</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Web service and DB calls</td>
<td style="text-align: left;">Implement a retry policy (e.g., using Polly) for operations that can fail transiently.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-044</td>
<td style="text-align: left;"><strong>Reliance on shared network drives</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">File ingestion, dependencies</td>
<td style="text-align: left;">Replace file share dependencies with more robust solutions like message queues or blob storage.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-045</td>
<td style="text-align: left;"><strong>No audit trail for configuration changes</strong></td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Compliance</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIConfiguration</code></td>
<td style="text-align: left;">Log all changes made to system configuration, including who made the change and when.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-046</td>
<td style="text-align: left;"><strong>Inefficient large data queries</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Scalability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Reporting and search forms</td>
<td style="text-align: left;">Optimize SQL queries, add indexes, and implement pagination for all large result sets.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-047</td>
<td style="text-align: left;"><strong>Lack of code documentation</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Entire codebase</td>
<td style="text-align: left;">Add XML comments to public methods and classes to improve maintainability.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-048</td>
<td style="text-align: left;"><strong>Setup project is obsolete</strong></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">DevOps</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>SetupCIControlo.vdproj</code></td>
<td style="text-align: left;">Replace the Visual Studio Installer project with a modern deployment technology like MSIX or a script-based installer.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-049</td>
<td style="text-align: left;"><strong>No protection against brute-force attacks</strong></td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Vulnerability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Authentication logic</td>
<td style="text-align: left;">Implement account lockout policies after a certain number of failed login attempts.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-050</td>
<td style="text-align: left;"><strong>No Content Security Policy (if web-based)</strong></td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Vulnerability</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Not applicable for WinForms, but a key consideration if migrated to the web.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="10-defects-and-inefficiencies">10. Defects and inefficiencies</h2>
This section details the top-50 defects and inefficiencies found in the application, focusing on code quality, performance, and adherence to best practices.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Defect Id</th>
<th style="text-align: left;">Defect / inefficiency</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Root cause</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Recommended fix</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">DEF-001</td>
<td style="text-align: left;"><strong>Large God Class (<code>ActividadeBalcaoForm</code>)</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Code Smell</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Violation of Single Responsibility Principle.</td>
<td style="text-align: left;"><code>CIActividades.csproj</code></td>
<td style="text-align: left;">Refactor the form into smaller, more focused components using patterns like MVP or MVVM.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-002</td>
<td style="text-align: left;"><strong>Direct SQL in Code-Behind</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bad Practice</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Lack of a proper data access layer.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code>, <code>SacoForm.cs</code></td>
<td style="text-align: left;">Move all data access logic to a dedicated repository or service layer.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-003</td>
<td style="text-align: left;"><strong>Empty <code>catch</code> blocks</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Swallowing exceptions without logging or handling.</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Log the exception and re-throw or handle it appropriately. Never use empty catch blocks.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-004</td>
<td style="text-align: left;"><strong>Mixing UI and Business Logic</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor separation of concerns.</td>
<td style="text-align: left;"><code>CIActividades.csproj</code>, <code>CIConfiguration.csproj</code></td>
<td style="text-align: left;">Extract business logic into separate service classes that can be called from the UI.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-005</td>
<td style="text-align: left;"><strong>Inefficient Database Polling</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bottleneck</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Legacy architecture.</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">Replace polling with an event-driven architecture using a message queue.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-006</td>
<td style="text-align: left;"><strong>Manual Transaction Management</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of Unit of Work pattern.</td>
<td style="text-align: left;"><code>ActividadesForm.cs</code>, <code>ServRemessa.cs</code></td>
<td style="text-align: left;">Implement a Unit of Work pattern to manage transactions declaratively and ensure consistency.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-007</td>
<td style="text-align: left;"><strong>In-place String Concatenation for SQL</strong></td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Vulnerability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor coding practices.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Replace all instances with parameterized queries.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-008</td>
<td style="text-align: left;"><strong>Blocking UI on Long Operations</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">User Experience</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of asynchronous programming.</td>
<td style="text-align: left;"><code>PesquisasForm.cs</code>, <code>BalcaoForm.cs</code></td>
<td style="text-align: left;">Use <code>async/await</code> for all I/O-bound operations (database queries, file access) to keep the UI responsive.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-009</td>
<td style="text-align: left;"><strong>No Centralized Configuration Source</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Multiple <code>.config</code> files and <code>Settings</code> classes.</td>
<td style="text-align: left;">Consolidate configuration into a single source, preferably managed outside the application (e.g., Azure App Configuration).</td>
</tr>
<tr>
<td style="text-align: left;">DEF-010</td>
<td style="text-align: left;"><strong>Redundant Data Fetches</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of caching.</td>
<td style="text-align: left;">All data-intensive forms.</td>
<td style="text-align: left;">Implement a caching layer (in-memory or distributed) for frequently accessed, non-volatile data.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-011</td>
<td style="text-align: left;"><strong>Use of <code>MessageBox</code> in non-UI code</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bad Practice</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Mixing concerns.</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;">Business logic libraries should not interact with the UI. Use exceptions or return codes to signal outcomes.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-012</td>
<td style="text-align: left;"><strong>Magic Strings for Statuses/Types</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Code Smell</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practice.</td>
<td style="text-align: left;">Throughout the codebase</td>
<td style="text-align: left;">Replace magic strings with enums or constant values for better readability and maintainability.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-013</td>
<td style="text-align: left;"><strong>Lack of Code Reusability</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Duplicated code blocks.</td>
<td style="text-align: left;">Multiple forms and services</td>
<td style="text-align: left;">Create shared helper methods or services for common tasks like data validation and formatting.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-014</td>
<td style="text-align: left;"><strong>Global State via <code>CIGlobalParameters</code></strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Bad Practice</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use of a global singleton-like object.</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Refactor to use dependency injection to provide state and services where needed.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-015</td>
<td style="text-align: left;"><strong>Complicated Inheritance Hierarchies</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Complexity</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Overuse of inheritance for UI controls.</td>
<td style="text-align: left;"><code>NBIISNET</code> library</td>
<td style="text-align: left;">Favor composition over inheritance for UI components to improve flexibility.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-016</td>
<td style="text-align: left;"><strong>Long Methods</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Code Smell</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Violation of SRP at method level.</td>
<td style="text-align: left;"><code>ServRemessa.cs</code>, <code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Break down long methods into smaller, well-named private methods.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-017</td>
<td style="text-align: left;"><strong>Unused Variables and Methods</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Dead Code</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor code hygiene.</td>
<td style="text-align: left;">Throughout codebase</td>
<td style="text-align: left;">Use a static analyzer to identify and remove dead code.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-018</td>
<td style="text-align: left;"><strong>Deeply Nested Conditional Logic</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Complexity</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">High cyclomatic complexity.</td>
<td style="text-align: left;"><code>TratarTranchesBalcao</code> method</td>
<td style="text-align: left;">Refactor nested <code>if</code> statements using guard clauses, polymorphism, or strategy patterns.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-019</td>
<td style="text-align: left;"><strong>No Separation of Models (DTOs vs. Domain)</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Anemic domain model.</td>
<td style="text-align: left;">Data-centric classes</td>
<td style="text-align: left;">Introduce Data Transfer Objects (DTOs) for the UI and keep domain models separate.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-020</td>
<td style="text-align: left;"><strong>Poorly Named Variables</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Readability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Inconsistent naming (e.g., <code>m_oParameters</code>).</td>
<td style="text-align: left;">Entire codebase</td>
<td style="text-align: left;">Refactor to use clear, intention-revealing names according to C# conventions.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-021</td>
<td style="text-align: left;"><strong><code>IDisposable</code> not always implemented/used</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Resource leaks.</td>
<td style="text-align: left;">Database connection handling</td>
<td style="text-align: left;">Ensure all disposable objects (connections, streams) are wrapped in <code>using</code> statements or disposed of in <code>finally</code> blocks.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-022</td>
<td style="text-align: left;"><strong>Inefficient String Manipulations</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Using <code>+</code> for string concatenation in loops.</td>
<td style="text-align: left;">Logging and query building</td>
<td style="text-align: left;">Use <code>StringBuilder</code> for building strings in loops.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-023</td>
<td style="text-align: left;"><strong>Lack of comments for complex logic</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor documentation.</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;">Add comments to explain the "why" behind complex business rules and algorithms.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-024</td>
<td style="text-align: left;"><strong>Synchronous File I/O</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bottleneck</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Blocking operations.</td>
<td style="text-align: left;"><code>CIFicheiro</code> project</td>
<td style="text-align: left;">Use asynchronous file I/O operations to avoid blocking threads.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-025</td>
<td style="text-align: left;"><strong>Over-fetching data from database</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Using <code>SELECT *</code>.</td>
<td style="text-align: left;">Data access layer</td>
<td style="text-align: left;">Specify only the required columns in <code>SELECT</code> statements to reduce network traffic and memory usage.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-026</td>
<td style="text-align: left;"><strong>Tight coupling to <code>System.Windows.Forms</code></strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Portability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Logic depends on UI framework.</td>
<td style="text-align: left;">Business logic projects</td>
<td style="text-align: left;">Remove all references to <code>System.Windows.Forms</code> from non-UI projects.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-027</td>
<td style="text-align: left;"><strong>Configuration hardcoded in <code>Properties.Settings</code></strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Brittleness</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inflexible configuration.</td>
<td style="text-align: left;">All projects using <code>Settings.settings</code></td>
<td style="text-align: left;">Move settings to <code>app.config</code> or a centralized configuration source for easier management.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-028</td>
<td style="text-align: left;"><strong>No logging correlation IDs</strong></td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Difficult to trace operations.</td>
<td style="text-align: left;"><code>GenericLogNET</code></td>
<td style="text-align: left;">Add a correlation ID to all log messages to trace a single operation through the system.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-029</td>
<td style="text-align: left;"><strong>Public fields instead of properties</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bad Practice</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor encapsulation.</td>
<td style="text-align: left;">Data classes like <code>User.cs</code></td>
<td style="text-align: left;">Convert all public fields to properties with appropriate accessors.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-030</td>
<td style="text-align: left;"><strong>Returning <code>null</code> instead of empty collections</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Can cause <code>NullReferenceException</code>.</td>
<td style="text-align: left;">Methods returning <code>List</code> or <code>Array</code></td>
<td style="text-align: left;">Always return an empty collection instead of <code>null</code> to simplify client code.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-031</td>
<td style="text-align: left;"><strong>No validation on configuration load</strong></td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Brittleness</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">System can start in invalid state.</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Validate all loaded configuration values at startup and fail fast if they are invalid.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-032</td>
<td style="text-align: left;"><strong>Mixing of concerns in projects</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">e.g., <code>CIActividades</code> has UI and logic.</td>
<td style="text-align: left;"><code>CIActividades.csproj</code></td>
<td style="text-align: left;">Split projects based on a single responsibility (e.g., <code>SDCIM.UI</code>, <code>SDCIM.Logic</code>).</td>
</tr>
<tr>
<td style="text-align: left;">DEF-033</td>
<td style="text-align: left;"><strong>Inefficient use of database connections</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Scalability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Connections held open for too long.</td>
<td style="text-align: left;">Data access code</td>
<td style="text-align: left;">Open database connections as late as possible and close them as early as possible.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-034</td>
<td style="text-align: left;"><strong>Lack of defensive coding</strong></td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Brittleness</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Assuming valid inputs.</td>
<td style="text-align: left;">All methods accepting parameters</td>
<td style="text-align: left;">Add null checks and validation for all public method parameters.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-035</td>
<td style="text-align: left;"><strong>No use of modern C# features</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Code is verbose.</td>
<td style="text-align: left;">Entire C# codebase</td>
<td style="text-align: left;">Refactor to use modern C# features like LINQ, expression-bodied members, and pattern matching.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-036</td>
<td style="text-align: left;"><strong>No graceful shutdown logic</strong></td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Data Integrity</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Service can be terminated mid-process.</td>
<td style="text-align: left;"><code>CIServico.cs</code></td>
<td style="text-align: left;">Implement graceful shutdown logic in the Windows Service to complete in-flight work before stopping.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-037</td>
<td style="text-align: left;"><strong>Large, monolithic <code>.sql</code> files</strong></td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Brittleness</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Hard to manage schema.</td>
<td style="text-align: left;">Database project/scripts</td>
<td style="text-align: left;">Break down large SQL scripts into smaller, idempotent, version-controlled migration scripts.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-038</td>
<td style="text-align: left;"><strong>No timeout on external web service calls</strong></td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Brittleness</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Can hang indefinitely.</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Implement a timeout and retry policy for all external network calls.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-039</td>
<td style="text-align: left;"><strong>Lack of data indexing strategy</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bottleneck</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Slow queries.</td>
<td style="text-align: left;">Database schema</td>
<td style="text-align: left;">Analyze query execution plans and add appropriate indexes to frequently queried columns.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-040</td>
<td style="text-align: left;"><strong>In-memory data filtering/sorting</strong></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Scalability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Fetching all data then filtering.</td>
<td style="text-align: left;">UI and reporting logic</td>
<td style="text-align: left;">Push all filtering, sorting, and aggregation logic to the database server via SQL queries.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-041</td>
<td style="text-align: left;"><strong>Mutable static state</strong></td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Race conditions in multi-threaded service.</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Avoid mutable static state. Use instance-based objects managed by a DI container.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-042</td>
<td style="text-align: left;"><strong>No clear ownership of data</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Multiple services update same tables.</td>
<td style="text-align: left;">Database schema</td>
<td style="text-align: left;">Define clear ownership boundaries for data tables, ideally aligning with bounded contexts.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-043</td>
<td style="text-align: left;"><strong>Lack of abstraction over external services</strong></td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Brittleness</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Direct dependency on SOAP client.</td>
<td style="text-align: left;"><code>CIServRemessas.cs</code></td>
<td style="text-align: left;">Create an adapter interface for the external web service to decouple business logic from the specific implementation.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-044</td>
<td style="text-align: left;"><strong>No versioning for the application</strong></td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Assembly versions are static.</td>
<td style="text-align: left;">AssemblyInfo files</td>
<td style="text-align: left;">Implement a consistent versioning strategy (e.g., SemVer) for all assemblies.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-045</td>
<td style="text-align: left;"><strong>Codebase is not self-documenting</strong></td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Readability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Relies on external knowledge.</td>
<td style="text-align: left;">Entire codebase</td>
<td style="text-align: left;">Refactor code to be more expressive, reducing the need for comments.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-046</td>
<td style="text-align: left;"><strong>No use of ORM</strong></td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Productivity</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Manual object mapping.</td>
<td style="text-align: left;">Data access layer</td>
<td style="text-align: left;">Introduce a lightweight ORM like Dapper or a full ORM like EF Core to automate data mapping.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-047</td>
<td style="text-align: left;"><strong>Complex boolean logic</strong></td>
<td style="text-align: left;">Readability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Hard to understand conditions.</td>
<td style="text-align: left;">Conditional statements</td>
<td style="text-align: left;">Encapsulate complex conditions into well-named boolean methods or properties.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-048</td>
<td style="text-align: left;"><strong>No separation between command and query</strong></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Complexity</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Single methods do both.</td>
<td style="text-align: left;">Service layer</td>
<td style="text-align: left;">Consider a CQRS-like approach by separating methods that change state (commands) from those that read state (queries).</td>
</tr>
<tr>
<td style="text-align: left;">DEF-049</td>
<td style="text-align: left;"><strong>Test project mixes unit and integration tests</strong></td>
<td style="text-align: left;">Testing</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Unclear test scope.</td>
<td style="text-align: left;"><code>CITestes.csproj</code></td>
<td style="text-align: left;">Separate tests into distinct projects (<code><em>.UnitTests</code>, <code></em>.IntegrationTests</code>) for clarity.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-050</td>
<td style="text-align: left;"><strong>No automated code quality checks</strong></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inconsistent quality.</td>
<td style="text-align: left;">Development process</td>
<td style="text-align: left;">Integrate static analysis tools (e.g., SonarQube, Roslyn Analyzers) into the build process.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="11-vulnerabilities">11. Vulnerabilities</h2>
This section details the top-50 security vulnerabilities identified in the application, ranked by potential impact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Vulnerability Id</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Root cause</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Recommended fix</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">VULN-001</td>
<td style="text-align: left;"><strong>SQL Injection</strong></td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">CWE-89</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">String concatenation in SQL queries.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Use parameterized queries exclusively.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-002</td>
<td style="text-align: left;"><strong>Plaintext Secrets in Configuration</strong></td>
<td style="text-align: left;">Cryptographic Failure</td>
<td style="text-align: left;">CWE-312</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Lack of secrets management.</td>
<td style="text-align: left;"><code>app.config</code>, <code>*.exe.config</code></td>
<td style="text-align: left;">Use Azure Key Vault or equivalent.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-003</td>
<td style="text-align: left;"><strong>Use of Unsupported Framework (.NET 4.0)</strong></td>
<td style="text-align: left;">Vulnerable Component</td>
<td style="text-align: left;">CWE-1104</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Outdated technology stack.</td>
<td style="text-align: left;">All projects targeting .NET Framework 4.0</td>
<td style="text-align: left;">Migrate to a supported .NET version.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-004</td>
<td style="text-align: left;"><strong>Insecure Custom Authentication</strong></td>
<td style="text-align: left;">Identification & Authentication Failure</td>
<td style="text-align: left;">CWE-287</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Home-grown security logic.</td>
<td style="text-align: left;"><code>User.cs</code>, <code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Replace with a standard, hardened authentication library like ASP.NET Core Identity or an IdP.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-005</td>
<td style="text-align: left;"><strong>Insufficient Logging and Monitoring</strong></td>
<td style="text-align: left;">Security Logging Failure</td>
<td style="text-align: left;">CWE-778</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Logging is present but lacks security event focus.</td>
<td style="text-align: left;"><code>GenericLogNET</code> usage</td>
<td style="text-align: left;">Implement specific logging for security events like failed logins, access denied, and configuration changes.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-006</td>
<td style="text-align: left;"><strong>Hardcoded UNC Paths</strong></td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">CWE-259</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Brittle and insecure design.</td>
<td style="text-align: left;"><code>.csproj</code> files</td>
<td style="text-align: left;">Centralize paths in configuration and secure the file shares with minimal permissions.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-007</td>
<td style="text-align: left;"><strong>Improper Exception Handling (Swallowing)</strong></td>
<td style="text-align: left;">Cryptographic Failure</td>
<td style="text-align: left;">CWE-388</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Empty catch blocks swallowing errors.</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Log all exceptions and fail securely.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-008</td>
<td style="text-align: left;"><strong>Information Exposure Through Error Messages</strong></td>
<td style="text-align: left;">Sensitive Data Exposure</td>
<td style="text-align: left;">CWE-200</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Verbose error messages shown in <code>MessageBox</code>.</td>
<td style="text-align: left;">Throughout the UI code.</td>
<td style="text-align: left;">Show generic error messages to users and log detailed exception information.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-009</td>
<td style="text-align: left;"><strong>Use of Outdated SQL Server 2008 R2</strong></td>
<td style="text-align: left;">Vulnerable Component</td>
<td style="text-align: left;">CWE-1104</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">End-of-life database server.</td>
<td style="text-align: left;">Database infrastructure</td>
<td style="text-align: left;">Migrate to a supported version of SQL Server or Azure SQL.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-010</td>
<td style="text-align: left;"><strong>Broken Access Control</strong></td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">CWE-284</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Coarse-grained role checks (<code>UserGroup <= 1</code>).</td>
<td style="text-align: left;"><code>ConfirmaPrivilegios()</code> method</td>
<td style="text-align: left;">Implement fine-grained, permission-based authorization.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-011</td>
<td style="text-align: left;"><strong>Missing Account Lockout Mechanism</strong></td>
<td style="text-align: left;">Identification & Authentication Failure</td>
<td style="text-align: left;">CWE-307</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">No protection against brute-force attacks.</td>
<td style="text-align: left;">Authentication logic</td>
<td style="text-align: left;">Implement an account lockout policy after multiple failed login attempts.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-012</td>
<td style="text-align: left;"><strong>Plaintext Passwords in Memory/DB</strong></td>
<td style="text-align: left;">Cryptographic Failure</td>
<td style="text-align: left;">CWE-312</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Email passwords handled as strings.</td>
<td style="text-align: left;"><code>ServAlertasSendWebmail.cs</code></td>
<td style="text-align: left;">Hash and salt all stored passwords; use secure string handling for passwords in memory.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-013</td>
<td style="text-align: left;"><strong>Insecure Direct Object Reference (IDOR)</strong></td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">CWE-639</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">No check if user can access specific record.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm</code> detail views</td>
<td style="text-align: left;">Add ownership checks to all data retrieval queries to ensure users can only see their own data.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-014</td>
<td style="text-align: left;"><strong>Lack of Input Validation</strong></td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">CWE-20</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Trusting user input from UI fields.</td>
<td style="text-align: left;">All <code>TextBox</code> controls and form inputs</td>
<td style="text-align: left;">Implement server-side validation for all user-provided data.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-015</td>
<td style="text-align: left;"><strong>Unencrypted Communication with Web Service</strong></td>
<td style="text-align: left;">Cryptographic Failure</td>
<td style="text-align: left;">CWE-319</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">SOAP endpoint is HTTP, not HTTPS.</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Enforce TLS/HTTPS for all external service communication.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-016</td>
<td style="text-align: left;"><strong>Outdated Third-Party Libraries (Crystal Reports)</strong></td>
<td style="text-align: left;">Vulnerable Component</td>
<td style="text-align: left;">CWE-1104</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Old libraries may have known CVEs.</td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Update all third-party libraries to their latest patched versions.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-017</td>
<td style="text-align: left;"><strong>No CSRF Protection (if migrated to web)</strong></td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">CWE-352</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">WinForms is not vulnerable to CSRF.</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">A key vulnerability to address if the UI is modernized as a web application.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-018</td>
<td style="text-align: left;"><strong>Lack of Security Headers (if migrated to web)</strong></td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">CWE-693</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">WinForms is not vulnerable.</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">A key hardening measure for a future web-based UI (HSTS, CSP, etc.).</td>
</tr>
<tr>
<td style="text-align: left;">VULN-019</td>
<td style="text-align: left;"><strong>Reliance on Obsolete <code>System.Web.Services</code></strong></td>
<td style="text-align: left;">Vulnerable Component</td>
<td style="text-align: left;">CWE-1104</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Legacy SOAP client technology.</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Replace with modern <code>HttpClient</code> or WCF/gRPC clients.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-020</td>
<td style="text-align: left;"><strong>Information Leakage in Logs</strong></td>
<td style="text-align: left;">Sensitive Data Exposure</td>
<td style="text-align: left;">CWE-532</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Potentially logging sensitive user data.</td>
<td style="text-align: left;"><code>GenericLogNET</code> usage</td>
<td style="text-align: left;">Audit all logging statements to ensure no PII or secrets are being logged.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-021</td>
<td style="text-align: left;"><strong>No File Upload Validation</strong></td>
<td style="text-align: left;">Unrestricted File Upload</td>
<td style="text-align: left;">CWE-434</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">If file ingestion path is user-controllable.</td>
<td style="text-align: left;"><code>CIFicheiro</code> project</td>
<td style="text-align: left;">Validate file types, names, and content before processing.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-022</td>
<td style="text-align: left;"><strong>Use of <code>SystemInformation.UserName</code> for Auth</strong></td>
<td style="text-align: left;">Identification & Authentication Failure</td>
<td style="text-align: left;">CWE-302</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Relies on ambient, non-verified identity.</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Implement a robust authentication scheme that requires explicit credentials.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-023</td>
<td style="text-align: left;"><strong>Potential for Path Traversal</strong></td>
<td style="text-align: left;">Path Traversal</td>
<td style="text-align: left;">CWE-22</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">If file paths are constructed from user input.</td>
<td style="text-align: left;"><code>CIFicheiro</code> project</td>
<td style="text-align: left;">Sanitize and validate all file paths; use a whitelist of allowed directories.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-024</td>
<td style="text-align: left;"><strong>Mutable Public Static Objects</strong></td>
<td style="text-align: left;">Race Condition</td>
<td style="text-align: left;">CWE-362</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIGlobalParameters</code> can be modified by multiple threads.</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Avoid mutable static state; use thread-safe patterns or dependency injection.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-025</td>
<td style="text-align: left;"><strong>No Audit Trail for Security-Sensitive Actions</strong></td>
<td style="text-align: left;">Insufficient Logging</td>
<td style="text-align: left;">CWE-778</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Manual state changes may not be logged.</td>
<td style="text-align: left;"><code>MudarEstadoForm.cs</code></td>
<td style="text-align: left;">Create a specific audit log for all administrative actions, recording who, what, and when.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-026</td>
<td style="text-align: left;"><strong>Insecure Deserialization (if XML is from untrusted source)</strong></td>
<td style="text-align: left;">Insecure Deserialization</td>
<td style="text-align: left;">CWE-502</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Parsing external files.</td>
<td style="text-align: left;"><code>CIFicheiro</code> project</td>
<td style="text-align: left;">Use a safe deserializer and validate the object graph after deserialization.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-027</td>
<td style="text-align: left;"><strong>Lack of Egress Filtering</strong></td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">CWE-1050</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Application can connect to any external IP.</td>
<td style="text-align: left;">Network configuration</td>
<td style="text-align: left;">Restrict outbound network connections to only known, necessary endpoints.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-028</td>
<td style="text-align: left;"><strong>Database credentials with excessive privileges</strong></td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">CWE-272</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Application user likely has <code>db_owner</code> role.</td>
<td style="text-align: left;">Database connection strings</td>
<td style="text-align: left;">Apply the principle of least privilege; grant only necessary permissions (SELECT, INSERT, etc.) on specific objects.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-029</td>
<td style="text-align: left;"><strong>No protection against Denial of Service (DoS)</strong></td>
<td style="text-align: left;">Availability</td>
<td style="text-align: left;">CWE-400</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Large files or requests can exhaust resources.</td>
<td style="text-align: left;">File/Service endpoints</td>
<td style="text-align: left;">Implement size limits on file uploads and request payloads.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-030</td>
<td style="text-align: left;"><strong>Session Management Issues (if applicable)</strong></td>
<td style="text-align: left;">Identification & Authentication Failure</td>
<td style="text-align: left;">CWE-384</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">No formal session management.</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Not a primary risk for this architecture but would be for a web migration.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-031</td>
<td style="text-align: left;"><strong>Weak Random Number Generation</strong></td>
<td style="text-align: left;">Cryptographic Failure</td>
<td style="text-align: left;">CWE-338</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">If <code>System.Random</code> is used for security purposes.</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Use <code>System.Security.Cryptography.RandomNumberGenerator</code> for all cryptographic randomness needs.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-032</td>
<td style="text-align: left;"><strong>Lack of code signing</strong></td>
<td style="text-align: left;">Software and Data Integrity Failure</td>
<td style="text-align: left;">CWE-494</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Binaries can be tampered with.</td>
<td style="text-align: left;">All executables and DLLs</td>
<td style="text-align: left;">Sign all assemblies with a trusted certificate to ensure their integrity.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-033</td>
<td style="text-align: left;"><strong>No validation of external service certificate</strong></td>
<td style="text-align: left;">Cryptographic Failure</td>
<td style="text-align: left;">CWE-295</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Susceptible to man-in-the-middle attacks.</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Ensure TLS certificate validation is enabled and configured correctly.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-034</td>
<td style="text-align: left;"><strong>Use of Obsolete Setup Project</strong></td>
<td style="text-align: left;">Vulnerable Component</td>
<td style="text-align: left;">CWE-1104</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>.vdproj</code> is an outdated technology.</td>
<td style="text-align: left;"><code>SetupCIControlo.vdproj</code></td>
<td style="text-align: left;">Modern installers provide better security features and update mechanisms.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-035</td>
<td style="text-align: left;"><strong>No Resource Limiting</strong></td>
<td style="text-align: left;">Availability</td>
<td style="text-align: left;">CWE-770</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">A single large remittance could block the service.</td>
<td style="text-align: left;"><code>CIServico</code></td>
<td style="text-align: left;">Implement resource limits and throttling to prevent one task from starving others.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-036</td>
<td style="text-align: left;"><strong>User enumeration vulnerability</strong></td>
<td style="text-align: left;">Identification & Authentication Failure</td>
<td style="text-align: left;">CWE-203</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Error messages might differ for valid/invalid users.</td>
<td style="text-align: left;">Authentication logic</td>
<td style="text-align: left;">Ensure error messages are generic for failed login attempts.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-037</td>
<td style="text-align: left;"><strong>No runtime application self-protection (RASP)</strong></td>
<td style="text-align: left;">Insufficient Protection</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">No active defense mechanisms.</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Consider using RASP tools for critical on-premises applications.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-038</td>
<td style="text-align: left;"><strong>Lack of security testing in lifecycle</strong></td>
<td style="text-align: left;">Improper Engineering</td>
<td style="text-align: left;">CWE-1279</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">No SAST/DAST in place.</td>
<td style="text-align: left;">Development process</td>
<td style="text-align: left;">Integrate static and dynamic application security testing into the CI/CD pipeline.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-039</td>
<td style="text-align: left;"><strong>No central security policy enforcement</strong></td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Security checks are scattered.</td>
<td style="text-align: left;">Entire codebase</td>
<td style="text-align: left;">Use centralized middleware or AOP for enforcing security policies.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-040</td>
<td style="text-align: left;"><strong>Insecure file permissions on log files</strong></td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">CWE-276</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Logs might be world-readable.</td>
<td style="text-align: left;">Logging configuration</td>
<td style="text-align: left;">Ensure log files are created with restrictive permissions.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-041</td>
<td style="text-align: left;"><strong>Sensitive data in memory for long periods</strong></td>
<td style="text-align: left;">Sensitive Data Exposure</td>
<td style="text-align: left;">CWE-316</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Secrets held in memory.</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Minimize the lifetime of sensitive data in memory; clear it as soon as it's no longer needed.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-042</td>
<td style="text-align: left;"><strong>No data classification</strong></td>
<td style="text-align: left;">Insufficient Logging and Monitoring</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All data is treated the same.</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Classify data (e.g., Public, Internal, Confidential) to apply appropriate security controls.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-043</td>
<td style="text-align: left;"><strong>Lack of a formal incident response plan</strong></td>
<td style="text-align: left;">Insufficient Logging and Monitoring</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">No plan for handling a breach.</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Develop and test an incident response plan for the application.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-044</td>
<td style="text-align: left;"><strong>No protection against memory scraping</strong></td>
<td style="text-align: left;">Sensitive Data Exposure</td>
<td style="text-align: left;">CWE-214</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">PII in memory could be scraped.</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Use secure string types and minimize the time sensitive data is in memory.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-045</td>
<td style="text-align: left;"><strong>Lack of dependency vulnerability scanning</strong></td>
<td style="text-align: left;">Vulnerable Component</td>
<td style="text-align: left;">CWE-1357</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">No process for checking CVEs in libraries.</td>
<td style="text-align: left;">Development process</td>
<td style="text-align: left;">Implement automated dependency scanning (e.g., GitHub Dependabot, Snyk).</td>
</tr>
<tr>
<td style="text-align: left;">VULN-046</td>
<td style="text-align: left;"><strong>No password complexity rules</strong></td>
<td style="text-align: left;">Identification & Authentication Failure</td>
<td style="text-align: left;">CWE-521</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Users can set weak passwords.</td>
<td style="text-align: left;">User management forms</td>
<td style="text-align: left;">Enforce strong password complexity, history, and expiration policies.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-047</td>
<td style="text-align: left;"><strong>Use of non-parameterized stored procedures</strong></td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">CWE-89</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">If stored procedures use dynamic SQL.</td>
<td style="text-align: left;">Database scripts</td>
<td style="text-align: left;">Ensure all stored procedures use parameters and avoid dynamic SQL with concatenated inputs.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-048</td>
<td style="text-align: left;"><strong>No defense against replay attacks</strong></td>
<td style="text-align: left;">Identification & Authentication Failure</td>
<td style="text-align: left;">CWE-294</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">If tokens or credentials can be re-used.</td>
<td style="text-align: left;">Authentication logic</td>
<td style="text-align: left;">Use nonces or timestamps in authentication requests to prevent replay attacks.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-049</td>
<td style="text-align: left;"><strong>Server-Side Request Forgery (SSRF) risk</strong></td>
<td style="text-align: left;">Server-Side Request Forgery</td>
<td style="text-align: left;">CWE-918</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">If web service URL is configurable by user.</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Whitelist allowed domains for outbound connections; do not allow arbitrary URLs.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-050</td>
<td style="text-align: left;"><strong>External XML Entity (XXE) Injection</strong></td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">CWE-611</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">If parsing untrusted XML files.</td>
<td style="text-align: left;"><code>CIFicheiro</code> project</td>
<td style="text-align: left;">Disable DTD processing and external entity resolution in the XML parser.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="12-supportability-and-maintainability">12. Supportability and maintainability</h2>
This section analyzes the support lifecycle of the key technologies used in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Current version</th>
<th style="text-align: left;">End of support date</th>
<th style="text-align: left;">Supportability</th>
<th style="text-align: left;">Latest stable version</th>
<th style="text-align: left;">Notes</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>.NET Framework</strong></td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">4.8.1</td>
<td style="text-align: left;">The core runtime is out of support and no longer receives security updates. This is a critical risk.</td>
<td style="text-align: left;"><a href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-net-framework">.NET Framework Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Microsoft SQL Server</strong></td>
<td style="text-align: left;">2008 R2 (inferred)</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">2022</td>
<td style="text-align: left;">The inferred database version is past its extended support date, posing a significant security and operational risk.</td>
<td style="text-align: left;"><a href="https://docs.microsoft.com/en-us/lifecycle/products/sql-server-2008-r2">SQL Server Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server</strong></td>
<td style="text-align: left;">2008 R2 (assumed)</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">2022</td>
<td style="text-align: left;">The likely target OS for a .NET 4.0 application is out of support.</td>
<td style="text-align: left;"><a href="https://docs.microsoft.com/en-us/lifecycle/products/windows-server-2008-r2">Windows Server Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Crystal Reports</strong></td>
<td style="text-align: left;">13.0.2000.0 (for VS2010)</td>
<td style="text-align: left;">Obsolete</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">This version is very old and not supported for modern .NET applications.</td>
<td style="text-align: left;">-</td>
</tr>
</tbody>
</table>
</div>
<h3 id="121-net-framework-lifecycle">12.1. .NET Framework lifecycle</h3>
This table provides a comprehensive overview of the .NET Framework support lifecycle to contextualize the application's current version.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">.NET Framework 4.8.1</td>
<td style="text-align: left;">2022-08-09</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.8</td>
<td style="text-align: left;">2019-04-18</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.7.2</td>
<td style="text-align: left;">2018-04-30</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.6.2</td>
<td style="text-align: left;">2016-08-02</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.5.2</td>
<td style="text-align: left;">2014-05-05</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.0</strong></td>
<td style="text-align: left;"><strong>2010-04-12</strong></td>
<td style="text-align: left;"><strong>2016-01-12</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>No</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Yes</strong></td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 3.5 SP1</td>
<td style="text-align: left;">2007-11-19</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 2.0</td>
<td style="text-align: left;">2005-10-27</td>
<td style="text-align: left;">2011-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 1.0</td>
<td style="text-align: left;">2002-02-13</td>
<td style="text-align: left;">2007-07-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
</tbody>
</table>
</div>
<h3 id="122-net-lifecycle">12.2. .NET lifecycle</h3>
This application does not use modern .NET (Core), but this table is included for future modernization planning.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">.NET 8 (LTS)</td>
<td style="text-align: left;">2023-11-14</td>
<td style="text-align: left;">2026-11-10</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET 7 (STS)</td>
<td style="text-align: left;">2022-11-08</td>
<td style="text-align: left;">2024-05-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET 6 (LTS)</td>
<td style="text-align: left;">2021-11-08</td>
<td style="text-align: left;">2024-11-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET 5 (STS)</td>
<td style="text-align: left;">2020-11-10</td>
<td style="text-align: left;">2022-05-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Core 3.1 (LTS)</td>
<td style="text-align: left;">2019-12-03</td>
<td style="text-align: left;">2022-12-13</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
</tbody>
</table>
</div>
<h3 id="123-windows-server-operating-systems-lifecycle">12.3. Windows Server Operating Systems lifecycle</h3>
The application's runtime dependency on .NET Framework 4.0 suggests it is likely deployed on an older, unsupported version of Windows Server.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date (mainstream)</th>
<th style="text-align: left;">End date (extended)</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Windows Server 2022</td>
<td style="text-align: left;">2021-08-18</td>
<td style="text-align: left;">2026-10-13</td>
<td style="text-align: left;">2031-10-14</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2019</td>
<td style="text-align: left;">2018-11-13</td>
<td style="text-align: left;">2024-01-09</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2016</td>
<td style="text-align: left;">2016-10-15</td>
<td style="text-align: left;">2022-01-11</td>
<td style="text-align: left;">2027-01-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2012 R2</td>
<td style="text-align: left;">2013-11-25</td>
<td style="text-align: left;">2018-10-09</td>
<td style="text-align: left;">2023-10-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2008 R2</strong></td>
<td style="text-align: left;"><strong>2009-10-22</strong></td>
<td style="text-align: left;"><strong>2015-01-13</strong></td>
<td style="text-align: left;"><strong>2020-01-14</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>No</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Yes (Assumed)</strong></td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2008</td>
<td style="text-align: left;">2008-05-06</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2003</td>
<td style="text-align: left;">2003-04-24</td>
<td style="text-align: left;">2010-07-13</td>
<td style="text-align: left;">2015-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
</tbody>
</table>
</div>
<h3 id="124-microsoft-sql-server-lifecycle">12.4. Microsoft SQL Server lifecycle</h3>
The database server names in the configuration files (e.g., <code>S2K081</code>) strongly suggest the use of SQL Server 2008 R2, which is no longer supported.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date (mainstream)</th>
<th style="text-align: left;">End date (extended)</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SQL Server 2022</td>
<td style="text-align: left;">2022-11-16</td>
<td style="text-align: left;">2028-01-11</td>
<td style="text-align: left;">2033-01-11</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2019</td>
<td style="text-align: left;">2019-11-04</td>
<td style="text-align: left;">2025-02-28</td>
<td style="text-align: left;">2030-01-08</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2017</td>
<td style="text-align: left;">2017-10-02</td>
<td style="text-align: left;">2022-10-11</td>
<td style="text-align: left;">2027-10-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2016</td>
<td style="text-align: left;">2016-06-01</td>
<td style="text-align: left;">2021-07-13</td>
<td style="text-align: left;">2026-07-14</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2014</td>
<td style="text-align: left;">2014-06-05</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;">2024-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2012</td>
<td style="text-align: left;">2012-05-20</td>
<td style="text-align: left;">2017-07-11</td>
<td style="text-align: left;">2022-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2008 R2</strong></td>
<td style="text-align: left;"><strong>2010-07-20</strong></td>
<td style="text-align: left;"><strong>2014-07-08</strong></td>
<td style="text-align: left;"><strong>2019-07-09</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>No</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Yes (Inferred)</strong></td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2008</td>
<td style="text-align: left;">2008-11-06</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="13-modernization-strategy">13. Modernization strategy</h2>
This section outlines three potential modernization strategies for the SDCIM application, given its current state on an unsupported technology stack.
<h3 id="131-modernization-strategy-comparison">13.1. Modernization strategy comparison</h3>
The following table compares three distinct modernization strategies: a minimal on-premises update, a cloud re-hosting, and a complete refactor.
<div class="table-container">
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Strategy</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Complexity</th>
<th style="text-align: left;">Development time estimate</th>
<th style="text-align: left;">Functional testing time estimate</th>
<th style="text-align: left;">Infrastructure time estimate</th>
<th style="text-align: left;">Deployment time estimate</th>
<th style="text-align: left;">Total time estimate</th>
<th style="text-align: left;">Cost estimate</th>
<th style="text-align: left;">Risk</th>
<th style="text-align: left;">Long-term fit</th>
<th style="text-align: left;">Time-to-market</th>
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Lift and Shift (on-prem)</strong></td>
<td style="text-align: left;">Upgrade .NET Framework to 4.8.1 and SQL Server to a supported version. Keep on-premises deployment.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium complexity</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">2-3 weeks</td>
<td style="text-align: left;">1-2 weeks</td>
<td style="text-align: left;">1 week</td>
<td style="text-align: left;">7-11 weeks</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low cost</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low risk</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Low long-term fit</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> High</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Low cost and risk.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Minimal code changes.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Quickest path to a supported state.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Does not address architectural debt.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Limited scalability and maintainability gains.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Remains a legacy monolith.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Lift and Shift (with rehosting)</strong></td>
<td style="text-align: left;">Move application and database to cloud infrastructure (IaaS) like Azure VMs and Azure SQL Managed Instance. Upgrade .NET and SQL versions.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium complexity</td>
<td style="text-align: left;">4-6 weeks</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">4-6 weeks</td>
<td style="text-align: left;">2-3 weeks</td>
<td style="text-align: left;">13-20 weeks</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium cost</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium long-term fit</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Moves to a modern, managed infrastructure.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Improves reliability and scalability options.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Path to further modernization.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Higher cost than on-prem update.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Does not fix core architectural issues.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Requires new cloud management skills.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Complete Refactor (cloud-native)</strong></td>
<td style="text-align: left;">Re-architect the application to be cloud-native. Rewrite UI as a web app, services as Azure Functions, and adopt modern patterns like CQRS and EF Core.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High complexity</td>
<td style="text-align: left;">12+ weeks</td>
<td style="text-align: left;">8-10 weeks</td>
<td style="text-align: left;">6-8 weeks</td>
<td style="text-align: left;">4-6 weeks</td>
<td style="text-align: left;">30+ weeks</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High cost</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High risk</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> High long-term fit</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Low</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Highest long-term value.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Maximum scalability, maintainability, and extensibility.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Enables modern DevOps and CI/CD practices.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Highest cost, time, and risk.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Requires a full rewrite of major components.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Significant testing effort.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="132-recommendation">13.2. Recommendation</h3>
<strong>Recommended Strategy: Phased Modernization, starting with Lift and Shift (with rehosting).</strong>
<p>Given the critical nature of the application (core banking process) and the significant risks posed by its end-of-life technology stack, a complete, one-shot refactor is too risky. The most prudent approach is a phased modernization:</p>
<p>1.  <strong>Phase 1: Rehost & Upgrade (Lift and Shift to the Cloud).</strong> The immediate priority is to move the application off unsupported infrastructure. This involves migrating the application to Azure VMs and the SQL Server database to Azure SQL Managed Instance. During this phase, the .NET Framework should be upgraded to 4.8.1. This immediately mitigates the most severe security and supportability risks with moderate effort.
2.  <strong>Phase 2: Strangle and Refactor.</strong> Once the application is stable in the cloud, begin a gradual refactoring process. Decompose the monolith by identifying bounded contexts (e.g., Alerting, Reporting) and rewriting them as separate cloud-native services (e.g., Azure Functions, Logic Apps). Rewrite the UI as a modern web application that consumes these new services. This "strangler fig" pattern allows for incremental modernization without a "big bang" rewrite, reducing risk and allowing for continuous delivery of value.</p>
<p>This phased approach provides the best balance of immediate risk mitigation and long-term strategic value.</p>
<h4 id="1321-step-by-step-plan">13.2.1. Step-by-step plan</h4>
The following is a detailed step-by-step plan for the recommended <strong>Phase 1: Rehost & Upgrade</strong> strategy.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Task</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Technologies / Tools</th>
<th style="text-align: left;">Estimated Time</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Assessment & Planning</strong></td>
<td style="text-align: left;"><strong>1 week</strong></td>
</tr>
<tr>
<td style="text-align: left;">1.1</td>
<td style="text-align: left;">Analyze application dependencies</td>
<td style="text-align: left;">Identify all dependencies, including shared libraries, file shares, and external web services.</td>
<td style="text-align: left;">Visual Studio, Manual analysis</td>
<td style="text-align: left;">2 days</td>
</tr>
<tr>
<td style="text-align: left;">1.2</td>
<td style="text-align: left;">Plan Azure infrastructure</td>
<td style="text-align: left;">Design the target Azure environment: VNet, subnets, NSGs, VMs for the app/service, and an Azure SQL Managed Instance for the database.</td>
<td style="text-align: left;">Azure Portal, Azure Pricing Calculator</td>
<td style="text-align: left;">2 days</td>
</tr>
<tr>
<td style="text-align: left;">1.3</td>
<td style="text-align: left;">Create migration plan</td>
<td style="text-align: left;">Document the step-by-step migration process, including rollback plans and testing strategy.</td>
<td style="text-align: left;">Azure Migrate, Microsoft Docs</td>
<td style="text-align: left;">1 day</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Code & Dependency Upgrade</strong></td>
<td style="text-align: left;"><strong>3 weeks</strong></td>
</tr>
<tr>
<td style="text-align: left;">2.1</td>
<td style="text-align: left;">Upgrade .NET Framework</td>
<td style="text-align: left;">Retarget all projects in the solution from .NET Framework 4.0 to 4.8.1.</td>
<td style="text-align: left;">Visual Studio</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">2.2</td>
<td style="text-align: left;">Resolve breaking changes</td>
<td style="text-align: left;">Fix any compilation errors or runtime issues resulting from the framework upgrade.</td>
<td style="text-align: left;">.NET Portability Analyzer</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">2.3</td>
<td style="text-align: left;">Update third-party libraries</td>
<td style="text-align: left;">Replace legacy libraries (e.g., Crystal Reports) with supported versions or alternatives if necessary.</td>
<td style="text-align: left;">NuGet Package Manager</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Infrastructure Deployment</strong></td>
<td style="text-align: left;"><strong>2 weeks</strong></td>
</tr>
<tr>
<td style="text-align: left;">3.1</td>
<td style="text-align: left;">Provision Azure resources</td>
<td style="text-align: left;">Create the VNet, VMs, and Azure SQL Managed Instance using an IaC approach.</td>
<td style="text-align: left;">Azure Bicep / Terraform</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">3.2</td>
<td style="text-align: left;">Configure networking & security</td>
<td style="text-align: left;">Set up firewalls, NSGs, and private endpoints to secure the environment.</td>
<td style="text-align: left;">Azure Portal</td>
<td style="text-align: left;">3 days</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Data Migration</strong></td>
<td style="text-align: left;"><strong>2 weeks</strong></td>
</tr>
<tr>
<td style="text-align: left;">4.1</td>
<td style="text-align: left;">Migrate database schema & data</td>
<td style="text-align: left;">Use Azure Data Migration Service (DMS) to migrate the on-premises SQL Server database to Azure SQL Managed Instance.</td>
<td style="text-align: left;">Azure DMS</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">4.2</td>
<td style="text-align: left;">Validate data integrity</td>
<td style="text-align: left;">Perform data validation checks to ensure a successful migration.</td>
<td style="text-align: left;">SQL Queries, Custom Scripts</td>
<td style="text-align: left;">3 days</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Deployment & Testing</strong></td>
<td style="text-align: left;"><strong>3 weeks</strong></td>
</tr>
<tr>
<td style="text-align: left;">5.1</td>
<td style="text-align: left;">Deploy application to Azure VMs</td>
<td style="text-align: left;">Install the upgraded application and Windows Service on the newly provisioned Azure VMs.</td>
<td style="text-align: left;">Manual Install / PowerShell DSC</td>
<td style="text-align: left;">2 days</td>
</tr>
<tr>
<td style="text-align: left;">5.2</td>
<td style="text-align: left;">Update configuration</td>
<td style="text-align: left;">Update all connection strings and endpoints in the <code>.config</code> files to point to the new Azure resources.</td>
<td style="text-align: left;">Manual Edit</td>
<td style="text-align: left;">1 day</td>
</tr>
<tr>
<td style="text-align: left;">5.3</td>
<td style="text-align: left;">Perform functional testing</td>
<td style="text-align: left;">Execute a full regression test suite to ensure the application functions correctly in the new environment.</td>
<td style="text-align: left;">Manual Testing</td>
<td style="text-align: left;">2 weeks</td>
</tr>
<tr>
<td style="text-align: left;">5.4</td>
<td style="text-align: left;">Perform performance testing</td>
<td style="text-align: left;">Conduct load testing to ensure performance meets requirements.</td>
<td style="text-align: left;">Azure Load Testing</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6. Go-Live</strong></td>
<td style="text-align: left;"><strong>1 week</strong></td>
</tr>
<tr>
<td style="text-align: left;">6.1</td>
<td style="text-align: left;">Final data sync</td>
<td style="text-align: left;">Perform a final data synchronization before the cutover.</td>
<td style="text-align: left;">Azure DMS</td>
<td style="text-align: left;">1 day</td>
</tr>
<tr>
<td style="text-align: left;">6.2</td>
<td style="text-align: left;">Cutover</td>
<td style="text-align: left;">Point users and systems to the new Azure environment and decommission the old on-premises servers.</td>
<td style="text-align: left;">DNS Changes</td>
<td style="text-align: left;">1 day</td>
</tr>
<tr>
<td style="text-align: left;">6.3</td>
<td style="text-align: left;">Post-go-live support</td>
<td style="text-align: left;">Monitor the application closely for any issues.</td>
<td style="text-align: left;">Azure Monitor</td>
<td style="text-align: left;">1 week</td>
</tr>
</tbody>
</table>
</div>
<h4 id="1322-gantt-chart">13.2.2. Gantt chart</h4>
A Gantt chart to visualize the step-by-step plan, showing the timeline and dependencies of each step.
<pre class="mermaid"><code>gantt
    title Modernization Plan: Phase 1 - Rehost & Upgrade
    dateFormat  YYYY-MM-DD
    axisFormat %Y-%m
    
    section Assessment & Planning
    Analyze Dependencies           :a1, 2025-08-11, 2d
    Plan Azure Infrastructure      :a2, after a1, 2d
    Create Migration Plan          :a3, after a2, 1d
    
    section Code & Dependency Upgrade
    Upgrade .NET Framework         :b1, after a3, 1w
    Resolve Breaking Changes       :b2, after b1, 1w
    Update Libraries               :b3, after b2, 1w
    
    section Infrastructure Deployment
    Provision Azure Resources      :c1, after b1, 1w
    Configure Networking           :c2, after c1, 3d
    
    section Data Migration
    Migrate Database               :d1, after c2, 1w
    Validate Data                  :d2, after d1, 3d
    
    section Deployment & Testing
    Deploy Application             :e1, after d2, 2d
    Update Configuration           :e2, after e1, 1d
    Functional Testing             :e3, after e2, 2w
    Performance Testing            :e4, after e3, 1w
    
    section Go-Live
    Final Data Sync                :f1, after e4, 1d
    Cutover & Decommission         :f2, after f1, 1d
    Post-Go-Live Support           :f3, after f2, 1w
</code></pre>
<center><font size="2">Figure 15 - Gantt chart for the Phase 1 modernization plan.</font></center>
</div>
<div class="product-section">
<h2 id="14-application-porfolio-management">14. Application porfolio management</h2>
This section provides an analysis of the application from an IT portfolio management perspective, mapping its components to standard types and evaluating its strategic fit.
<h3 id="141-it-component-types-and-attributes">14.1. IT Component types and attributes</h3>
The following table maps the application's components to the SAP LeanIX IT Component model.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">IT Component Type</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Version(s)</th>
<th style="text-align: left;">Provider(s)</th>
<th style="text-align: left;">Support start date</th>
<th style="text-align: left;">Support end date</th>
<th style="text-align: left;">Support end date (extended)</th>
<th style="text-align: left;">Support status</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Programming Language</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">Programming Language</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Programming Language</strong></td>
<td style="text-align: left;">VB.NET</td>
<td style="text-align: left;">Programming Language</td>
<td style="text-align: left;">10.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Web Framework</strong></td>
<td style="text-align: left;">.NET Framework</td>
<td style="text-align: left;">Web Framework</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;">Microsoft SQL Server</td>
<td style="text-align: left;">Database</td>
<td style="text-align: left;">2008 R2</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-07-20</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Operating System</strong></td>
<td style="text-align: left;">Windows Server</td>
<td style="text-align: left;">Operating System</td>
<td style="text-align: left;">2008 R2</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2009-10-22</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Development Tool</strong></td>
<td style="text-align: left;">Visual Studio</td>
<td style="text-align: left;">Development Tool</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-22</td>
<td style="text-align: left;">2015-07-14</td>
<td style="text-align: left;">2020-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Integration Platform</strong></td>
<td style="text-align: left;">SOAP Web Service</td>
<td style="text-align: left;">Integration Platform</td>
<td style="text-align: left;">1.1</td>
<td style="text-align: left;">W3C</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
</tr>
</tbody>
</table>
</div>
<h3 id="142-portfolio-strategy">14.2. Portfolio strategy</h3>
This section evaluates the application's strategic fit using the TIME and 6R models.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Classification</th>
<th style="text-align: left;">Evaluation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>TIME Classification</strong></td>
<td style="text-align: left;"><strong>Tolerate/Migrate.</strong> The application provides high business value as it handles a core banking process (remittance processing). However, its technical quality is very low due to its reliance on an entirely unsupported technology stack (.NET 4.0, SQL Server 2008 R2). The system cannot be eliminated, but it must be migrated to a modern, supported platform to mitigate significant security and operational risks. The current state is tolerated only as a short-term necessity pending migration.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6R Classification</strong></td>
<td style="text-align: left;"><strong>Rehost, then Refactor.</strong><br>- <strong>Retain:</strong> Not a viable long-term option due to the end-of-life technology stack.<br>- <strong>Retire/Replace:</strong> A full replacement would be high-risk and time-consuming for a core system. <br>- <strong>Rehost (Lift and Shift):</strong> This is the recommended first step. Moving the application to a supported IaaS platform (e.g., Azure VMs) and upgrading the .NET Framework and SQL Server versions immediately addresses the most critical supportability risks.<br>- <strong>Refactor:</strong> After re-hosting, a gradual refactoring of the monolith into cloud-native services is the ideal long-term strategy to improve maintainability, scalability, and enable modern DevOps practices.</td>
</tr>
</tbody>
</table>
</div>
---
</div>

</main>
      <p class="ai-disclaimer">This application analysis was performed using Artificial Intelligence (AI). While AI enhances the process, it may still produce inaccuracies, and all results should be carefully reviewed.</p>
      <footer class="footer">
         <div class="footer-container">
            <div class="footer-brand">
               <img src="https://www.cgd.pt/PublishingImages/WSImages/Novo-CGD/logo-ap_Blue.png" alt="CGD Logo" class="footer-logo">
               <span class="footer-wordmark">Caixa. Para todos e para cada um.</span>
            </div>
            <div class="footer-copyright">
               © 2025 Caixa Geral de Depósitos, SA. All rights reserved.
            </div>
            <div class="footer-socials">
               <a href="https://www.cgd.pt/" target="_blank" title="Website">
                  <svg viewBox="0 0 24 24">
                     <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1h-2v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                  </svg>
               </a>
               <a href="https://www.facebook.com/caixageraldedepositos" target="_blank" title="Facebook">
                  <svg viewBox="0 0 24 24">
                     <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-1.5c-1.1 0-1.5.9-1.5 1.5V12h3l-.5 3h-2.5v6.8A10.02 10.02 0 0022 12z"/>
                  </svg>
               </a>
               <a href="https://www.youtube.com/user/mediacgd" target="_blank" title="YouTube">
                  <svg viewBox="0 0 24 24">
                     <path d="M21.58 7.19c-.23-.86-.9-1.52-1.76-1.75C18.25 5 12 5 12 5s-6.25 0-7.82.44c-.86.23-1.52.89-1.76 1.75C2 8.75 2 12 2 12s0 3.25.42 4.81c.23.86.9 1.52 1.76 1.75C5.75 19 12 19 12 19s6.25 0 7.82-.44c.86-.23 1.52-.89 1.76-1.75C22 15.25 22 12 22 12s0-3.25-.42-4.81zM10 15V9l5.2 3-5.2 3z"/>
                  </svg>
               </a>
               <a href="https://www.linkedin.com/company/caixageraldedepositos" target="_blank" title="LinkedIn">
                  <svg viewBox="0 0 24 24">
                     <path d="M19 3a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h14zm-7 5H8v8h4v-8zm-2-2h4v-2H8v2zm8 4h-4v4h4v-4zm0-2h-4v-2h4v2z" clip-rule="evenodd" fill-rule="evenodd"/>
                  </svg>
               </a>
               <a href="https://www.instagram.com/caixageraldedepositos" target="_blank" title="Instagram">
                  <svg viewBox="0 0 24 24">
                     <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2zm-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8c1.99 0 3.6-1.61 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6zm9.65 1.5a1.25 1.25 0 100 2.5 1.25 1.25 0 000-2.5zM12 7a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6z"/>
                  </svg>
               </a>
            </div>
         </div>
      </footer>
      <button id="back-to-top" title="Back to Top">
      <span class="icon">arrow_upward</span>
      </button>
      
      <!-- Floating Table of Contents -->
      <div id="floating-toc-toggle" class="floating-toc-toggle" title="Table of Contents">
         <span class="icon">toc</span>
      </div>
      
      <div id="floating-toc" class="floating-toc">
         <div class="floating-toc-header">
            <div class="floating-toc-title">
               <span class="icon">toc</span>
               Table of Contents
            </div>
            <button id="floating-toc-close" class="floating-toc-close" title="Close TOC">
               <span class="icon">close</span>
            </button>
         </div>
         <ul id="floating-toc-list" class="floating-toc-list">
            <!-- TOC items will be dynamically generated -->
         </ul>
      </div>

      <!-- Fullscreen Reading Mode -->
      <div id="fullscreen-reading-mode" class="fullscreen-reading-mode">
         <div class="fullscreen-font-controls">
            <button id="font-decrease" class="fullscreen-font-control" title="Decrease font size">
               <span class="icon">text_decrease</span>
            </button>
            <button id="font-increase" class="fullscreen-font-control" title="Increase font size">
               <span class="icon">text_increase</span>
            </button>
         </div>
         
         <div class="fullscreen-reading-controls">
            <button id="fullscreen-tts-btn" class="fullscreen-reading-control" title="Listen to content">
               <span class="icon">play_arrow</span>
            </button>
            <button id="fullscreen-dark-mode-btn" class="fullscreen-reading-control" title="Toggle dark mode">
               <span class="icon">light_mode</span>
            </button>
            <button id="fullscreen-exit-btn" class="fullscreen-reading-control fullscreen-reading-exit" title="Exit fullscreen reading">
               <span class="icon">fullscreen_exit</span>
            </button>
         </div>
         
         <div id="fullscreen-reading-content" class="fullscreen-reading-content">
            <!-- Content will be dynamically populated -->
         </div>
         
         <div id="fullscreen-reading-progress" class="fullscreen-reading-progress">
            Reading progress: 0%
         </div>
      </div>

      <script>
         document.addEventListener('DOMContentLoaded', function() {
             
             // --- INITIALIZATION ---
             function init() {
                 console.log('Starting initialization...');
                 replaceEmojisWithIcons();
                 removeHeadingNumbers();
                 setupTabs(); // This now also calculates and displays read times
                 console.log('About to initialize dark mode...');
                 initDarkMode();
                 console.log('Dark mode initialization complete');
                 initTTS();
                 initBackToTop();
                 initFloatingTOC();
                 initReadingProgress();
                 initFullscreenReading();
                 initBreadcrumbNavigation();
                 
                 // Initialize and render Mermaid diagrams
                 function checkMermaidAvailability() {
                     if (typeof mermaid === 'undefined') {
                         console.error('Mermaid library not loaded. Diagrams will not be rendered.');
                         return false;
                     }
                     console.log('Mermaid version:', mermaid.version || 'Unknown');
                     return true;
                 }
                 
                 if (checkMermaidAvailability()) {
                     try {
                         initializeMermaidRendering();
                         setTimeout(renderMermaidDiagrams, 500);
                     } catch (error) {
                         console.error('Error initializing Mermaid diagrams:', error);
                     }
                 }
             }
             
             // --- FEATURE: DARK MODE ---
             function initDarkMode() {
                 console.log('Initializing dark mode...');
                 const toggleBtn = document.getElementById('dark-mode-toggle');
                 console.log('Toggle button found:', toggleBtn);
                 
                 // Check if the toggle button exists
                 if (!toggleBtn) {
                     console.warn('Dark mode toggle button not found');
                     return;
                 }
                 
                 // Check if the icon element exists inside the button
                 const iconElement = toggleBtn.querySelector('.icon');
                 console.log('Icon element found:', iconElement);
                 if (!iconElement) {
                     console.warn('Dark mode toggle icon not found');
                     return;
                 }
                 
                 const sunIcon = 'light_mode';
                 const moonIcon = 'dark_mode';
         
                 // Check for saved preference and update UI accordingly
                 if (localStorage.getItem('theme') === 'dark') {
                     console.log('Setting dark mode from localStorage');
                     document.documentElement.classList.add('dark-mode');
                     iconElement.textContent = sunIcon;
                     toggleBtn.title = 'Switch to light mode';
                 } else {
                     console.log('Setting light mode');
                     iconElement.textContent = moonIcon;
                     toggleBtn.title = 'Switch to dark mode';
                 }
         
                 console.log('Adding click event listener to dark mode toggle');
                 toggleBtn.addEventListener('click', () => {
                     console.log('Dark mode toggle clicked!');
                     
                     const isDarkMode = document.documentElement.classList.toggle('dark-mode');
                     console.log('Dark mode toggled:', isDarkMode);
                     console.log('Current document classes:', document.documentElement.className);
                     
                     // Update icon and tooltip based on current mode
                     if (isDarkMode) {
                         console.log('Setting sun icon for dark mode');
                         iconElement.textContent = sunIcon;
                         toggleBtn.title = 'Switch to light mode';
                     } else {
                         console.log('Setting moon icon for light mode');
                         iconElement.textContent = moonIcon;
                         toggleBtn.title = 'Switch to dark mode';
                     }
                     
                     localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                     console.log('Theme saved to localStorage:', isDarkMode ? 'dark' : 'light');
                     
                     // Update Mermaid theme if the function exists
                     if (typeof updateMermaidTheme === 'function') {
                         updateMermaidTheme();
                     }
                 });
                 
                 console.log('Dark mode initialization completed successfully');
             }
         
             // --- FEATURE: TEXT-TO-SPEECH (TTS) ---
             function initTTS() {
                 const ttsControls = document.getElementById('tts-controls');
                 const playPauseBtn = document.getElementById('tts-play-pause-btn');
                 const stopBtn = document.getElementById('tts-stop-btn');
                 
                 // Check if TTS elements exist
                 if (!ttsControls || !playPauseBtn || !stopBtn) {
                     console.warn('TTS controls not found');
                     return;
                 }
                 
                 const synth = window.speechSynthesis;
         
                 // Always show TTS controls
                 ttsControls.style.display = 'flex';
                 
                 if (!synth) {
                     console.warn("Browser does not support Speech Synthesis.");
                     // Show controls but disable them
                     playPauseBtn.disabled = true;
                     stopBtn.disabled = true;
                     playPauseBtn.title = "Speech synthesis not supported in this browser";
                     stopBtn.title = "Speech synthesis not supported in this browser";
                     return;
                 }
         
                 let utterance = null;
                 
                 console.log("TTS initialized successfully");
         
                 function play() {
                     console.log("TTS play function called");
                     const activePane = document.querySelector('.tab-pane.active');
                     if (!activePane) {
                         console.warn("No active tab pane found");
                         return;
                     }
                     
                     if (synth.speaking) {
                         console.log("Speech synthesis already speaking");
                         return;
                     }
         
                     // Clone to avoid modifying the live DOM, then clean text
                     const contentClone = activePane.cloneNode(true);
                     contentClone.querySelectorAll('h2, h3, h4').forEach(h => h.textContent = h.textContent + '. '); // Add pauses after headings
                     const textToSpeak = contentClone.innerText;
                     
                     console.log("Text to speak length:", textToSpeak.length);
         
                     utterance = new SpeechSynthesisUtterance(textToSpeak);
                     utterance.lang = document.documentElement.lang || 'en-US';
                     utterance.rate = 0.9; // Slightly slower for better comprehension
                     utterance.pitch = 1.0;
                     utterance.volume = 0.8;
         
                     utterance.onstart = () => {
                         console.log("Speech started");
                         playPauseBtn.querySelector('.icon').textContent = 'pause';
                         playPauseBtn.title = 'Pause listening';
                     };
                     utterance.onpause = () => {
                         console.log("Speech paused");
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Resume listening';
                     };
                     utterance.onresume = () => {
                         console.log("Speech resumed");
                         playPauseBtn.querySelector('.icon').textContent = 'pause';
                         playPauseBtn.title = 'Pause listening';
                     };
                     utterance.onend = () => {
                         console.log("Speech ended");
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Listen to this section';
                         utterance = null;
                     };
                     utterance.onerror = (event) => {
                         console.error("Speech synthesis error:", event);
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Listen to this section';
                         utterance = null;
                     };
                     
                     synth.speak(utterance);
                 }
         
                 function togglePlayPause() {
                     console.log("TTS toggle play/pause clicked");
                     console.log("Current state - speaking:", synth.speaking, "paused:", synth.paused);
                     
                     if (synth.speaking && !synth.paused) {
                         console.log("Pausing speech");
                         synth.pause();
                     } else if (synth.paused) {
                         console.log("Resuming speech");
                         synth.resume();
                     } else {
                         console.log("Starting new speech");
                         play();
                     }
                 }
         
                 function stop() {
                     console.log("TTS stop clicked");
                     synth.cancel(); // Also triggers 'onend'
                 }
         
                 playPauseBtn.addEventListener('click', togglePlayPause);
                 stopBtn.addEventListener('click', stop);
                 
                 // Stop speech when user changes tabs
                 document.querySelector('.tab-navigation')?.addEventListener('click', stop);
             }
             
             // --- FEATURE: BACK TO TOP BUTTON ---
             function initBackToTop() {
                 const backToTopButton = document.getElementById('back-to-top');
                 
                 if (!backToTopButton) {
                     console.warn('Back to top button not found');
                     return;
                 }
                 
                 window.addEventListener('scroll', () => {
                     if (window.scrollY > 300) {
                         backToTopButton.classList.add('show');
                     } else {
                         backToTopButton.classList.remove('show');
                     }
                 });
                 backToTopButton.addEventListener('click', () => {
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                 });
             }

             // --- FEATURE: FLOATING TABLE OF CONTENTS ---
             function initFloatingTOC() {
                 const tocToggle = document.getElementById('floating-toc-toggle');
                 const tocContainer = document.getElementById('floating-toc');
                 const tocClose = document.getElementById('floating-toc-close');
                 const tocList = document.getElementById('floating-toc-list');
                 
                 let isInitialized = false;
                 let tocItems = [];
                 let sectionElements = [];
                 
                 function buildTOC() {
                     if (isInitialized) return;
                     
                     // Get all h2 elements from tab panes
                     const tabPanes = document.querySelectorAll('.tab-pane');
                     tocList.innerHTML = '';
                     tocItems = [];
                     sectionElements = [];
                     
                     tabPanes.forEach((pane, index) => {
                         const h2Element = pane.querySelector('h2');
                         if (!h2Element) return;
                         
                         const tocItem = document.createElement('li');
                         tocItem.className = 'floating-toc-item';
                         
                         const tocLink = document.createElement('a');
                         tocLink.className = 'floating-toc-link';
                         tocLink.href = '#';
                         tocLink.textContent = h2Element.textContent.trim();
                         tocLink.dataset.target = h2Element.id || `section-${index}`;
                         
                         const progressIndicator = document.createElement('div');
                         progressIndicator.className = 'floating-toc-progress';
                         const progressFill = document.createElement('div');
                         progressFill.className = 'floating-toc-progress-fill';
                         progressIndicator.appendChild(progressFill);
                         tocLink.appendChild(progressIndicator);
                         
                         tocItem.appendChild(tocLink);
                         tocList.appendChild(tocItem);
                         
                         tocItems.push({
                             link: tocLink,
                             pane: pane,
                             h2: h2Element
                         });
                         
                         sectionElements.push({
                             element: pane,
                             link: tocLink,
                             id: h2Element.id || `section-${index}`
                         });
                         
                         // Add click handler for smooth scrolling to tab
                         tocLink.addEventListener('click', (e) => {
                             e.preventDefault();
                             
                             // Find and activate the corresponding tab
                             const tabButton = document.querySelector(`[data-tab="${pane.id}"]`);
                             if (tabButton) {
                                 tabButton.click();
                                 
                                 // Small delay to ensure tab is active, then scroll to h2
                                 setTimeout(() => {
                                     h2Element.scrollIntoView({
                                         behavior: 'smooth',
                                         block: 'start'
                                     });
                                 }, 100);
                             }
                         });
                     });
                     
                     isInitialized = true;
                 }
                 
                 function updateProgress() {
                     if (!isInitialized || tocItems.length === 0) return;
                     
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Find the corresponding TOC item
                     const activeTocItem = tocItems.find(item => item.pane === activeTabPane);
                     
                     // Clear all active states
                     tocItems.forEach(item => {
                         item.link.classList.remove('active', 'reading');
                     });
                     
                     if (activeTocItem) {
                         activeTocItem.link.classList.add('active');
                         
                         // Calculate reading progress for the active section
                         const paneRect = activeTabPane.getBoundingClientRect();
                         const viewportHeight = window.innerHeight;
                         
                         // Consider a section as "reading" if it's visible in viewport
                         if (paneRect.top < viewportHeight && paneRect.bottom > 0) {
                             activeTocItem.link.classList.add('reading');
                         }
                     }
                 }
                 
                 function showTOC() {
                     buildTOC();
                     tocContainer.classList.add('show');
                     tocToggle.classList.remove('show');
                     updateProgress();
                 }
                 
                 function hideTOC() {
                     tocContainer.classList.remove('show');
                     tocToggle.classList.add('show');
                 }
                 
                 // Event listeners
                 tocToggle.addEventListener('click', showTOC);
                 tocClose.addEventListener('click', hideTOC);
                 
                 // Close TOC when clicking outside
                 document.addEventListener('click', (e) => {
                     if (!tocContainer.contains(e.target) && !tocToggle.contains(e.target)) {
                         if (tocContainer.classList.contains('show')) {
                             hideTOC();
                         }
                     }
                 });
                 
                 // Show/hide toggle button on scroll
                 window.addEventListener('scroll', () => {
                     if (window.scrollY > 500) {
                         if (!tocContainer.classList.contains('show')) {
                             tocToggle.classList.add('show');
                         }
                     } else {
                         tocToggle.classList.remove('show');
                         tocContainer.classList.remove('show');
                     }
                     
                     updateProgress();
                 });
                 
                 // Update progress when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(updateProgress, 100);
                     });
                 }
                 
                 // Handle ESC key to close TOC
                 document.addEventListener('keydown', (e) => {
                     if (e.key === 'Escape' && tocContainer.classList.contains('show')) {
                         hideTOC();
                     }                 });
             }

             // --- FEATURE: READING PROGRESS INDICATOR ---
             function initReadingProgress() {
                 const progressBar = document.getElementById('reading-progress');
                 const progressFill = document.getElementById('reading-progress-fill');
                 const progressText = document.getElementById('reading-progress-text');
                 
                 let isVisible = false;
                 
                 function updateProgress() {
                     // Get the active tab content to calculate progress within that tab
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     const rect = activeTabPane.getBoundingClientRect();
                     const tabTop = activeTabPane.offsetTop;
                     const tabHeight = activeTabPane.offsetHeight;
                     const headerHeight = document.querySelector('.header').offsetHeight + 
                                         document.querySelector('.tab-navigation-container').offsetHeight;
                     
                     // Calculate scroll position relative to the active tab
                     const scrollTop = window.pageYOffset;
                     const tabStart = tabTop - headerHeight;
                     const tabEnd = tabTop + tabHeight - window.innerHeight;
                     
                     // Calculate progress percentage for the current tab
                     let progress = 0;
                     if (scrollTop <= tabStart) {
                         progress = 0;
                     } else if (scrollTop >= tabEnd) {
                         progress = 100;
                     } else {
                         const scrollableHeight = tabEnd - tabStart;
                         const scrolledHeight = scrollTop - tabStart;
                         progress = Math.min(100, Math.max(0, (scrolledHeight / scrollableHeight) * 100));
                     }
                     
                     // Show progress bar after scrolling starts
                     const shouldShow = scrollTop > 100;
                     
                     if (shouldShow && !isVisible) {
                         progressBar.classList.add('show');
                         progressText.classList.add('show');
                         isVisible = true;
                     } else if (!shouldShow && isVisible) {
                         progressBar.classList.remove('show');
                         progressText.classList.remove('show');
                         isVisible = false;
                     }
                     
                     // Update progress bar and text
                     if (isVisible) {
                         progressFill.style.width = `${progress}%`;
                         progressText.textContent = `${Math.round(progress)}% read`;
                         
                         // Add current section info
                         const activeH2 = activeTabPane.querySelector('h2');
                         if (activeH2) {
                             const sectionTitle = activeH2.textContent.trim();
                             const shortTitle = sectionTitle.length > 25 ? 
                                               sectionTitle.substring(0, 25) + '...' : 
                                               sectionTitle;
                             progressText.textContent = `${Math.round(progress)}% • ${shortTitle}`;
                         }
                     }
                 }
                 
                 // Throttled scroll handler for better performance
                 let ticking = false;
                 function handleScroll() {
                     if (!ticking) {
                         requestAnimationFrame(() => {
                             updateProgress();
                             ticking = false;
                         });
                         ticking = true;
                     }
                 }
                 
                 // Event listeners
                 window.addEventListener('scroll', handleScroll);
                 window.addEventListener('resize', updateProgress);
                 
                 // Update progress when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(updateProgress, 150);
                     });
                 }
                 
                 // Initial update
                 updateProgress();
             }

             // --- FEATURE: FULLSCREEN READING MODE ---
             function initFullscreenReading() {
                 const fullscreenBtn = document.getElementById('fullscreen-reading-btn');
                 const fullscreenMode = document.getElementById('fullscreen-reading-mode');
                 const fullscreenContent = document.getElementById('fullscreen-reading-content');
                 const fullscreenProgress = document.getElementById('fullscreen-reading-progress');
                 const exitBtn = document.getElementById('fullscreen-exit-btn');
                 const fontIncreaseBtn = document.getElementById('font-increase');
                 const fontDecreaseBtn = document.getElementById('font-decrease');
                 const fullscreenTtsBtn = document.getElementById('fullscreen-tts-btn');
                 const fullscreenDarkModeBtn = document.getElementById('fullscreen-dark-mode-btn');
                 
                 let currentFontSize = 1.1; // Default font size in rem
                 let isFullscreenActive = false;
                 
                 function enterFullscreenReading() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Clone the active content
                     const contentClone = activeTabPane.cloneNode(true);
                     
                     // Clean up the cloned content for better reading
                     contentClone.querySelectorAll('.section-read-time').forEach(el => el.remove());
                     contentClone.querySelectorAll('script').forEach(el => el.remove());
                     
                     // Set the content
                     fullscreenContent.innerHTML = contentClone.innerHTML;
                     
                     // Activate fullscreen mode
                     document.body.classList.add('fullscreen-reading');
                     fullscreenMode.classList.add('active');
                     isFullscreenActive = true;
                     
                     // Update dark mode button state
                     const isDarkMode = document.documentElement.classList.contains('dark-mode');
                     fullscreenDarkModeBtn.querySelector('.icon').textContent = isDarkMode ? 'light_mode' : 'dark_mode';
                     fullscreenDarkModeBtn.title = isDarkMode ? 'Switch to light mode' : 'Switch to dark mode';
                     
                     // Initialize progress tracking
                     updateFullscreenProgress();
                     
                     // Prevent body scroll
                     document.body.style.overflow = 'hidden';
                 }
                 
                 function exitFullscreenReading() {
                     document.body.classList.remove('fullscreen-reading');
                     fullscreenMode.classList.remove('active');
                     isFullscreenActive = false;
                     
                     // Restore body scroll
                     document.body.style.overflow = '';
                     
                     // Stop any TTS playback
                     if (window.speechSynthesis) {
                         window.speechSynthesis.cancel();
                     }
                 }
                 
                 function adjustFontSize(increase) {
                     if (increase) {
                         currentFontSize = Math.min(2.0, currentFontSize + 0.1);
                     } else {
                         currentFontSize = Math.max(0.8, currentFontSize - 0.1);
                     }
                     fullscreenContent.style.fontSize = `${currentFontSize}rem`;
                 }
                 
                 function updateFullscreenProgress() {
                     if (!isFullscreenActive) return;
                     
                     const scrollTop = fullscreenMode.scrollTop;
                     const scrollHeight = fullscreenMode.scrollHeight - fullscreenMode.clientHeight;
                     const progress = scrollHeight > 0 ? Math.round((scrollTop / scrollHeight) * 100) : 0;
                     
                     fullscreenProgress.textContent = `Reading progress: ${progress}%`;
                 }
                 
                 function toggleFullscreenTTS() {
                     const synth = window.speechSynthesis;
                     if (!synth) return;
                     
                     if (synth.speaking && !synth.paused) {
                         synth.pause();
                         fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                         fullscreenTtsBtn.title = 'Resume listening';
                     } else if (synth.paused) {
                         synth.resume();
                         fullscreenTtsBtn.querySelector('.icon').textContent = 'pause';
                         fullscreenTtsBtn.title = 'Pause listening';
                     } else {
                         // Start new speech
                         const textToSpeak = fullscreenContent.innerText;
                         const utterance = new SpeechSynthesisUtterance(textToSpeak);
                         utterance.lang = document.documentElement.lang || 'en-US';
                         utterance.rate = 0.9;
                         utterance.pitch = 1.0;
                         utterance.volume = 0.8;
                         
                         utterance.onstart = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'pause';
                             fullscreenTtsBtn.title = 'Pause listening';
                         };
                         
                         utterance.onend = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                             fullscreenTtsBtn.title = 'Listen to content';
                         };
                         
                         utterance.onerror = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                             fullscreenTtsBtn.title = 'Listen to content';
                         };
                         
                         synth.speak(utterance);
                     }
                 }
                 
                 function toggleFullscreenDarkMode() {
                     const isDarkMode = document.documentElement.classList.toggle('dark-mode');
                     fullscreenDarkModeBtn.querySelector('.icon').textContent = isDarkMode ? 'light_mode' : 'dark_mode';
                     fullscreenDarkModeBtn.title = isDarkMode ? 'Switch to light mode' : 'Switch to dark mode';
                     localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                 }
                 
                 // Event listeners
                 fullscreenBtn.addEventListener('click', enterFullscreenReading);
                 exitBtn.addEventListener('click', exitFullscreenReading);
                 fontIncreaseBtn.addEventListener('click', () => adjustFontSize(true));
                 fontDecreaseBtn.addEventListener('click', () => adjustFontSize(false));
                 fullscreenTtsBtn.addEventListener('click', toggleFullscreenTTS);
                 fullscreenDarkModeBtn.addEventListener('click', toggleFullscreenDarkMode);
                 
                 // Scroll progress tracking
                 fullscreenMode.addEventListener('scroll', () => {
                     if (isFullscreenActive) {
                         updateFullscreenProgress();
                     }
                 });
                 
                 // Keyboard shortcuts
                 document.addEventListener('keydown', (e) => {
                     if (!isFullscreenActive) return;
                     
                     switch(e.key) {
                         case 'Escape':
                             exitFullscreenReading();
                             break;
                         case 'F':
                         case 'f':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 // Could implement search functionality here
                             }
                             break;
                         case '+':
                         case '=':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 adjustFontSize(true);
                             }
                             break;
                         case '-':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 adjustFontSize(false);
                             }
                             break;
                         case ' ':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 toggleFullscreenTTS();
                             }
                             break;
                     }
                 });
                 
                 // Prevent context menu in fullscreen mode
                 fullscreenMode.addEventListener('contextmenu', (e) => {
                     if (isFullscreenActive) {
                         e.preventDefault();
                     }
                 });
             }

             // --- FEATURE: BREADCRUMB NAVIGATION ---
             function initBreadcrumbNavigation() {
                 const breadcrumbContainer = document.getElementById('breadcrumb-container');
                 const breadcrumbHome = document.getElementById('breadcrumb-home');
                 const breadcrumbCurrent = document.getElementById('breadcrumb-current');
                 const breadcrumbProgressFill = document.getElementById('breadcrumb-progress-fill');
                 const breadcrumbProgressText = document.getElementById('breadcrumb-progress-text');
                 const breadcrumbSectionCount = document.getElementById('breadcrumb-section-count');
                 
                 let sections = [];
                 let currentSectionIndex = 0;
                 let isVisible = false;
                 
                 function initializeSections() {
                     const tabPanes = document.querySelectorAll('.tab-pane');
                     sections = Array.from(tabPanes).map((pane, index) => {
                         const h2Element = pane.querySelector('h2');
                         return {
                             id: pane.id,
                             title: h2Element ? h2Element.textContent.trim() : `Section ${index + 1}`,
                             element: pane,
                             index: index
                         };
                     });
                 }
                 
                 function updateBreadcrumb() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane || sections.length === 0) return;
                     
                     // Find current section
                     currentSectionIndex = sections.findIndex(section => section.element === activeTabPane);
                     const currentSection = sections[currentSectionIndex];
                     
                     if (!currentSection) return;
                     
                     // Update breadcrumb current section
                     const maxTitleLength = window.innerWidth < 768 ? 25 : 40;
                     const displayTitle = currentSection.title.length > maxTitleLength ? 
                                         currentSection.title.substring(0, maxTitleLength) + '...' : 
                                         currentSection.title;
                     
                     breadcrumbCurrent.innerHTML = `
                         <span class="breadcrumb-link active" title="${currentSection.title}">
                             ${displayTitle}
                         </span>
                     `;
                     
                     // Update section count
                     breadcrumbSectionCount.textContent = `Section ${currentSectionIndex + 1} of ${sections.length}`;
                     
                     // Update progress
                     const progress = Math.round(((currentSectionIndex + 1) / sections.length) * 100);
                     breadcrumbProgressFill.style.width = `${progress}%`;
                     breadcrumbProgressText.textContent = `${progress}%`;
                     
                     // Show/hide breadcrumb based on scroll position
                     const shouldShow = window.scrollY > 200;
                     if (shouldShow && !isVisible) {
                         breadcrumbContainer.classList.add('show');
                         isVisible = true;
                     } else if (!shouldShow && isVisible) {
                         breadcrumbContainer.classList.remove('show');
                         isVisible = false;
                     }
                 }
                 
                 function createSectionBreadcrumb() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Get current section hierarchy
                     const headings = activeTabPane.querySelectorAll('h2, h3, h4');
                     const currentScroll = window.scrollY + window.innerHeight / 2;
                     let activeHeading = null;
                     
                     // Find the currently visible heading
                     for (let i = headings.length - 1; i >= 0; i--) {
                         const heading = headings[i];
                         const rect = heading.getBoundingClientRect();
                         const absoluteTop = window.scrollY + rect.top;
                         
                         if (absoluteTop <= currentScroll) {
                             activeHeading = heading;
                             break;
                         }
                     }
                     
                     // Build breadcrumb path
                     let breadcrumbPath = '';
                     if (activeHeading && activeHeading.tagName !== 'H2') {
                         const h2 = activeTabPane.querySelector('h2');
                         const headingText = activeHeading.textContent.trim();
                         const maxLength = window.innerWidth < 768 ? 20 : 30;
                         const shortText = headingText.length > maxLength ? 
                                          headingText.substring(0, maxLength) + '...' : 
                                          headingText;
                         
                         breadcrumbPath = `
                             <span class="breadcrumb-separator">›</span>
                             <div class="breadcrumb-item">
                                 <span class="breadcrumb-link" title="${headingText}">
                                     ${shortText}
                                 </span>
                             </div>
                         `;
                     }
                     
                     // Update the breadcrumb current section with subsection info
                     const currentSection = sections[currentSectionIndex];
                     if (currentSection) {
                         const maxTitleLength = window.innerWidth < 768 ? 20 : 30;
                         const displayTitle = currentSection.title.length > maxTitleLength ? 
                                             currentSection.title.substring(0, maxTitleLength) + '...' : 
                                             currentSection.title;
                         
                         breadcrumbCurrent.innerHTML = `
                             <span class="breadcrumb-link active" title="${currentSection.title}">
                                 ${displayTitle}
                             </span>
                             ${breadcrumbPath}
                         `;
                     }
                 }
                 
                 function navigateToSection(sectionIndex) {
                     if (sectionIndex < 0 || sectionIndex >= sections.length) return;
                     
                     const section = sections[sectionIndex];
                     const tabButton = document.querySelector(`[data-tab="${section.id}"]`);
                     
                     if (tabButton) {
                         tabButton.click();
                         setTimeout(() => {
                             section.element.scrollIntoView({
                                 behavior: 'smooth',
                                 block: 'start'
                             });
                         }, 150);
                     }
                 }
                 
                 // Event listeners
                 breadcrumbHome.addEventListener('click', (e) => {
                     e.preventDefault();
                     navigateToSection(0);
                 });
                 
                 // Throttled scroll handler
                 let scrollTicking = false;
                 function handleScroll() {
                     if (!scrollTicking) {
                         requestAnimationFrame(() => {
                             updateBreadcrumb();
                             createSectionBreadcrumb();
                             scrollTicking = false;
                         });
                         scrollTicking = true;
                     }
                 }
                 
                 // Event listeners
                 window.addEventListener('scroll', handleScroll);
                 window.addEventListener('resize', updateBreadcrumb);
                 
                 // Update breadcrumb when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(() => {
                             updateBreadcrumb();
                             createSectionBreadcrumb();
                         }, 100);
                     });
                 }
                 
                 // Keyboard navigation
                 document.addEventListener('keydown', (e) => {
                     if (e.altKey) {
                         switch(e.key) {
                             case 'ArrowLeft':
                                 e.preventDefault();
                                 if (currentSectionIndex > 0) {
                                     navigateToSection(currentSectionIndex - 1);
                                 }
                                 break;
                             case 'ArrowRight':
                                 e.preventDefault();
                                 if (currentSectionIndex < sections.length - 1) {
                                     navigateToSection(currentSectionIndex + 1);
                                 }
                                 break;
                             case 'Home':
                                 e.preventDefault();
                                 navigateToSection(0);
                                 break;
                             case 'End':
                                 e.preventDefault();
                                 navigateToSection(sections.length - 1);
                                 break;
                         }
                     }
                 });
                 
                 // Initialize after tabs are set up
                 setTimeout(() => {
                     initializeSections();
                     updateBreadcrumb();
                     createSectionBreadcrumb();
                 }, 200);
             }

             // --- FEATURE: READ TIME CALCULATION ---
             function calculateAndDisplayReadTime() {
                 const wordsPerMinute = 225;
                 
                 function calculate(element) {
                     if (!element) return 0;
                     const text = element.innerText || '';
                     const wordCount = text.trim().split(/\s+/).length;
                     const minutes = Math.ceil(wordCount / wordsPerMinute);
                     return minutes;
                 }
                 
                 // Calculate reading time for each section and sum them up
                 let totalMinutes = 0;
         
                 // Calculate for each section and add after the description paragraph
                 document.querySelectorAll('.tab-pane').forEach(pane => {
                     const sectionMinutes = calculate(pane);
                     
                     // Add this section's reading time to the total
                     totalMinutes += sectionMinutes;
                     
                     const h2Element = pane.querySelector('h2');
                     
                     if (h2Element && sectionMinutes > 0) {
                         // Remove any existing read time elements
                         const existingReadTime = pane.querySelector('.section-read-time');
                         if (existingReadTime) {
                             existingReadTime.remove();
                         }
                         
                         // Find the first paragraph after the h2 (section description)
                         let insertionPoint = h2Element.nextSibling;
                         let firstParagraph = null;
                         
                         // Walk through siblings to find the first paragraph
                         while (insertionPoint) {
                             if (insertionPoint.nodeType === 1 && insertionPoint.tagName === 'P') {
                                 firstParagraph = insertionPoint;
                                 break;
                             }
                             insertionPoint = insertionPoint.nextSibling;
                         }
                         
                         // Create new read time element
                         const readTimeDiv = document.createElement('div');
                         readTimeDiv.className = 'section-read-time';
                         readTimeDiv.style.cssText = 'margin: 0.5rem 0 1rem 0; color: var(--text-secondary); font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;';
                         
                         const clockIcon = document.createElement('span');
                         clockIcon.className = 'icon';
                         clockIcon.textContent = 'schedule';
                         clockIcon.style.fontSize = '18px';
                         
                         const readTimeText = document.createElement('span');
                         readTimeText.textContent = `${sectionMinutes} min read`;
                         
                         readTimeDiv.appendChild(clockIcon);
                         readTimeDiv.appendChild(readTimeText);
                         
                         // Insert after the first paragraph if found, otherwise after h2
                         if (firstParagraph) {
                             firstParagraph.parentNode.insertBefore(readTimeDiv, firstParagraph.nextSibling);
                         } else {
                             h2Element.parentNode.insertBefore(readTimeDiv, h2Element.nextSibling);
                         }
                     }
                 });
                 
                 // Update the total reading time in the product header
                 const totalReadTimeEl = document.getElementById('total-read-time').querySelector('span:last-child');
                 totalReadTimeEl.textContent = `${totalMinutes} min read`;
             }
         
             // --- UTILITY: EMOJI REPLACEMENT ---
             function replaceEmojisWithIcons() {
                 const emojiToIconMap = {
                     '🔴': '<span class="icon icon-high" title="High/Critical">dangerous</span>',
                     '🟠': '<span class="icon icon-medium" title="Medium/Warning">warning</span>',
                     '🟢': '<span class="icon icon-low" title="Low/Info">recommend</span>',
                     '✅': '<span class="icon icon-check" title="Yes/Used/Supported">check_circle</span>',
                     '❌': '<span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span>',
                     '🔴': '<span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span>',
                     '❔': '<span class="icon icon-question" title="Uncertain/Likely">help</span>'
                 };
                 const emojiRegex = new RegExp(Object.keys(emojiToIconMap).join('|'), 'g');
                 function walkDOM(node) {
                     if (node.nodeType === 3) {
                         if (emojiRegex.test(node.nodeValue)) {
                             const tempWrapper = document.createElement('span');
                             tempWrapper.innerHTML = node.nodeValue.replace(emojiRegex, match => emojiToIconMap[match]);
                             node.parentNode.replaceChild(tempWrapper, node);
                         }
                     } else if (node.nodeType === 1 && node.nodeName !== 'SCRIPT' && node.nodeName !== 'STYLE') {
                         for (let i = 0; i < node.childNodes.length; i++) {
                             walkDOM(node.childNodes[i]);
                         }
                     }
                 }
                 walkDOM(document.getElementById('main-content-area'));
             }
         
             // --- UTILITY: HEADING CLEANUP ---
             function removeHeadingNumbers() {
                 const headings = document.querySelectorAll('h2, h3, h4, h5, h6');
                 const numberPrefixRegex = /^\d+\.[\d\.]*\s*/;
                 headings.forEach(heading => {
                     const firstChild = heading.childNodes[0];
                     if (firstChild && firstChild.nodeType === 3) {
                         firstChild.nodeValue = firstChild.nodeValue.replace(numberPrefixRegex, '').trim();
                     }
                 });
             }
         
             // --- CORE SETUP: TABS ---
             function setupTabs() {
                 const mainContent = document.getElementById('main-content-area');
                 const tabPlaceholder = document.getElementById('tab-container-placeholder');
                 const sections = Array.from(mainContent.querySelectorAll('.product-section'));
                 
                 if (sections.length > 0) {
                     const tabContainer = document.createElement('div');
                     tabContainer.className = 'tab-navigation-container';
                     const tabNavScroller = document.createElement('div');
                     tabNavScroller.className = 'tab-nav-scroller';
                     const tabNav = document.createElement('nav');
                     tabNav.className = 'tab-navigation';
                     const tabContent = document.createElement('div');
                     tabContent.className = 'tab-content';
         
                     let tabCounter = 0; // Separate counter for actual tabs created
         
                     sections.forEach((section, index) => {
                         const headingElement = section.querySelector('h2');
                         if (!headingElement) return;
                         
                         tabCounter++; // Increment only when a tab is actually created
                         const tabPaneId = `pane-${tabCounter}`;
                         const tabButton = document.createElement('button');
                         tabButton.className = 'tab-link';
                         const tabText = document.createElement('span');
                         tabText.textContent = headingElement.textContent.trim();
                         tabButton.appendChild(tabText);
                         tabButton.setAttribute('data-tab', tabPaneId);
                         tabNav.appendChild(tabButton);
                         
                         const tabPane = document.createElement('div');
                         tabPane.id = tabPaneId;
                         tabPane.className = 'tab-pane';
                         tabPane.appendChild(section);
                         tabContent.appendChild(tabPane);
         
                         if (tabCounter === 1) { // First actual tab created
                             tabButton.classList.add('active');
                             tabPane.classList.add('active');
                         }
                     });
         
                     tabNavScroller.appendChild(tabNav);
                     tabContainer.appendChild(tabNavScroller);
                     tabPlaceholder.appendChild(tabContainer);
                     mainContent.appendChild(tabContent);
         
                     tabNav.addEventListener('click', (e) => {
                         const clickedTab = e.target.closest('.tab-link');
                         if (!clickedTab) return;
                         tabNav.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
                         tabContent.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                         clickedTab.classList.add('active');
                         document.getElementById(clickedTab.dataset.tab)?.classList.add('active');
                     });
         
                     // After tabs are in the DOM, calculate read times
                     calculateAndDisplayReadTime();
                 }
             }
         
             function detectDiagramType(code) {
                 const trimmedCode = code.trim().toLowerCase();
                 
                 if (trimmedCode.startsWith('graph') || trimmedCode.startsWith('flowchart')) return 'flowchart';
                 if (trimmedCode.startsWith('sequencediagram')) return 'sequence';
                 if (trimmedCode.startsWith('classdiagram')) return 'class';
                 if (trimmedCode.startsWith('statediagram')) return 'state';
                 if (trimmedCode.startsWith('erdiagram')) return 'er';
                 if (trimmedCode.startsWith('gantt')) return 'gantt';
                 if (trimmedCode.startsWith('journey')) return 'user-journey';
                 if (trimmedCode.startsWith('gitgraph')) return 'git';
                 if (trimmedCode.startsWith('pie')) return 'pie';
                 if (trimmedCode.startsWith('mindmap')) return 'mindmap';
                 if (trimmedCode.startsWith('timeline')) return 'timeline';
                 if (trimmedCode.startsWith('zenuml')) return 'zenuml';
                 if (trimmedCode.startsWith('quadrantchart')) return 'quadrant';
                 if (trimmedCode.startsWith('xychart')) return 'xy-chart';
                 if (trimmedCode.startsWith('block')) return 'block';
                 if (trimmedCode.startsWith('packet')) return 'packet';
                 if (trimmedCode.startsWith('treemap')) return 'treemap';
                 
                 return 'unknown';
             }
             
             function validateAndFixMermaidSyntax(code) {
                 let fixedCode = code.trim();
                 
                 // First, decode HTML entities that might cause parsing issues
                 fixedCode = fixedCode
                     .replace(/&amp;/g, '&')
                     .replace(/&lt;br&gt;/g, '<br>') // Handle HTML line breaks first
                     .replace(/&lt;/g, '<')
                     .replace(/&gt;/g, '>')
                     .replace(/&#39;/g, "'")
                     .replace(/&quot;/g, '"')
                     .replace(/&nbsp;/g, ' ')
                     .replace(/&apos;/g, "'");
                 
                 // Detect diagram type
                 const diagramType = detectDiagramType(fixedCode);
                 
                 // Handle unknown diagram types by converting to flowchart if possible
                 if (diagramType === 'unknown') {
                     console.warn('Unknown diagram type, attempting to render as-is');
                 }
                 
                 // Fix common syntax issues based on diagram type
                 switch (diagramType) {
                     case 'flowchart':
                         // Ensure flowchart has proper direction
                         if (!fixedCode.match(/(TD|TB|BT|RL|LR)/)) {
                             fixedCode = fixedCode.replace(/^(flowchart|graph)/, '$1 TD');
                         }
                         
                         // Fix specific pattern: node labels with <br> and file paths
                         // This pattern is causing the parser error: [Label<br>/path/file.xhtml]
                         fixedCode = fixedCode.replace(/\[([^\[\]]*)<br>([^\[\]]*)\]/g, (match, label, path) => {
                             // Clean the label and path, replace problematic characters
                             const cleanLabel = label.trim();
                             const cleanPath = path.trim()
                                 .replace(/\//g, '∕') // Replace forward slashes with math division symbol
                                 .replace(/\./g, '·'); // Replace dots with middle dot
                             return `["${cleanLabel}\\n${cleanPath}"]`; // Use quoted strings for safety
                         });
                         
                         // Handle similar pattern in parentheses
                         fixedCode = fixedCode.replace(/\(([^\(\)]*)<br>([^\(\)]*)\)/g, (match, label, path) => {
                             const cleanLabel = label.trim();
                             const cleanPath = path.trim()
                                 .replace(/\//g, '∕')
                                 .replace(/\./g, '·');
                             return `("${cleanLabel}\\n${cleanPath}")`;
                         });
                         
                         // Fix node labels with parentheses that can cause parsing issues
                         // Pattern: A[Label (with parentheses)] --> B
                         fixedCode = fixedCode.replace(/(\w+)\[([^\[\]]*\([^\[\]]*\)[^\[\]]*)\]/g, (match, nodeId, label) => {
                             // Wrap labels containing parentheses in quotes
                             const cleanLabel = label.replace(/"/g, '\\"'); // Escape existing quotes
                             return `${nodeId}["${cleanLabel}"]`;
                         });
                         
                         // Fix incomplete arrow syntax - ensure arrows have proper targets
                         // Pattern: A[Label] - (incomplete arrow at end of line)
                         fixedCode = fixedCode.replace(/(\w+\[[^\]]+\]|\w+\([^)]+\)|\w+)\s+--?\s*$/gm, (match, source) => {
                             // If we find an incomplete arrow at end of line, remove it entirely
                             console.warn('Removing incomplete arrow syntax:', match.trim());
                             return source.trim();
                         });
                         
                         // Fix common arrow syntax issues
                         fixedCode = fixedCode
                             .replace(/--&gt;/g, '-->')  // Fix any remaining HTML entities in arrows
                             .replace(/-->/g, ' --> ') // Ensure proper spacing around arrows
                             .replace(/\s+-->\s+/g, ' --> ') // Clean up multiple spaces
                             .replace(/\[\s+/g, '[') // Remove extra spaces after opening brackets
                             .replace(/\s+\]/g, ']') // Remove extra spaces before closing brackets
                             .replace(/\(\s+/g, '(') // Remove extra spaces after opening parentheses
                             .replace(/\s+\)/g, ')') // Remove extra spaces before closing parentheses
                             .replace(/\{\s+/g, '{') // Remove extra spaces after opening braces
                             .replace(/\s+\}/g, '}'); // Remove extra spaces before closing braces
                         
                         // Handle any remaining line breaks in node labels
                         fixedCode = fixedCode.replace(/<br>/gi, '\\n'); // Convert HTML breaks to Mermaid line breaks
                         
                         break;
                         
                     case 'mindmap':
                         // Ensure mindmap has proper structure
                         if (!fixedCode.includes('root(')) {
                             // If incomplete mindmap, add basic structure
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'mindmap') {
                                 // Wrap content in root node
                                 const content = lines.slice(1).join('\n').trim();
                                 if (content) {
                                     fixedCode = `mindmap\n  root((${content.split('\n')[0] || 'Root'}))\n${content}`;
                                 }
                             }
                         }
                         // Remove or fix invalid icon syntax for older versions
                         fixedCode = fixedCode.replace(/::icon\([^)]+\)/g, '');
                         break;
                         
                     case 'user-journey':
                         // Ensure journey diagram has proper structure
                         if (!fixedCode.includes('title')) {
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'journey') {
                                 lines.splice(1, 0, '    title User Journey');
                                 fixedCode = lines.join('\n');
                             }
                         }
                         break;
                         
                     case 'timeline':
                         // Timeline diagrams should have proper structure
                         if (!fixedCode.includes('title')) {
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'timeline') {
                                 lines.splice(1, 0, '  title Timeline');
                                 fixedCode = lines.join('\n');
                             }
                         }
                         break;
                 }
                 
                 // Final cleanup - remove any remaining problematic characters
                 fixedCode = fixedCode
                     .replace(/\r\n/g, '\n') // Normalize line endings
                     .replace(/\r/g, '\n')   // Convert old Mac line endings
                     .split('\n')
                     .map(line => line.trimRight()) // Remove trailing whitespace from each line
                     .join('\n')
                     .replace(/\n\s*\n\s*\n/g, '\n\n'); // Remove excessive blank lines
                 
                 return fixedCode;
             }
             
             // Function to re-render diagrams when theme changes
             function updateMermaidTheme() {
                 const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                                   window.matchMedia('(prefers-color-scheme: dark)').matches;
                 
                 try {
                     console.log(`Updating Mermaid theme to ${isDarkMode ? 'dark' : 'light'} mode`);
                     
                     // Step 1: Clear all existing rendered containers and reset processed state
                     const containers = document.querySelectorAll('.mermaid-container');
                     const preBlocks = document.querySelectorAll('pre.mermaid');
                     
                     containers.forEach(container => {
                         container.remove();
                     });
                     
                     preBlocks.forEach(preBlock => {
                         preBlock.classList.remove('mermaid-processed');
                         preBlock.style.display = 'block'; // Show original blocks temporarily
                     });
                     
                     // Step 2: Re-initialize Mermaid with new theme configuration
                     initializeMermaidRendering(); // Use the same initialization function as initial load
                     
                     // Step 3: Re-render all diagrams using the complete rendering process
                     setTimeout(() => {
                         renderMermaidDiagrams(); // Use the same rendering function as initial load
                         console.log(`Mermaid theme successfully updated to ${isDarkMode ? 'dark' : 'light'} mode`);
                     }, 100); // Small delay to ensure initialization is complete
                     
                 } catch (error) {
                     console.error('Error updating Mermaid theme:', error);
                 }
             }
         
             // --- RUN EVERYTHING ---
             // Add a small delay to ensure DOM is fully loaded
             setTimeout(() => {
                 init();
             }, 10);
         
         });
      </script>

   </body>
</html>
